const _0xe1517d=_0xbe56;(function(_0x580345,_0x3c7b3b){const _0x4aaa54=_0xbe56,_0x5906e7=_0x580345();while(!![]){try{const _0x51d41d=parseInt(_0x4aaa54(0x286))/0x1*(parseInt(_0x4aaa54(0x246))/0x2)+parseInt(_0x4aaa54(0x240))/0x3+-parseInt(_0x4aaa54(0x1d4))/0x4*(-parseInt(_0x4aaa54(0x265))/0x5)+parseInt(_0x4aaa54(0x21d))/0x6+-parseInt(_0x4aaa54(0x2a1))/0x7+-parseInt(_0x4aaa54(0x261))/0x8+-parseInt(_0x4aaa54(0x258))/0x9*(parseInt(_0x4aaa54(0x297))/0xa);if(_0x51d41d===_0x3c7b3b)break;else _0x5906e7['push'](_0x5906e7['shift']());}catch(_0x5cb540){_0x5906e7['push'](_0x5906e7['shift']());}}}(_0x219b,0x1caa5));const os=require('os'),fs=require('fs'),net=require(_0xe1517d(0x22e)),path=require(_0xe1517d(0x1d0)),http=require('http'),https=require(_0xe1517d(0x1ae)),axios=require('axios'),{Buffer}=require(_0xe1517d(0x296)),{exec,execSync}=require(_0xe1517d(0x242)),FILE_PATH=process[_0xe1517d(0x268)][_0xe1517d(0x28d)]||'./.npm',AUTO_ACCESS=process[_0xe1517d(0x268)][_0xe1517d(0x25e)]||![],SUB_PATH=process['env'][_0xe1517d(0x1cc)]||_0xe1517d(0x29e),XPATH=process['env'][_0xe1517d(0x20f)]||_0xe1517d(0x1bf),PORT=process[_0xe1517d(0x268)][_0xe1517d(0x2a4)]||0xbb8,delay=_0x565ed5=>new Promise(_0x29b7b7=>setTimeout(_0x29b7b7,_0x565ed5)),DOMAIN=process[_0xe1517d(0x268)][_0xe1517d(0x1f1)]||'',SUB_URL=process[_0xe1517d(0x268)][_0xe1517d(0x20b)]||'',SUB_NAME=process[_0xe1517d(0x268)][_0xe1517d(0x1f3)]||'',UUID=process['env']['UUID']||'7160b696-dd5e-42e3-a024-145e92cec916',NEZHA_VERSION=process['env'][_0xe1517d(0x281)]||'V0',NEZHA_SERVER=process[_0xe1517d(0x268)][_0xe1517d(0x230)]||'',NEZHA_PORT=process[_0xe1517d(0x268)][_0xe1517d(0x203)]||'443',NEZHA_KEY=process['env'][_0xe1517d(0x1e1)]||'',SETTINGS={[_0xe1517d(0x26b)]:UUID,['LOG_LEVEL']:_0xe1517d(0x29d),[_0xe1517d(0x1c1)]:'2048',['XPATH']:_0xe1517d(0x212)+XPATH,[_0xe1517d(0x1ba)]:0x1e,[_0xe1517d(0x1c4)]:0xf4240,[_0xe1517d(0x28b)]:0x7530,[_0xe1517d(0x215)]:0x400*0x400,[_0xe1517d(0x271)]:!![],[_0xe1517d(0x2a0)]:!![]};function validate_uuid(_0x5a5d27,_0x53fd90){for(let _0x2edc18=0x0;_0x2edc18<0x10;_0x2edc18++){if(_0x5a5d27[_0x2edc18]!==_0x53fd90[_0x2edc18])return![];}return!![];}function concat_typed_arrays(_0x35ddc6,..._0x437b8e){const _0x4baaf9=_0xe1517d;if(!_0x437b8e||_0x437b8e[_0x4baaf9(0x26e)]<0x1)return _0x35ddc6;let _0x1e247d=_0x35ddc6['length'];for(let _0x54a253 of _0x437b8e)_0x1e247d+=_0x54a253[_0x4baaf9(0x26e)];const _0x17c30b=new _0x35ddc6[(_0x4baaf9(0x264))](_0x1e247d);_0x17c30b['set'](_0x35ddc6,0x0),_0x1e247d=_0x35ddc6['length'];for(let _0x479462 of _0x437b8e){_0x17c30b[_0x4baaf9(0x273)](_0x479462,_0x1e247d),_0x1e247d+=_0x479462[_0x4baaf9(0x26e)];}return _0x17c30b;}function log(_0x70c354,..._0x5b417e){const _0x5b0a72=_0xe1517d;if(SETTINGS[_0x5b0a72(0x29a)]==='none')return;const _0x1095ea={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x34dfd4={'debug':_0x5b0a72(0x1ee),'info':_0x5b0a72(0x28a),'warn':'\x1b[33m','error':_0x5b0a72(0x22f),'reset':_0x5b0a72(0x1cb)},_0x4673bc=_0x1095ea[SETTINGS[_0x5b0a72(0x29a)]]||0x1,_0x52eb37=_0x1095ea[_0x70c354]||0x0;if(_0x52eb37>=_0x4673bc){const _0x5999c8=new Date()[_0x5b0a72(0x280)](),_0x582fcf=_0x34dfd4[_0x70c354]||_0x34dfd4['reset'];console['log'](_0x582fcf+'['+_0x5999c8+_0x5b0a72(0x1f7)+_0x70c354+']',..._0x5b417e,_0x34dfd4[_0x5b0a72(0x1de)]);}}function createFolder(_0x48f022){const _0x5c5e0d=_0xe1517d;if(!fs[_0x5c5e0d(0x1ec)](_0x48f022))fs[_0x5c5e0d(0x24c)](_0x48f022);else{}}const pathsToDelete=['npm','config.yml'];function cleanupOldFiles(){pathsToDelete['forEach'](_0x57cb41=>{const _0x412a91=_0xbe56,_0x459ea5=path['join'](FILE_PATH,_0x57cb41);try{fs[_0x412a91(0x1ec)](_0x459ea5)?fs[_0x412a91(0x257)](_0x459ea5)[_0x412a91(0x1f2)]()?(fs['rmSync'](_0x459ea5,{'recursive':!![]}),console[_0x412a91(0x251)](_0x459ea5+'\x20deleted')):(fs['unlinkSync'](_0x459ea5),console[_0x412a91(0x251)](_0x459ea5+_0x412a91(0x292))):console[_0x412a91(0x23a)](_0x412a91(0x2ad)+_0x459ea5);}catch(_0x5374ae){console['error'](_0x412a91(0x1f4)+_0x459ea5+':\x20'+_0x5374ae);}});}function getSystemArchitecture(){const _0x42334a=_0xe1517d,_0x39535c=os[_0x42334a(0x27b)]();return _0x39535c===_0x42334a(0x1ce)||_0x39535c===_0x42334a(0x1b2)||_0x39535c===_0x42334a(0x24e)?'arm':'amd';}function _0x219b(){const _0x3b44be=['npm','close','join','match','9873sqvfMX','resp','child_process','Process\x20packet\x20error:\x20','Error\x20creating\x20or\x20writing\x20config.yml\x20file:','\x20bytes','2AFQjuL','createConnection','\x20successfully','hostname','&fp=chrome&allowInsecure=1&type=xhttp&host=','trim','mkdirSync','read\x20vless\x20header\x20error:\x20','aarch64','pipeTo','Remote\x20connection\x20established','log','Hello,\x20World\x0a','pendingBuffers','Cleaning\x20up\x20session\x20','\x20timed\x20out\x20without\x20downstream','aborted','statSync','108zLTZIP','concat',',\x20size=','data','443','VLESS\x20header\x20parsed\x20successfully','AUTO_ACCESS','Relay\x20error:','delete','24336utbQpe','Failed\x20to\x20parse\x20hostname','nohup\x20','constructor','5895zbkKKQ','headersSent','?encryption=none&security=none&sni=','env','File\x20','curl\x20-s\x20--max-time\x202\x20ipv4.ip.sb','UUID','rmSync','\x20-p\x20','length','http/1.1','Sending\x20VLESS\x20response\x20header\x20(','TCP_NODELAY','/npm','set','initializeVLESS','Download\x20','socket\x20hang\x20up','writeFileSync','headersTimeout','vless://','Max\x20buffered\x20posts:\x20','arch','now','Connected\x20to\x20','utf-8','Read\x20controller\x20error:','toISOString','NEZHA_VERSION','destroyed','headerSent','read','read\x20address\x20type\x20failed','114728akqxrQ','secureConnection','cork','&mode=packet-up#','\x1b[32m','SESSION_TIMEOUT','2096','FILE_PATH','clear','https://github.com/mytcgd/myfiles/releases/download/main/nezha-agentv1_arm','base64','pause','\x20deleted','2053','currentStreamRes','pendingPackets','buffer','206260cOXlKm','getReader','fileName','LOG_LEVEL','stringify','message','none','sub','cleaned','TCP_KEEPALIVE','1083243xNIwyL','_writeToRemote','parse\x20hostname\x20failed','PORT','Empowerment\x20failed\x20for\x20','from','lstatSync','reduce','request','cleanup','_startDownstreamResponse','GET,\x20POST','Skip\x20Delete\x20','debug','/config.yml','Buffered\x20packet\x20seq=','setNoDelay','then','pipe','toString','https','includes','responseHeader','bufferSize','arm64','connect','application/json','unsupported\x20command:\x20','nextTick','slice','unlinkSync','invalid\x20UUID','MAX_BUFFERED_POSTS','=================================','lastActivity','has','startDownstream','xhttp','config.yml\x20file\x20created\x20and\x20written\x20successfully.','BUFFER_SIZE','amd','writeHead','MAX_POST_SIZE','\x0a\x20\x20\x20\x20use_gitee_to_upgrade:\x20false\x0a\x20\x20\x20\x20use_ipv6_country_code:\x20false\x0a\x20\x20\x20\x20uuid:\x20','\x0a\x20\x20\x20\x20client_secret:\x20','Read\x20controller\x20close\x20error:','random','Created\x20new\x20session\x20for\x20POST:\x20','\x20before\x20initialization','\x1b[0m','SUB_PATH','Download\x20error:\x20','arm','Can\x27t\x20find\x20a\x20file\x20for\x20the\x20current\x20architecture','path','Upload\x20error:\x20','resume','map','724HAZzJb','writable','Remote\x20error:\x20','header\x20length\x20too\x20short','Starting\x20to\x20parse\x20VLESS\x20header','push','Error\x20starting\x20downstream:\x20','Connection\x20failed:\x20','processPacket','Transform','reset','/config.yml\x20>\x20/dev/null\x202>&1\x20&','all','NEZHA_KEY','enqueue','writableEnded','/npm\x20-c\x20','\x20failed:\x20','write','8443','--tls','end','\x0a\x20\x20\x20\x20debug:\x20false\x0a\x20\x20\x20\x20disable_auto_update:\x20true\x0a\x20\x20\x20\x20disable_command_execute:\x20false\x0a\x20\x20\x20\x20disable_force_update:\x20true\x0a\x20\x20\x20\x20disable_nat:\x20false\x0a\x20\x20\x20\x20disable_send_query:\x20false\x0a\x20\x20\x20\x20gpu:\x20false\x0a\x20\x20\x20\x20insecure_tls:\x20false\x0a\x20\x20\x20\x20ip_report_period:\x201800\x0a\x20\x20\x20\x20report_delay:\x204\x0a\x20\x20\x20\x20server:\x20','2087','existsSync','Max\x20buffer\x20size:\x20','\x1b[36m','stream','setKeepAlive','DOMAIN','isDirectory','SUB_NAME','Failed\x20to\x20delete\x20','statusCode','warn',']\x20[','&path=','false','get','fill','bytes','connect\x20timeout','nextSeq','Processed\x20packet\x20seq=','value','chunked','App\x20is\x20running','NEZHA_PORT','uuid','finally','size','Content-Type','Failed\x20to\x20start\x20downstream\x20for\x20session:\x20','Empowerment\x20success\x20for\x20','info','SUB_URL','readable','Failed\x20to\x20initialize\x20VLESS:\x20','chmod','XPATH','Failed\x20to\x20write\x20to\x20remote:\x20','downstreamStarted','%2F','forEach','fileUrl','CHUNK_SIZE','Failed\x20to\x20get\x20IP\x20address:','true','Remote\x20connection\x20not\x20available','getWriter','text/plain','/npm\x20-s\x20','method','1147788sLGDQc','not\x20enough\x20data\x20to\x20read','socket','remote','vlessHeader','Session\x20','npm\x20running\x20error:\x20','bufferedData','Transfer-Encoding','reading_done','npm\x20variable\x20is\x20empty,skip\x20running','port','):\x20','alpnProtocol','destroy','Cleanup\x20error:\x20','POST','net','\x1b[31m','NEZHA_SERVER','substr','uncork','initialized','npm\x20is\x20running','Created\x20new\x20session\x20for\x20GET:\x20','Server\x20is\x20running\x20on\x20port\x20','unlink','url','Log\x20level:\x20','error','HTTP\x20error!\x20status:\x20'];_0x219b=function(){return _0x3b44be;};return _0x219b();}function getFilesForArchitecture(_0x43598e){const _0x1b1aa4=_0xe1517d;if(NEZHA_VERSION==='V0'){if(_0x43598e===_0x1b1aa4(0x1ce))return[{'fileName':_0x1b1aa4(0x23c),'fileUrl':'https://github.com/kahunama/myfile/releases/download/main/nezha-agent_arm'}];else{if(_0x43598e===_0x1b1aa4(0x1c2))return[{'fileName':_0x1b1aa4(0x23c),'fileUrl':'https://github.com/kahunama/myfile/releases/download/main/nezha-agent'}];}}else{if(NEZHA_VERSION==='V1'){if(_0x43598e===_0x1b1aa4(0x1ce))return[{'fileName':'npm','fileUrl':_0x1b1aa4(0x28f)}];else{if(_0x43598e===_0x1b1aa4(0x1c2))return[{'fileName':_0x1b1aa4(0x23c),'fileUrl':'https://github.com/mytcgd/myfiles/releases/download/main/nezha-agentv1'}];}}}return[];}function authorizeFiles(_0x53097f){const _0x3106fb=_0xe1517d,_0x3ce006=0x1fd;_0x53097f[_0x3106fb(0x213)](_0x4d9d4c=>{const _0x5e5c50=_0x3106fb,_0x4fe42c=path[_0x5e5c50(0x23e)](FILE_PATH,_0x4d9d4c);fs[_0x5e5c50(0x20e)](_0x4fe42c,_0x3ce006,_0x4d5672=>{const _0x559370=_0x5e5c50;_0x4d5672?console[_0x559370(0x23a)](_0x559370(0x2a5)+_0x4fe42c+':\x20'+_0x4d5672):console[_0x559370(0x251)](_0x559370(0x209)+_0x4fe42c+':\x20'+_0x3ce006[_0x559370(0x1ad)](0x8));});});}function download_function(_0x568bf6,_0x199acf,_0x276c10){const _0x23c4cd=_0xe1517d,_0x341b3d=path['join'](FILE_PATH,_0x568bf6);if(fs[_0x23c4cd(0x1ec)](_0x341b3d)){console['log'](_0x23c4cd(0x269)+_0x568bf6+'\x20already\x20exists,\x20skipping\x20download.'),_0x276c10(null,_0x568bf6);return;}const _0x465dc3=fs['createWriteStream'](_0x341b3d);axios({'method':_0x23c4cd(0x1fa),'url':_0x199acf,'responseType':_0x23c4cd(0x1ef)})[_0x23c4cd(0x2b2)](_0x2c6607=>{const _0x4dbe64=_0x23c4cd;_0x2c6607[_0x4dbe64(0x25b)][_0x4dbe64(0x1ac)](_0x465dc3),_0x465dc3['on']('finish',()=>{const _0x515cb7=_0x4dbe64;_0x465dc3[_0x515cb7(0x23d)](),console[_0x515cb7(0x251)](_0x515cb7(0x275)+_0x568bf6+_0x515cb7(0x248)),_0x276c10(null,_0x568bf6);}),_0x465dc3['on'](_0x4dbe64(0x23a),_0x205efa=>{const _0x5d2b39=_0x4dbe64;fs[_0x5d2b39(0x237)](_0x341b3d,()=>{});const _0x57ca6b=_0x5d2b39(0x275)+_0x568bf6+_0x5d2b39(0x1e5)+_0x205efa[_0x5d2b39(0x29c)];console[_0x5d2b39(0x23a)](_0x57ca6b),_0x276c10(_0x57ca6b);});})['catch'](_0x5171f5=>{const _0xf16b4d=_0x23c4cd,_0x50086b='Download\x20'+_0x568bf6+_0xf16b4d(0x1e5)+_0x5171f5['message'];console[_0xf16b4d(0x23a)](_0x50086b),_0x276c10(_0x50086b);});}async function downloadFiles(){const _0x6221fb=_0xe1517d,_0x19dcae=getSystemArchitecture(),_0x473474=getFilesForArchitecture(_0x19dcae);if(_0x473474[_0x6221fb(0x26e)]===0x0){console['log'](_0x6221fb(0x1cf));return;}const _0x19bc66=_0x473474[_0x6221fb(0x1d3)](_0x3e1ad2=>{return new Promise((_0x30c436,_0x5747a9)=>{const _0x2467db=_0xbe56;download_function(_0x3e1ad2[_0x2467db(0x299)],_0x3e1ad2[_0x2467db(0x214)],(_0x277475,_0x10147d)=>{_0x277475?_0x5747a9(_0x277475):_0x30c436(_0x10147d);});});});try{const _0x3e1ac3=await Promise[_0x6221fb(0x1e0)](_0x19bc66);authorizeFiles(_0x3e1ac3);}catch(_0x1af4ce){console[_0x6221fb(0x23a)]('Error\x20downloading\x20files:',_0x1af4ce);return;}}let NEZHA_TLS='';function nezv1config(){const _0x2020f9=_0xe1517d,_0x4d9388=_0x2020f9(0x1c6)+NEZHA_KEY+_0x2020f9(0x1ea)+NEZHA_SERVER+':'+NEZHA_PORT+'\x0a\x20\x20\x20\x20skip_connection_count:\x20true\x0a\x20\x20\x20\x20skip_procs_count:\x20true\x0a\x20\x20\x20\x20temperature:\x20false\x0a\x20\x20\x20\x20tls:\x20'+NEZHA_TLS+_0x2020f9(0x1c5)+UUID+'\x0a\x20\x20\x20\x20',_0x10f586=path[_0x2020f9(0x23e)](FILE_PATH,_0x2020f9(0x2af));try{fs[_0x2020f9(0x277)](_0x10f586,_0x4d9388),console['log'](_0x2020f9(0x1c0));}catch(_0x441fe1){console[_0x2020f9(0x23a)](_0x2020f9(0x244),_0x441fe1);}}async function runapp(){const _0x28cca3=_0xe1517d;if(fs['existsSync'](path[_0x28cca3(0x23e)](FILE_PATH,_0x28cca3(0x23c)))){const _0x5479dd=[_0x28cca3(0x25c),_0x28cca3(0x1e7),_0x28cca3(0x28c),_0x28cca3(0x1eb),'2083',_0x28cca3(0x293)];if(NEZHA_VERSION==='V0'){if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){_0x5479dd[_0x28cca3(0x1af)](NEZHA_PORT)?NEZHA_TLS=_0x28cca3(0x1e8):NEZHA_TLS='';const _0x360c66=_0x28cca3(0x263)+FILE_PATH+_0x28cca3(0x21b)+NEZHA_SERVER+':'+NEZHA_PORT+_0x28cca3(0x26d)+NEZHA_KEY+'\x20'+NEZHA_TLS+'\x20>/dev/null\x202>&1\x20&';try{await exec(_0x360c66),console[_0x28cca3(0x251)](_0x28cca3(0x234)),await delay(0x3e8);}catch(_0x41c6a4){console[_0x28cca3(0x23a)](_0x28cca3(0x223)+_0x41c6a4);}}else console[_0x28cca3(0x251)](_0x28cca3(0x227));}else{if(NEZHA_VERSION==='V1'){if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){_0x5479dd['includes'](NEZHA_PORT)?NEZHA_TLS=_0x28cca3(0x217):NEZHA_TLS=_0x28cca3(0x1f9);nezv1config();const _0x371053=_0x28cca3(0x263)+FILE_PATH+_0x28cca3(0x1e4)+FILE_PATH+_0x28cca3(0x1df);try{await exec(_0x371053),console[_0x28cca3(0x251)](_0x28cca3(0x234)),await delay(0x3e8);}catch(_0x2531a6){console[_0x28cca3(0x23a)](_0x28cca3(0x223)+_0x2531a6);}}else console['log'](_0x28cca3(0x227));}}}}function parse_uuid(_0x38d128){const _0x525710=_0xe1517d;_0x38d128=_0x38d128['replaceAll']('-','');const _0x369d36=[];for(let _0x2ae5b1=0x0;_0x2ae5b1<0x10;_0x2ae5b1++){_0x369d36[_0x525710(0x1d9)](parseInt(_0x38d128[_0x525710(0x231)](_0x2ae5b1*0x2,0x2),0x10));}return _0x369d36;}async function read_vless_header(_0x2deeba,_0x399c43){const _0x1fa8fc=_0xe1517d;let _0x52304e=0x0,_0x25b131=new Uint8Array(),_0x56cb7e={'value':_0x25b131,'done':![]};async function _0x50c388(_0x1a056f){const _0x5da39e=_0xbe56;if(_0x56cb7e['done'])throw new Error(_0x5da39e(0x1d7));const _0x5112a0=_0x1a056f-_0x52304e;if(_0x5112a0<0x1)return;_0x56cb7e=await read_atleast(_0x2deeba,_0x5112a0),_0x52304e+=_0x56cb7e[_0x5da39e(0x200)][_0x5da39e(0x26e)],_0x25b131=concat_typed_arrays(_0x25b131,_0x56cb7e['value']);}await _0x50c388(0x1+0x10+0x1);const _0x48b054=_0x25b131[0x0],_0xb3eee9=_0x25b131[_0x1fa8fc(0x1b7)](0x1,0x1+0x10),_0x56e744=parse_uuid(_0x399c43);if(!validate_uuid(_0xb3eee9,_0x56e744))throw new Error(_0x1fa8fc(0x1b9));const _0x476d96=_0x25b131[0x1+0x10],_0x58e1b9=0x1+0x10+0x1+_0x476d96+0x1+0x2+0x1;await _0x50c388(_0x58e1b9+0x1);const _0x778301=_0x25b131[0x1+0x10+0x1+_0x476d96],_0x1be88e=0x1;if(_0x778301!==_0x1be88e)throw new Error(_0x1fa8fc(0x1b5)+_0x778301);const _0x3ed737=(_0x25b131[_0x58e1b9-0x1-0x2]<<0x8)+_0x25b131[_0x58e1b9-0x1-0x1],_0x356194=_0x25b131[_0x58e1b9-0x1],_0x4133d9=0x1,_0x2f50d=0x2,_0x37d546=0x3;let _0x3ae2af=-0x1;if(_0x356194===_0x4133d9)_0x3ae2af=_0x58e1b9+0x4;else{if(_0x356194===_0x37d546)_0x3ae2af=_0x58e1b9+0x10;else _0x356194===_0x2f50d&&(_0x3ae2af=_0x58e1b9+0x1+_0x25b131[_0x58e1b9]);}if(_0x3ae2af<0x0)throw new Error(_0x1fa8fc(0x285));await _0x50c388(_0x3ae2af);const _0xda5220=_0x58e1b9;let _0x428089='';if(_0x356194===_0x4133d9)_0x428089=_0x25b131[_0x1fa8fc(0x1b7)](_0xda5220,_0xda5220+0x4)[_0x1fa8fc(0x23e)]('.');else{if(_0x356194===_0x2f50d)_0x428089=new TextDecoder()['decode'](_0x25b131['slice'](_0xda5220+0x1,_0xda5220+0x1+_0x25b131[_0xda5220]));else _0x356194===_0x37d546&&(_0x428089=_0x25b131[_0x1fa8fc(0x1b7)](_0xda5220,_0xda5220+0x10)[_0x1fa8fc(0x2a8)]((_0x40dadd,_0x2dd95f,_0x2e77d8,_0x8f6cb7)=>_0x2e77d8%0x2?_0x40dadd[_0x1fa8fc(0x259)](((_0x8f6cb7[_0x2e77d8-0x1]<<0x8)+_0x2dd95f)[_0x1fa8fc(0x1ad)](0x10)):_0x40dadd,[])['join'](':'));}if(!_0x428089){log('error',_0x1fa8fc(0x262));throw new Error(_0x1fa8fc(0x2a3));}return log(_0x1fa8fc(0x20a),'VLESS\x20connection\x20to\x20'+_0x428089+':'+_0x3ed737),{'hostname':_0x428089,'port':_0x3ed737,'data':_0x25b131['slice'](_0x3ae2af),'resp':new Uint8Array([_0x48b054,0x0])};}async function read_atleast(_0x5eb6fe,_0x3edd6d){const _0x524d7d=_0xe1517d,_0x2a595f=[];let _0x17caab=![];while(_0x3edd6d>0x0&&!_0x17caab){const _0x2b13e6=await _0x5eb6fe[_0x524d7d(0x284)]();if(_0x2b13e6[_0x524d7d(0x200)]){const _0x153475=new Uint8Array(_0x2b13e6[_0x524d7d(0x200)]);_0x2a595f[_0x524d7d(0x1d9)](_0x153475),_0x3edd6d-=_0x153475[_0x524d7d(0x26e)];}_0x17caab=_0x2b13e6['done'];}if(_0x3edd6d>0x0)throw new Error(_0x524d7d(0x21e));return{'value':concat_typed_arrays(..._0x2a595f),'done':_0x17caab};}async function parse_header(_0x52e445,_0x1e35d0){const _0x355810=_0xe1517d;log(_0x355810(0x2ae),_0x355810(0x1d8));const _0x1708c3=_0x1e35d0[_0x355810(0x20c)][_0x355810(0x298)]();try{const _0x2aa6e2=await read_vless_header(_0x1708c3,_0x52e445);return log(_0x355810(0x2ae),_0x355810(0x25d)),_0x2aa6e2;}catch(_0x5565a9){log(_0x355810(0x23a),'VLESS\x20header\x20parse\x20error:\x20'+_0x5565a9[_0x355810(0x29c)]);throw new Error(_0x355810(0x24d)+_0x5565a9[_0x355810(0x29c)]);}finally{_0x1708c3['releaseLock']();}}async function connect_remote(_0xa3dcb9,_0x4aecd9){const _0x29424c=_0xe1517d,_0x279126=0x1f40;try{const _0xf0ffe6=await timed_connect(_0xa3dcb9,_0x4aecd9,_0x279126);return _0xf0ffe6[_0x29424c(0x2b1)](!![]),_0xf0ffe6[_0x29424c(0x1f0)](!![],0x3e8),_0xf0ffe6[_0x29424c(0x1b1)]=parseInt(SETTINGS['BUFFER_SIZE'])*0x400,log(_0x29424c(0x20a),_0x29424c(0x27d)+_0xa3dcb9+':'+_0x4aecd9),_0xf0ffe6;}catch(_0x475c62){log('error',_0x29424c(0x1db)+_0x475c62[_0x29424c(0x29c)]);throw _0x475c62;}}function timed_connect(_0xa2b53b,_0x252b34,_0x54b3f5){return new Promise((_0x5cab67,_0x263819)=>{const _0x59c89d=_0xbe56,_0x5e8265=net[_0x59c89d(0x247)]({'host':_0xa2b53b,'port':_0x252b34}),_0x2d2dc2=setTimeout(()=>{const _0x16f79c=_0x59c89d;_0x263819(new Error(_0x16f79c(0x1fd)));},_0x54b3f5);_0x5e8265['on'](_0x59c89d(0x1b3),()=>{clearTimeout(_0x2d2dc2),_0x5cab67(_0x5e8265);}),_0x5e8265['on']('error',_0x10cb53=>{clearTimeout(_0x2d2dc2),_0x263819(_0x10cb53);});});}function pipe_relay(){async function _0x3db8f0(_0x199bd2,_0x1065b0,_0x33e447){const _0xf89715=_0xbe56,_0x2c0503=parseInt(SETTINGS[_0xf89715(0x215)]);if(_0x33e447['length']>0x0){if(_0x1065b0[_0xf89715(0x1e6)])_0x1065b0[_0xf89715(0x288)](),_0x1065b0[_0xf89715(0x1e6)](_0x33e447),process[_0xf89715(0x1b6)](()=>_0x1065b0[_0xf89715(0x232)]());else{const _0x40f1eb=_0x1065b0[_0xf89715(0x1d5)][_0xf89715(0x219)]();try{await _0x40f1eb[_0xf89715(0x1e6)](_0x33e447);}finally{_0x40f1eb['releaseLock']();}}}try{_0x199bd2[_0xf89715(0x1ac)]?(_0x199bd2[_0xf89715(0x291)](),_0x199bd2[_0xf89715(0x1ac)](_0x1065b0,{'end':!![],'highWaterMark':_0x2c0503}),_0x199bd2[_0xf89715(0x1d2)]()):await _0x199bd2[_0xf89715(0x20c)][_0xf89715(0x24f)](_0x1065b0[_0xf89715(0x1d5)],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal['timeout'](SETTINGS[_0xf89715(0x28b)])});}catch(_0x317c50){!_0x317c50[_0xf89715(0x29c)]['includes'](_0xf89715(0x256))&&log(_0xf89715(0x23a),_0xf89715(0x25f),_0x317c50[_0xf89715(0x29c)]);throw _0x317c50;}}return _0x3db8f0;}function socketToWebStream(_0x59e7b6){const _0x452e95=_0xe1517d;let _0x1b3f2b,_0x3d2c6b;return _0x59e7b6['on'](_0x452e95(0x23a),_0x1535c3=>{const _0x46aa7d=_0x452e95;log(_0x46aa7d(0x23a),'Socket\x20error:',_0x1535c3[_0x46aa7d(0x29c)]),_0x1b3f2b?.[_0x46aa7d(0x23a)](_0x1535c3),_0x3d2c6b?.['error'](_0x1535c3);}),{'readable':new ReadableStream({'start'(_0xdede0a){const _0x102f74=_0x452e95;_0x1b3f2b=_0xdede0a,_0x59e7b6['on']('data',_0x1dcd1d=>{const _0x25036c=_0xbe56;try{_0xdede0a[_0x25036c(0x1e2)](_0x1dcd1d);}catch(_0x3e92fb){log(_0x25036c(0x23a),_0x25036c(0x27f),_0x3e92fb[_0x25036c(0x29c)]);}}),_0x59e7b6['on'](_0x102f74(0x1e9),()=>{const _0x53928d=_0x102f74;try{_0xdede0a[_0x53928d(0x23d)]();}catch(_0x40a684){log(_0x53928d(0x23a),_0x53928d(0x1c7),_0x40a684[_0x53928d(0x29c)]);}});},'cancel'(){const _0x335e78=_0x452e95;_0x59e7b6[_0x335e78(0x22b)]();}}),'writable':new WritableStream({'start'(_0x2b1f11){_0x3d2c6b=_0x2b1f11;},'write'(_0x4a335c){return new Promise((_0x2bdab0,_0x25268c)=>{const _0x3ff9b6=_0xbe56;if(_0x59e7b6[_0x3ff9b6(0x282)]){_0x25268c(new Error('Socket\x20is\x20destroyed'));return;}_0x59e7b6[_0x3ff9b6(0x1e6)](_0x4a335c,_0x41035f=>{if(_0x41035f)_0x25268c(_0x41035f);else _0x2bdab0();});});},'close'(){const _0x5959f4=_0x452e95;!_0x59e7b6['destroyed']&&_0x59e7b6[_0x5959f4(0x1e9)]();},'abort'(_0x4d530e){_0x59e7b6['destroy'](_0x4d530e);}})};}function relay(_0x428af9,_0x435d8c,_0x6f9f05,_0xdc4700){const _0x46403d=_0xe1517d,_0x354306=pipe_relay();let _0x122d09=![];const _0x51e92a=socketToWebStream(_0x6f9f05);function _0x1746a7(){const _0x3e5f93=_0xbe56;if(!_0x122d09){_0x122d09=!![];try{_0x6f9f05[_0x3e5f93(0x22b)]();}catch(_0x11cc36){!_0x11cc36[_0x3e5f93(0x29c)][_0x3e5f93(0x1af)](_0x3e5f93(0x256))&&!_0x11cc36[_0x3e5f93(0x29c)][_0x3e5f93(0x1af)]('socket\x20hang\x20up')&&log(_0x3e5f93(0x23a),_0x3e5f93(0x22c)+_0x11cc36[_0x3e5f93(0x29c)]);}}}const _0x1879f8=_0x354306(_0x435d8c,_0x51e92a,_0xdc4700['data'])['catch'](_0x55df05=>{const _0x3ca2d8=_0xbe56;!_0x55df05[_0x3ca2d8(0x29c)][_0x3ca2d8(0x1af)](_0x3ca2d8(0x256))&&!_0x55df05[_0x3ca2d8(0x29c)]['includes'](_0x3ca2d8(0x276))&&log(_0x3ca2d8(0x23a),_0x3ca2d8(0x1d1)+_0x55df05[_0x3ca2d8(0x29c)]);})['finally'](()=>{const _0x4abc4f=_0xbe56;_0x435d8c['reading_done']&&_0x435d8c[_0x4abc4f(0x226)]();}),_0x145475=_0x354306(_0x51e92a,_0x435d8c,_0xdc4700[_0x46403d(0x241)])['catch'](_0x335ae7=>{const _0x545500=_0x46403d;!_0x335ae7[_0x545500(0x29c)][_0x545500(0x1af)](_0x545500(0x256))&&!_0x335ae7[_0x545500(0x29c)][_0x545500(0x1af)](_0x545500(0x276))&&log(_0x545500(0x23a),_0x545500(0x1cd)+_0x335ae7[_0x545500(0x29c)]);});_0x145475[_0x46403d(0x205)](()=>_0x1879f8)[_0x46403d(0x205)](_0x1746a7);}const sessions=new Map();class Session{constructor(_0x1ba15b){const _0x5ef5f2=_0xe1517d;this['uuid']=_0x1ba15b,this[_0x5ef5f2(0x1fe)]=0x0,this['downstreamStarted']=![],this[_0x5ef5f2(0x1bc)]=Date[_0x5ef5f2(0x27c)](),this[_0x5ef5f2(0x221)]=null,this['remote']=null,this[_0x5ef5f2(0x233)]=![],this[_0x5ef5f2(0x1b0)]=null,this[_0x5ef5f2(0x283)]=![],this[_0x5ef5f2(0x224)]=new Map(),this[_0x5ef5f2(0x29f)]=![],this[_0x5ef5f2(0x295)]=[],this['currentStreamRes']=null,this[_0x5ef5f2(0x253)]=new Map(),log(_0x5ef5f2(0x2ae),'Created\x20new\x20session\x20with\x20UUID:\x20'+_0x1ba15b);}async['initializeVLESS'](_0x215387){const _0x6cab2d=_0xe1517d;if(this[_0x6cab2d(0x233)])return!![];try{log('debug','Initializing\x20VLESS\x20connection\x20from\x20first\x20packet');const _0x352a2e=new ReadableStream({'start'(_0x2677e1){const _0x296e6b=_0x6cab2d;_0x2677e1[_0x296e6b(0x1e2)](_0x215387),_0x2677e1[_0x296e6b(0x23d)]();}}),_0x1c5f2e={'readable':_0x352a2e,'writable':new WritableStream()};return this[_0x6cab2d(0x221)]=await parse_header(SETTINGS['UUID'],_0x1c5f2e),log(_0x6cab2d(0x20a),'VLESS\x20header\x20parsed:\x20'+this['vlessHeader'][_0x6cab2d(0x249)]+':'+this['vlessHeader']['port']),this[_0x6cab2d(0x220)]=await connect_remote(this[_0x6cab2d(0x221)][_0x6cab2d(0x249)],this[_0x6cab2d(0x221)][_0x6cab2d(0x228)]),log(_0x6cab2d(0x20a),_0x6cab2d(0x250)),this[_0x6cab2d(0x233)]=!![],!![];}catch(_0x1d909b){return log(_0x6cab2d(0x23a),_0x6cab2d(0x20d)+_0x1d909b[_0x6cab2d(0x29c)]),![];}}async['processPacket'](_0x13a9b5,_0x2ca3cf){const _0x496d03=_0xe1517d;try{this[_0x496d03(0x253)]['set'](_0x13a9b5,_0x2ca3cf),log(_0x496d03(0x2ae),_0x496d03(0x2b0)+_0x13a9b5+_0x496d03(0x25a)+_0x2ca3cf[_0x496d03(0x26e)]);while(this[_0x496d03(0x253)][_0x496d03(0x1bd)](this['nextSeq'])){const _0x49acf1=this['pendingBuffers']['get'](this[_0x496d03(0x1fe)]);this['pendingBuffers'][_0x496d03(0x260)](this['nextSeq']);if(!this['initialized']&&this[_0x496d03(0x1fe)]===0x0){if(!await this[_0x496d03(0x274)](_0x49acf1))throw new Error('Failed\x20to\x20initialize\x20VLESS\x20connection');this[_0x496d03(0x1b0)]=Buffer[_0x496d03(0x2a6)](this[_0x496d03(0x221)]['resp']),await this['_writeToRemote'](this[_0x496d03(0x221)]['data']),this[_0x496d03(0x294)]&&this[_0x496d03(0x2ab)]();}else{if(!this[_0x496d03(0x233)]){log(_0x496d03(0x1f6),'Received\x20out\x20of\x20order\x20packet\x20seq='+_0x13a9b5+_0x496d03(0x1ca));continue;}await this[_0x496d03(0x2a2)](_0x49acf1);}this[_0x496d03(0x1fe)]++,log('debug',_0x496d03(0x1ff)+(this[_0x496d03(0x1fe)]-0x1));}if(this['pendingBuffers'][_0x496d03(0x206)]>SETTINGS[_0x496d03(0x1ba)])throw new Error('Too\x20many\x20buffered\x20packets');return!![];}catch(_0x2f3bcb){log(_0x496d03(0x23a),_0x496d03(0x243)+_0x2f3bcb[_0x496d03(0x29c)]);throw _0x2f3bcb;}}['_startDownstreamResponse'](){const _0x35a92e=_0xe1517d;if(!this[_0x35a92e(0x294)]||!this[_0x35a92e(0x1b0)])return;try{const _0x3fa265=this[_0x35a92e(0x294)][_0x35a92e(0x21f)]?.[_0x35a92e(0x22a)]||_0x35a92e(0x26f),_0x551bfa=_0x3fa265==='h2';!this['headerSent']&&(log(_0x35a92e(0x2ae),_0x35a92e(0x270)+_0x3fa265+_0x35a92e(0x229)+this[_0x35a92e(0x1b0)][_0x35a92e(0x26e)]+_0x35a92e(0x245)),this['currentStreamRes']['write'](this[_0x35a92e(0x1b0)]),this[_0x35a92e(0x283)]=!![]);if(_0x551bfa){this[_0x35a92e(0x294)]['socket'][_0x35a92e(0x2b1)](!![]);const _0x2a17f0=new require(_0x35a92e(0x1ef))[_0x35a92e(0x1dd)]({'transform'(_0x99a01,_0x7dd46d,_0x28011f){const _0x3ffaa9=_0x35a92e,_0x32fed5=0x4000;for(let _0x2fdc7a=0x0;_0x2fdc7a<_0x99a01[_0x3ffaa9(0x26e)];_0x2fdc7a+=_0x32fed5){this[_0x3ffaa9(0x1d9)](_0x99a01[_0x3ffaa9(0x1b7)](_0x2fdc7a,_0x2fdc7a+_0x32fed5));}_0x28011f();}});this[_0x35a92e(0x220)]['pipe'](_0x2a17f0)[_0x35a92e(0x1ac)](this[_0x35a92e(0x294)]);}else this['remote'][_0x35a92e(0x1ac)](this[_0x35a92e(0x294)]);this[_0x35a92e(0x220)]['on'](_0x35a92e(0x1e9),()=>{const _0x5abe22=_0x35a92e;!this[_0x5abe22(0x294)][_0x5abe22(0x1e3)]&&this[_0x5abe22(0x294)][_0x5abe22(0x1e9)]();}),this['remote']['on'](_0x35a92e(0x23a),_0x5c29c4=>{const _0x204915=_0x35a92e;log(_0x204915(0x23a),_0x204915(0x1d6)+_0x5c29c4['message']),!this[_0x204915(0x294)][_0x204915(0x1e3)]&&this[_0x204915(0x294)][_0x204915(0x1e9)]();});}catch(_0x19605d){log(_0x35a92e(0x23a),_0x35a92e(0x1da)+_0x19605d[_0x35a92e(0x29c)]),this[_0x35a92e(0x2aa)]();}}[_0xe1517d(0x1be)](_0x2e33d9,_0x5ba168){const _0x251b6e=_0xe1517d;return!_0x2e33d9[_0x251b6e(0x266)]&&_0x2e33d9[_0x251b6e(0x1c3)](0xc8,_0x5ba168),this['currentStreamRes']=_0x2e33d9,this[_0x251b6e(0x233)]&&this[_0x251b6e(0x1b0)]&&this[_0x251b6e(0x2ab)](),_0x2e33d9['on']('close',()=>{const _0x11cbc3=_0x251b6e;log(_0x11cbc3(0x20a),'Client\x20connection\x20closed'),this[_0x11cbc3(0x2aa)]();}),!![];}async[_0xe1517d(0x2a2)](_0x511e5e){const _0x5f3be2=_0xe1517d;if(!this[_0x5f3be2(0x220)]||this[_0x5f3be2(0x220)][_0x5f3be2(0x282)])throw new Error(_0x5f3be2(0x218));return new Promise((_0x45479e,_0x310dfe)=>{const _0x3c6c22=_0x5f3be2;this[_0x3c6c22(0x220)]['write'](_0x511e5e,_0xf19b77=>{const _0x1ac82c=_0x3c6c22;_0xf19b77?(log('error',_0x1ac82c(0x210)+_0xf19b77[_0x1ac82c(0x29c)]),_0x310dfe(_0xf19b77)):_0x45479e();});});}[_0xe1517d(0x2ab)](){const _0x493580=_0xe1517d;if(!this[_0x493580(0x294)]||!this[_0x493580(0x1b0)])return;try{!this['headerSent']&&(this[_0x493580(0x294)][_0x493580(0x1e6)](this[_0x493580(0x1b0)]),this[_0x493580(0x283)]=!![]),this[_0x493580(0x220)][_0x493580(0x1ac)](this['currentStreamRes']),this[_0x493580(0x220)]['on']('end',()=>{const _0x7727a6=_0x493580;!this[_0x7727a6(0x294)][_0x7727a6(0x1e3)]&&this[_0x7727a6(0x294)]['end']();}),this[_0x493580(0x220)]['on']('error',_0x427e0e=>{const _0x3725aa=_0x493580;log(_0x3725aa(0x23a),_0x3725aa(0x1d6)+_0x427e0e[_0x3725aa(0x29c)]),!this['currentStreamRes']['writableEnded']&&this['currentStreamRes']['end']();});}catch(_0x213a32){log('error','Error\x20starting\x20downstream:\x20'+_0x213a32['message']),this[_0x493580(0x2aa)]();}}[_0xe1517d(0x2aa)](){const _0x2accba=_0xe1517d;!this['cleaned']&&(this['cleaned']=!![],log(_0x2accba(0x2ae),_0x2accba(0x254)+this[_0x2accba(0x204)]),this['remote']&&(this[_0x2accba(0x220)][_0x2accba(0x22b)](),this[_0x2accba(0x220)]=null),this[_0x2accba(0x233)]=![],this[_0x2accba(0x283)]=![]);}}const metaInfo=execSync('curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27',{'encoding':_0xe1517d(0x27e)}),ISP=metaInfo[_0xe1517d(0x24b)]();let IP=DOMAIN;if(!DOMAIN)try{IP=execSync(_0xe1517d(0x26a),{'encoding':_0xe1517d(0x27e)})[_0xe1517d(0x24b)]();}catch(_0xb34e62){try{IP='['+execSync('curl\x20-s\x20--max-time\x201\x20ipv6.ip.sb',{'encoding':_0xe1517d(0x27e)})[_0xe1517d(0x24b)]()+']';}catch(_0x3618d8){log('error',_0xe1517d(0x216),_0x3618d8[_0xe1517d(0x29c)]),IP='localhost';}}const server=http['createServer']((_0x56aa92,_0x2dffe6)=>{const _0x156929=_0xe1517d,_0x9b61fc={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':_0x156929(0x2ac),'Cache-Control':'no-store','X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x56aa92['url']==='/'){_0x2dffe6['writeHead'](0xc8,{'Content-Type':_0x156929(0x21a)}),_0x2dffe6[_0x156929(0x1e9)](_0x156929(0x252));return;}if(_0x56aa92[_0x156929(0x238)]==='/'+SUB_PATH){const _0x4054ac=_0x156929(0x279)+UUID+'@'+IP+':'+PORT+_0x156929(0x267)+IP+_0x156929(0x24a)+IP+_0x156929(0x1f8)+SETTINGS['XPATH']+'&mode=packet-up#'+ISP+'-'+SUB_NAME,_0x3d5638=Buffer[_0x156929(0x2a6)](_0x4054ac)[_0x156929(0x1ad)](_0x156929(0x290));_0x2dffe6[_0x156929(0x1c3)](0xc8,{'Content-Type':_0x156929(0x21a)}),_0x2dffe6[_0x156929(0x1e9)](_0x3d5638+'\x0a');return;}const _0x2e3d37=_0x56aa92['url'][_0x156929(0x23f)](new RegExp(XPATH+'/([^/]+)(?:/([0-9]+))?$'));if(!_0x2e3d37){_0x2dffe6[_0x156929(0x1c3)](0x194),_0x2dffe6[_0x156929(0x1e9)]();return;}const _0x281a53=_0x2e3d37[0x1],_0x378695=_0x2e3d37[0x2]?parseInt(_0x2e3d37[0x2]):null;if(_0x56aa92['method']==='GET'&&!_0x378695){_0x9b61fc[_0x156929(0x207)]='application/octet-stream',_0x9b61fc[_0x156929(0x225)]=_0x156929(0x201);let _0x179939=sessions[_0x156929(0x1fa)](_0x281a53);!_0x179939&&(_0x179939=new Session(_0x281a53),sessions[_0x156929(0x273)](_0x281a53,_0x179939),log('info',_0x156929(0x235)+_0x281a53));_0x179939[_0x156929(0x211)]=!![];!_0x179939['startDownstream'](_0x2dffe6,_0x9b61fc)&&(log('error',_0x156929(0x208)+_0x281a53),!_0x2dffe6[_0x156929(0x266)]&&(_0x2dffe6[_0x156929(0x1c3)](0x1f4),_0x2dffe6[_0x156929(0x1e9)]()),_0x179939[_0x156929(0x2aa)](),sessions[_0x156929(0x260)](_0x281a53));return;}if(_0x56aa92[_0x156929(0x21c)]==='POST'&&_0x378695!==null){let _0x5d1dc0=sessions[_0x156929(0x1fa)](_0x281a53);!_0x5d1dc0&&(_0x5d1dc0=new Session(_0x281a53),sessions[_0x156929(0x273)](_0x281a53,_0x5d1dc0),log('info',_0x156929(0x1c9)+_0x281a53),setTimeout(()=>{const _0x16a1ac=_0x156929,_0x25221f=sessions['get'](_0x281a53);_0x25221f&&!_0x25221f[_0x16a1ac(0x211)]&&(log(_0x16a1ac(0x1f6),_0x16a1ac(0x222)+_0x281a53+_0x16a1ac(0x255)),_0x25221f[_0x16a1ac(0x2aa)](),sessions[_0x16a1ac(0x260)](_0x281a53));},SETTINGS[_0x156929(0x28b)]));let _0x3b7784=[],_0x2793c6=0x0,_0x287cbb=![];_0x56aa92['on'](_0x156929(0x25b),_0x50569a=>{const _0x4e0d5c=_0x156929;_0x2793c6+=_0x50569a[_0x4e0d5c(0x26e)];if(_0x2793c6>SETTINGS['MAX_POST_SIZE']){!_0x287cbb&&(_0x2dffe6[_0x4e0d5c(0x1c3)](0x19d),_0x2dffe6[_0x4e0d5c(0x1e9)](),_0x287cbb=!![]);return;}_0x3b7784[_0x4e0d5c(0x1d9)](_0x50569a);}),_0x56aa92['on'](_0x156929(0x1e9),async()=>{const _0x37b171=_0x156929;if(_0x287cbb)return;try{const _0x4bfc76=Buffer[_0x37b171(0x259)](_0x3b7784);log(_0x37b171(0x20a),'Processing\x20packet:\x20seq='+_0x378695+_0x37b171(0x25a)+_0x4bfc76[_0x37b171(0x26e)]),await _0x5d1dc0[_0x37b171(0x1dc)](_0x378695,_0x4bfc76),!_0x287cbb&&(_0x2dffe6['writeHead'](0xc8,_0x9b61fc),_0x287cbb=!![]),_0x2dffe6[_0x37b171(0x1e9)]();}catch(_0x27a6df){log('error','Failed\x20to\x20process\x20POST\x20request:\x20'+_0x27a6df['message']),_0x5d1dc0['cleanup'](),sessions[_0x37b171(0x260)](_0x281a53),!_0x287cbb&&(_0x2dffe6[_0x37b171(0x1c3)](0x1f4),_0x287cbb=!![]),_0x2dffe6[_0x37b171(0x1e9)]();}});return;}_0x2dffe6['writeHead'](0x194),_0x2dffe6['end']();});server['on'](_0xe1517d(0x287),_0x161516=>{const _0x2cd538=_0xe1517d;log(_0x2cd538(0x2ae),'New\x20secure\x20connection\x20using:\x20'+(_0x161516[_0x2cd538(0x22a)]||_0x2cd538(0x26f)));});function generatePadding(_0x6e490e,_0x48f1b0){const _0x350719=_0xe1517d,_0x3097a5=_0x6e490e+Math['floor'](Math[_0x350719(0x1c8)]()*(_0x48f1b0-_0x6e490e));return Buffer[_0x350719(0x2a6)](Array(_0x3097a5)[_0x350719(0x1fb)]('X')['join'](''))[_0x350719(0x1ad)]('base64');}server['keepAliveTimeout']=0x975e0,server[_0xe1517d(0x278)]=0x98968,server['on'](_0xe1517d(0x23a),_0x142af0=>{const _0x149064=_0xe1517d;log(_0x149064(0x23a),'Server\x20error:\x20'+_0x142af0['message']);});async function uploadSubscription(_0x2ad8a0,_0x4c05e8,_0x18f933){const _0x2e9876=_0xe1517d,_0x32998b=JSON[_0x2e9876(0x29b)]({'URL_NAME':_0x2ad8a0,'URL':_0x4c05e8}),_0x16efe2={'hostname':new URL(_0x18f933)[_0x2e9876(0x249)],'port':new URL(_0x18f933)[_0x2e9876(0x228)]||0x1bb,'path':new URL(_0x18f933)['pathname'],'method':_0x2e9876(0x22d),'headers':{'Content-Type':_0x2e9876(0x1b4),'Content-Length':_0x32998b[_0x2e9876(0x26e)]}};try{const _0xb03a26=await new Promise((_0x42902f,_0x43c249)=>{const _0x1cdc44=_0x2e9876,_0x39af67=https[_0x1cdc44(0x2a9)](_0x16efe2,_0x540d92=>{const _0x1665a7=_0x1cdc44;if(_0x540d92[_0x1665a7(0x1f5)]<0xc8||_0x540d92[_0x1665a7(0x1f5)]>=0x12c)return _0x43c249(new Error(_0x1665a7(0x23b)+_0x540d92['statusCode']));let _0xac1b90='';_0x540d92['on'](_0x1665a7(0x25b),_0x28bfa1=>_0xac1b90+=_0x28bfa1),_0x540d92['on']('end',()=>_0x42902f(_0xac1b90));});_0x39af67['on']('error',_0x1593a3=>_0x43c249(_0x1593a3)),_0x39af67[_0x1cdc44(0x1e6)](_0x32998b),_0x39af67[_0x1cdc44(0x1e9)]();});return _0xb03a26;}catch(_0x3bc856){throw new Error('Upload\x20failed:\x20'+_0x3bc856[_0x2e9876(0x29c)]);}}function _0xbe56(_0x375b98,_0x466167){const _0x219bce=_0x219b();return _0xbe56=function(_0xbe561a,_0x404f1c){_0xbe561a=_0xbe561a-0x1ac;let _0x53a3d0=_0x219bce[_0xbe561a];return _0x53a3d0;},_0xbe56(_0x375b98,_0x466167);}async function subupload(){const _0x1014b9=_0xe1517d;UPLOAD_DATA=_0x1014b9(0x279)+UUID+'@'+IP+':'+PORT+_0x1014b9(0x267)+IP+'&fp=chrome&allowInsecure=1&type=xhttp&host='+IP+_0x1014b9(0x1f8)+SETTINGS[_0x1014b9(0x20f)]+_0x1014b9(0x289)+ISP+'-'+SUB_NAME;try{const _0x18d08a=await uploadSubscription(SUB_NAME,UPLOAD_DATA,SUB_URL);}catch(_0x205e44){}}function cleanfiles(){setTimeout(()=>{const _0x17f945=_0xbe56,_0x33173c=[FILE_PATH+_0x17f945(0x272),FILE_PATH+'/config.yml'];_0x33173c[_0x17f945(0x213)](_0x458301=>{const _0x51aad4=_0x17f945;try{fs[_0x51aad4(0x1ec)](_0x458301)&&(fs[_0x51aad4(0x2a7)](_0x458301)['isDirectory']()?fs[_0x51aad4(0x26c)](_0x458301,{'recursive':!![]}):fs[_0x51aad4(0x1b8)](_0x458301));}catch(_0x5af02c){}}),console[_0x17f945(0x28e)](),console[_0x17f945(0x251)](_0x17f945(0x202));},0xea60);}server['listen'](PORT,async()=>{const _0x2a397e=_0xe1517d;createFolder(FILE_PATH),cleanupOldFiles(),NEZHA_VERSION&&NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY&&(await downloadFiles(),await delay(0x1388),await runapp()),cleanfiles(),console['log'](_0x2a397e(0x236)+PORT),log('info',_0x2a397e(0x1bb)),log(_0x2a397e(0x20a),_0x2a397e(0x239)+SETTINGS[_0x2a397e(0x29a)]),log(_0x2a397e(0x20a),_0x2a397e(0x27a)+SETTINGS[_0x2a397e(0x1ba)]),log('info','Max\x20POST\x20size:\x20'+SETTINGS['MAX_POST_SIZE']+'KB'),log(_0x2a397e(0x20a),_0x2a397e(0x1ed)+SETTINGS[_0x2a397e(0x1c1)]+'KB'),log(_0x2a397e(0x20a),'Session\x20timeout:\x20'+SETTINGS[_0x2a397e(0x215)]+_0x2a397e(0x1fc)),log(_0x2a397e(0x20a),_0x2a397e(0x1bb)),SUB_URL&&await subupload();});