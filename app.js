const _0x3931e9=_0x1478;(function(_0x4776bd,_0x4041ec){const _0x42de3a=_0x1478,_0x19ae61=_0x4776bd();while(!![]){try{const _0x510f1b=parseInt(_0x42de3a(0x15d))/0x1+-parseInt(_0x42de3a(0xe2))/0x2+parseInt(_0x42de3a(0xab))/0x3*(parseInt(_0x42de3a(0x94))/0x4)+parseInt(_0x42de3a(0x174))/0x5*(-parseInt(_0x42de3a(0x75))/0x6)+parseInt(_0x42de3a(0x126))/0x7*(-parseInt(_0x42de3a(0xf3))/0x8)+-parseInt(_0x42de3a(0x7b))/0x9*(-parseInt(_0x42de3a(0xfc))/0xa)+parseInt(_0x42de3a(0x90))/0xb*(parseInt(_0x42de3a(0x147))/0xc);if(_0x510f1b===_0x4041ec)break;else _0x19ae61['push'](_0x19ae61['shift']());}catch(_0x19455a){_0x19ae61['push'](_0x19ae61['shift']());}}}(_0x5309,0xaa410));const FILE_PATH=process[_0x3931e9(0xc2)][_0x3931e9(0x172)]||'./.npm',intervalInseconds=process[_0x3931e9(0xc2)][_0x3931e9(0x120)]||0x64,SUB_PATH=process[_0x3931e9(0xc2)][_0x3931e9(0xdc)]||_0x3931e9(0xf4),PORT=process['env'][_0x3931e9(0xb7)]||0xbb8,CFPORT=process[_0x3931e9(0xc2)][_0x3931e9(0x15c)]||0x1bb,CFIP=process[_0x3931e9(0xc2)][_0x3931e9(0x10d)]||'ip.sb',KEEPALIVE=process[_0x3931e9(0xc2)][_0x3931e9(0xef)]||![],SUB_URL=process['env'][_0x3931e9(0xfb)]||'',UUID=process[_0x3931e9(0xc2)][_0x3931e9(0x11f)]||'',XPATH=process[_0x3931e9(0xc2)][_0x3931e9(0x92)]||UUID[_0x3931e9(0xa9)](0x0,0x8),HTTPSTLS=process[_0x3931e9(0xc2)][_0x3931e9(0x6e)]||!![],NEZHA_VERSION=process[_0x3931e9(0xc2)][_0x3931e9(0xd2)]||'V0',NEZHA_SERVER=process['env'][_0x3931e9(0x148)]||'',NEZHA_PORT=process[_0x3931e9(0xc2)][_0x3931e9(0x89)]||'443',NEZHA_KEY=process[_0x3931e9(0xc2)][_0x3931e9(0xd6)]||'',SUB_NAME=process[_0x3931e9(0xc2)]['SUB_NAME']||'',MY_DOMAIN=process[_0x3931e9(0xc2)][_0x3931e9(0x152)]||'',os=require('os'),fs=require('fs'),net=require(_0x3931e9(0x6f)),path=require(_0x3931e9(0x182)),http=require(_0x3931e9(0x9e)),https=require(_0x3931e9(0xc0)),axios=require(_0x3931e9(0x7e)),{pipeline}=require(_0x3931e9(0x165)),{Buffer}=require(_0x3931e9(0x14a)),exec=require('child_process')[_0x3931e9(0x175)],delay=_0xa1ffc5=>new Promise(_0x48dfd6=>setTimeout(_0x48dfd6,_0xa1ffc5)),SETTINGS={[_0x3931e9(0x11f)]:UUID,[_0x3931e9(0x80)]:_0x3931e9(0x164),[_0x3931e9(0xc5)]:'2048',[_0x3931e9(0x92)]:_0x3931e9(0x11b)+XPATH,[_0x3931e9(0x145)]:0x1e,[_0x3931e9(0xcb)]:0xf4240,['SESSION_TIMEOUT']:0x7530,[_0x3931e9(0x96)]:0x400*0x400,['TCP_NODELAY']:!![],['TCP_KEEPALIVE']:!![]};function validate_uuid(_0x1d95ec,_0x3533d0){for(let _0x59d89f=0x0;_0x59d89f<0x10;_0x59d89f++){if(_0x1d95ec[_0x59d89f]!==_0x3533d0[_0x59d89f])return![];}return!![];}function concat_typed_arrays(_0x278cf9,..._0x9a7b8b){const _0x118955=_0x3931e9;if(!_0x9a7b8b||_0x9a7b8b['length']<0x1)return _0x278cf9;let _0x47fc4b=_0x278cf9[_0x118955(0x127)];for(let _0x852cb9 of _0x9a7b8b)_0x47fc4b+=_0x852cb9[_0x118955(0x127)];const _0x4baa4d=new _0x278cf9[(_0x118955(0x17f))](_0x47fc4b);_0x4baa4d[_0x118955(0xff)](_0x278cf9,0x0),_0x47fc4b=_0x278cf9[_0x118955(0x127)];for(let _0x5b6bac of _0x9a7b8b){_0x4baa4d[_0x118955(0xff)](_0x5b6bac,_0x47fc4b),_0x47fc4b+=_0x5b6bac[_0x118955(0x127)];}return _0x4baa4d;}function log(_0x246479,..._0x3ff922){const _0x1f2838=_0x3931e9;if(SETTINGS[_0x1f2838(0x80)]===_0x1f2838(0x164))return;const _0x213f0a={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x199579={'debug':_0x1f2838(0x91),'info':_0x1f2838(0xc7),'warn':'\x1b[33m','error':_0x1f2838(0xad),'reset':_0x1f2838(0xba)},_0x3771a2=_0x213f0a[SETTINGS[_0x1f2838(0x80)]]||0x1,_0x5a6440=_0x213f0a[_0x246479]||0x0;if(_0x5a6440>=_0x3771a2){const _0x183e73=new Date()[_0x1f2838(0xa7)](),_0x4be33b=_0x199579[_0x246479]||_0x199579[_0x1f2838(0x17a)];console['log'](_0x4be33b+'['+_0x183e73+_0x1f2838(0xdb)+_0x246479+']',..._0x3ff922,_0x199579[_0x1f2838(0x17a)]);}}function cleanupOldFiles(){const _0x297cfc=_0x3931e9;try{fs[_0x297cfc(0xa3)](path['join'](FILE_PATH))?(fs['rmSync'](path[_0x297cfc(0x146)](FILE_PATH),{'recursive':!![]}),console[_0x297cfc(0x134)](FILE_PATH+_0x297cfc(0x77))):console[_0x297cfc(0x134)](FILE_PATH+'\x20not\x20created');}catch(_0x12cf73){console['log'](_0x297cfc(0x109)+FILE_PATH);}}function createFolder(_0x2b04aa){const _0x30de9d=_0x3931e9;!fs[_0x30de9d(0xa3)](_0x2b04aa)?(fs[_0x30de9d(0xf6)](_0x2b04aa),console[_0x30de9d(0x134)](_0x2b04aa+'\x20is\x20created')):console['log'](_0x2b04aa+'\x20already\x20exists');}function _0x5309(){const _0xd4e178=['lastActivity','GET,\x20POST','%2F','lstatSync','New\x20secure\x20connection\x20using:\x20','now','UUID','TIME','Content-Type','Empowerment\x20success\x20for\x20','pause','VLESS\x20header\x20parsed\x20successfully','socket','7KpKfIj','length','aarch64','method','\x20-p\x20','replace','headersTimeout','Processing\x20packet:\x20seq=','end','Failed\x20to\x20initialize\x20VLESS\x20connection','getWriter','unsupported\x20command:\x20','initialized','error','log','Kill\x20failed:\x20','forEach','createServer','cmd','Too\x20many\x20buffered\x20packets','connect\x20timeout','2087',',\x20response:\x20','Received\x20out\x20of\x20order\x20packet\x20seq=','fileUrl','uncork','read\x20vless\x20header\x20error:\x20','Command\x20failed:\x20','header\x20length\x20too\x20short',':\x20755','_writeToRemote','MAX_BUFFERED_POSTS','join','5748PMbAMx','NEZHA_SERVER','catch','buffer','info','Can\x27t\x20find\x20a\x20file\x20for\x20the\x20current\x20architecture','connect','Failed\x20to\x20process\x20POST\x20request:\x20','Remote\x20connection\x20established','true','destroyed','MY_DOMAIN','application/octet-stream','\x20--report-delay=4\x20--skip-conn\x20--skip-procs\x20--disable-auto-update\x20>/dev/null\x202>&1\x20&','Download\x20error:\x20','match','aborted','https://github.com/mytcgd/myfiles/releases/download/main/nezha-agentv1','map','read\x20address\x20type\x20failed','getReader','CFPORT','181129GrMhWf','\x20running\x20error:\x20','Cleanup\x20error:\x20','headersSent','floor','&path=','Socket\x20error:','none','stream/promises','get','value','name','ps\x20-eo\x20pid,comm\x20|\x20awk\x20-v\x20name=\x22','setKeepAlive','replaceAll','HTTP\x20error!\x20status:\x20','Remote\x20error:\x20','):\x20','statusMessage','\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20','Transfer-Encoding','FILE_PATH','amd','1165RMPcds','exec','Download\x20','2083','Transform','bufferedData','reset','resp','nextSeq','cleaned','readable','constructor','currentStreamRes','timeout','path','Sending\x20VLESS\x20response\x20header\x20(','uuid','HTTPSTLS','net','reduce','--tls','keepAliveTimeout','push',',\x20size=','24324AaIlWD','Created\x20new\x20session\x20for\x20GET:\x20','\x20deleted','Process\x20\x27','&mode=packet-up#','setNoDelay','3429hnNOzw','Buffered\x20packet\x20seq=','Read\x20controller\x20close\x20error:','axios','hostname','LOG_LEVEL','headerSent',')\x20failed:\x20','https://github.com/mytcgd/myfiles/releases/download/main/nezha-agentv1_arm','pgrep\x20-x\x20\x22','createConnection','https://github.com/kahunama/myfile/releases/download/main/nezha-agent','Socket\x20is\x20destroyed','pgrep','NEZHA_PORT','finally','reading_done','_startDownstreamResponse','stderr','VLESS\x20header\x20parsed:\x20','\x20bytes','47993LatPZJ','\x1b[36m','XPATH','stream','800PTBLic','destroy','CHUNK_SIZE','alpnProtocol','isDirectory','tmp','delete','app','downstreamStarted','pathname','http','writableEnded','?encryption=none&security=none&sni=','secureConnection','&fp=chrome&allowInsecure=1&type=xhttp&host=','existsSync','asOrganization',')\x20successfully','responseHeader','toISOString','SESSION_TIMEOUT','slice','processPacket','14802WdDcXf','code','\x1b[31m','concat','app\x20file\x20not\x20found,\x20skip\x20running','Process\x20packet\x20error:\x20','http/1.1','write','unlinkSync','originalName','/([^/]+)(?:/([0-9]+))?$','rmSync','PORT','Processed\x20packet\x20seq=','\x27\x20not\x20found','\x1b[0m','clientIp','https://github.com/kahunama/myfile/releases/download/main/nezha-agent_arm','Attempting\x20to\x20kill\x20process:\x20','VLESS\x20connection\x20to\x20','Upload\x20failed:','https','from','env','upload\x20failed:','\x20(renamed\x20to\x20','BUFFER_SIZE','decode','\x1b[32m','nohup\x20','arm64','Failed\x20to\x20start\x20downstream\x20for\x20session:\x20','MAX_POST_SIZE','close','toString','trim','parse','done','Empowerment\x20failed\x20for\x20','NEZHA_VERSION','writeHead','substr','pipe','NEZHA_KEY','/config.yml','debug','chunked','Relay\x20error:',']\x20[','SUB_PATH','Initializing\x20VLESS\x20connection\x20from\x20first\x20packet','no-store','nextTick','\x20error:','\x20timed\x20out\x20without\x20downstream','2731974BRkeCU','statusCode','initializeVLESS','request','POST','speed.cloudflare.com','port','remote','includes','Client\x20connection\x20closed','application/json;\x20charset=utf-8','vlessHeader','Failed\x20to\x20initialize\x20VLESS:\x20','KEEPALIVE','warn','App\x20is\x20running','fileName','6918488aqYtDE','sub','startDownstream','mkdirSync','\x20-s\x20','Error\x20downloading\x20files:','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789','arm','SUB_URL','16140bDyDyT','charAt','url','set','all','cleanup','message','Can\x27t\x20determine\x20system\x20architecture.','pendingBuffers','random','vless://','Connected\x20to\x20','kill\x20-9\x20','unable\x20to\x20rm\x20','socket\x20hang\x20up','Server\x20error:\x20','clear','CFIP','text/plain','?encryption=none&security=tls&sni=','base64','bufferSize','Hello,\x20World\x0a','enqueue','releaseLock','pipeTo','data','utf8','stringify'];_0x5309=function(){return _0xd4e178;};return _0x5309();}function execPromise(_0x52bb92,_0x3aae0a={}){return new Promise((_0x5bea23,_0x27891d)=>{const _0x3e12a7=exec(_0x52bb92,_0x3aae0a,(_0xbdc576,_0x4f0ce7,_0x5edf3d)=>{const _0x190415=_0x1478;if(_0xbdc576){const _0x38ed2e=new Error(_0x190415(0x141)+_0xbdc576[_0x190415(0x102)]);_0x38ed2e[_0x190415(0xac)]=_0xbdc576[_0x190415(0xac)],_0x38ed2e[_0x190415(0x8d)]=_0x5edf3d[_0x190415(0xce)](),_0x27891d(_0x38ed2e);}else _0x5bea23(_0x4f0ce7['trim']());});});}async function detectProcess(_0x385e93){const _0x182233=_0x3931e9,_0x268361=[{'cmd':'pidof\x20\x22'+_0x385e93+'\x22','name':'pidof'},{'cmd':_0x182233(0x84)+_0x385e93+'\x22','name':_0x182233(0x88)},{'cmd':_0x182233(0x169)+_0x385e93+'\x22\x20\x27$2\x20==\x20name\x20{print\x20$1}\x27','name':'ps+awk'}];for(const _0x3a085b of _0x268361){try{const _0x358d48=await execPromise(_0x3a085b[_0x182233(0x138)]);if(_0x358d48)return _0x358d48[_0x182233(0x12b)](/\n/g,'\x20')[_0x182233(0xce)]();}catch(_0x216b59){_0x216b59[_0x182233(0xac)]!==0x7f&&_0x216b59[_0x182233(0xac)]!==0x1&&console[_0x182233(0xd8)]('[detectProcess]\x20'+_0x3a085b[_0x182233(0x168)]+_0x182233(0xe0),_0x216b59[_0x182233(0x102)]);}}return'';}async function killProcess(_0x511068){const _0x4f0f00=_0x3931e9;console[_0x4f0f00(0x134)](_0x4f0f00(0xbd)+_0x511068);try{const _0x128f92=await detectProcess(_0x511068);if(!_0x128f92)return console[_0x4f0f00(0xf0)](_0x4f0f00(0x78)+_0x511068+_0x4f0f00(0xb9)),{'success':!![],'message':'Process\x20not\x20found'};await execPromise(_0x4f0f00(0x108)+_0x128f92);const _0x288efb='Killed\x20process\x20(PIDs:\x20'+_0x128f92+')';return console['log'](_0x288efb),{'success':!![],'message':_0x288efb};}catch(_0x4831e7){const _0x220077=_0x4f0f00(0x135)+_0x4831e7[_0x4f0f00(0x102)];return console[_0x4f0f00(0x133)](_0x220077),{'success':![],'message':_0x220077};}}function generateRandomString(_0x22b986){const _0x169f3e=_0x3931e9,_0xc8eeaf=_0x169f3e(0xf9);let _0x57d9f1='';for(let _0x27414b=0x0;_0x27414b<_0x22b986;_0x27414b++){_0x57d9f1+=_0xc8eeaf[_0x169f3e(0xfd)](Math[_0x169f3e(0x161)](Math[_0x169f3e(0x105)]()*_0xc8eeaf['length']));}return _0x57d9f1;}function _0x1478(_0x25a09b,_0x4ccca5){const _0x530974=_0x5309();return _0x1478=function(_0x147868,_0x56eddc){_0x147868=_0x147868-0x6c;let _0x5ba5a2=_0x530974[_0x147868];return _0x5ba5a2;},_0x1478(_0x25a09b,_0x4ccca5);}function getSystemArchitecture(){const _0x29ec53=_0x3931e9,_0x42046f=os['arch']();return _0x42046f===_0x29ec53(0xfa)||_0x42046f===_0x29ec53(0xc9)||_0x42046f===_0x29ec53(0x128)?_0x29ec53(0xfa):_0x29ec53(0x173);}function getFilesForArchitecture(_0x3aca3d){const _0x37d4b9=_0x3931e9,_0x1d9966={'app':{'V0':{'arm':_0x37d4b9(0xbc),'amd':_0x37d4b9(0x86)},'V1':{'arm':_0x37d4b9(0x83),'amd':_0x37d4b9(0x158)}}};if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY&&NEZHA_VERSION){const _0x4382f4=[{'fileName':_0x37d4b9(0x99)+generateRandomString(0x5),'originalName':'app','fileUrl':_0x1d9966[_0x37d4b9(0x9b)][NEZHA_VERSION][_0x3aca3d]}];return _0x4382f4;}else return[];}async function download_function(_0x39d76d,_0x1b392f,_0x389e36){const _0x1c7b69=_0x3931e9,_0x38cc65=path[_0x1c7b69(0x146)](FILE_PATH,_0x39d76d);let _0x287cc6=![];try{const _0x2d47d2=await axios({'method':_0x1c7b69(0x166),'url':_0x389e36,'responseType':_0x1c7b69(0x93)});await pipeline(_0x2d47d2[_0x1c7b69(0x116)],fs['createWriteStream'](_0x38cc65)),console['log']('Download\x20'+_0x1b392f+_0x1c7b69(0xc4)+_0x39d76d+_0x1c7b69(0xa5)),_0x287cc6=!![];}catch(_0x454eb4){console[_0x1c7b69(0x134)](_0x1c7b69(0x176)+_0x1b392f+'\x20(renamed\x20to\x20'+_0x39d76d+_0x1c7b69(0x82)+_0x454eb4[_0x1c7b69(0x102)]);}return{'fileName':_0x39d76d,'originalName':_0x1b392f,'filePath':_0x38cc65,'success':_0x287cc6};}let fileMapping={};async function downloadFiles(){const _0x27442d=_0x3931e9;try{const _0x4f6264=getSystemArchitecture();if(!_0x4f6264)return console[_0x27442d(0x134)](_0x27442d(0x103)),fileMapping;const _0x44d7af=getFilesForArchitecture(_0x4f6264);if(_0x44d7af['length']===0x0)return console['log'](_0x27442d(0x14c)),fileMapping;const _0x3b14ac=_0x44d7af[_0x27442d(0x159)](_0x765635=>download_function(_0x765635[_0x27442d(0xf2)],_0x765635[_0x27442d(0xb4)],_0x765635[_0x27442d(0x13e)])),_0x3a1df5=await Promise[_0x27442d(0x100)](_0x3b14ac);return _0x3a1df5['forEach'](_0x29ab6e=>{const _0x1aed8a=_0x27442d;if(_0x29ab6e['success'])try{fs['chmodSync'](_0x29ab6e['filePath'],0x1ed),console[_0x1aed8a(0x134)](_0x1aed8a(0x122)+_0x29ab6e[_0x1aed8a(0xf2)]+_0x1aed8a(0x143)),fileMapping[_0x29ab6e[_0x1aed8a(0xb4)]]=_0x29ab6e[_0x1aed8a(0xf2)];}catch(_0x1d763b){console[_0x1aed8a(0xf0)](_0x1aed8a(0xd1)+_0x29ab6e[_0x1aed8a(0xf2)]+':\x20'+_0x1d763b[_0x1aed8a(0x102)]);}}),fileMapping;}catch(_0x13772e){return console[_0x27442d(0x133)](_0x27442d(0xf8),_0x13772e),fileMapping;}}let NEZHA_TLS;function nezconfig(){const _0x26ceeb=_0x3931e9,_0x12ee60=['443','8443','2096',_0x26ceeb(0x13b),_0x26ceeb(0x177),'2053'];if(NEZHA_VERSION==='V0')return _0x12ee60['includes'](NEZHA_PORT)?NEZHA_TLS=_0x26ceeb(0x71):NEZHA_TLS='',NEZHA_TLS;else{if(NEZHA_VERSION==='V1'){_0x12ee60['includes'](NEZHA_PORT)?NEZHA_TLS=_0x26ceeb(0x150):NEZHA_TLS='false';const _0x4dc460=path[_0x26ceeb(0x146)](FILE_PATH,_0x26ceeb(0xd7)),_0x2d1ffc='client_secret:\x20'+NEZHA_KEY+'\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20false\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20'+NEZHA_SERVER+':'+NEZHA_PORT+_0x26ceeb(0x170)+NEZHA_TLS+'\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20'+UUID;try{fs['writeFileSync'](_0x4dc460,_0x2d1ffc),console['log']('config.yml\x20file\x20created\x20and\x20written\x20successfully.');}catch(_0x241bb7){console[_0x26ceeb(0x133)]('Error\x20creating\x20or\x20writing\x20config.yml\x20file:',_0x241bb7);}}}}async function runapp(){const _0x28f5db=_0x3931e9;if(fileMapping['app']&&fs['existsSync'](path['join'](FILE_PATH,fileMapping[_0x28f5db(0x9b)]))){if(NEZHA_VERSION==='V0'){const _0x3ddab5='nohup\x20'+FILE_PATH+'/'+fileMapping['app']+_0x28f5db(0xf7)+NEZHA_SERVER+':'+NEZHA_PORT+_0x28f5db(0x12a)+NEZHA_KEY+'\x20'+NEZHA_TLS+_0x28f5db(0x154);try{await execPromise(_0x3ddab5);}catch(_0x3010d6){console[_0x28f5db(0x133)](fileMapping[_0x28f5db(0x9b)]+_0x28f5db(0x15e)+_0x3010d6);}}else{if(NEZHA_VERSION==='V1'){const _0x2470a3=_0x28f5db(0xc8)+FILE_PATH+'/'+fileMapping[_0x28f5db(0x9b)]+'\x20-c\x20'+FILE_PATH+'/config.yml\x20>/dev/null\x202>&1\x20&';try{await execPromise(_0x2470a3);}catch(_0x4efb43){console[_0x28f5db(0x133)](fileMapping[_0x28f5db(0x9b)]+'\x20running\x20error:\x20'+_0x4efb43);}}}}else console['log'](_0x28f5db(0xaf));}async function run(){const _0x11d59e=_0x3931e9;if(NEZHA_VERSION&&NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){nezconfig();const _0x5ceb7f=await detectProcess(''+fileMapping[_0x11d59e(0x9b)]);if(_0x5ceb7f){}else await runapp();await delay(0x3e8),console['log'](fileMapping[_0x11d59e(0x9b)]+'\x20is\x20running');}else console['log']('app\x20variable\x20is\x20empty,\x20skip\x20running');}async function keep_alive(){const _0x1b19a0=_0x3931e9;if(NEZHA_VERSION&&NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x5a37c1=await detectProcess(''+fileMapping[_0x1b19a0(0x9b)]);if(_0x5a37c1){}else console[_0x1b19a0(0x134)](fileMapping[_0x1b19a0(0x9b)]+'\x20runs\x20again\x20!'),await runapp();}}function parse_uuid(_0x43538e){const _0x53e699=_0x3931e9;_0x43538e=_0x43538e[_0x53e699(0x16b)]('-','');const _0x158fff=[];for(let _0x5630a7=0x0;_0x5630a7<0x10;_0x5630a7++){_0x158fff[_0x53e699(0x73)](parseInt(_0x43538e[_0x53e699(0xd4)](_0x5630a7*0x2,0x2),0x10));}return _0x158fff;}async function read_vless_header(_0x29cd82,_0x4172b7){const _0x492602=_0x3931e9;let _0x5016e9=0x0,_0x4bae3e=new Uint8Array(),_0x1fae7e={'value':_0x4bae3e,'done':![]};async function _0x42aab7(_0x30f8d9){const _0x13f22b=_0x1478;if(_0x1fae7e[_0x13f22b(0xd0)])throw new Error(_0x13f22b(0x142));const _0x419f95=_0x30f8d9-_0x5016e9;if(_0x419f95<0x1)return;_0x1fae7e=await read_atleast(_0x29cd82,_0x419f95),_0x5016e9+=_0x1fae7e[_0x13f22b(0x167)][_0x13f22b(0x127)],_0x4bae3e=concat_typed_arrays(_0x4bae3e,_0x1fae7e['value']);}await _0x42aab7(0x1+0x10+0x1);const _0x24b83a=_0x4bae3e[0x0],_0x561306=_0x4bae3e[_0x492602(0xa9)](0x1,0x1+0x10),_0xcf5c39=parse_uuid(_0x4172b7);if(!validate_uuid(_0x561306,_0xcf5c39))throw new Error('invalid\x20UUID');const _0x4c34bd=_0x4bae3e[0x1+0x10],_0x2ae231=0x1+0x10+0x1+_0x4c34bd+0x1+0x2+0x1;await _0x42aab7(_0x2ae231+0x1);const _0x339978=_0x4bae3e[0x1+0x10+0x1+_0x4c34bd],_0x381dbe=0x1;if(_0x339978!==_0x381dbe)throw new Error(_0x492602(0x131)+_0x339978);const _0x4f2449=(_0x4bae3e[_0x2ae231-0x1-0x2]<<0x8)+_0x4bae3e[_0x2ae231-0x1-0x1],_0x5a867b=_0x4bae3e[_0x2ae231-0x1],_0x8854f5=0x1,_0x261160=0x2,_0x512c30=0x3;let _0x2b3b4d=-0x1;if(_0x5a867b===_0x8854f5)_0x2b3b4d=_0x2ae231+0x4;else{if(_0x5a867b===_0x512c30)_0x2b3b4d=_0x2ae231+0x10;else _0x5a867b===_0x261160&&(_0x2b3b4d=_0x2ae231+0x1+_0x4bae3e[_0x2ae231]);}if(_0x2b3b4d<0x0)throw new Error(_0x492602(0x15a));await _0x42aab7(_0x2b3b4d);const _0x393050=_0x2ae231;let _0x1257ee='';if(_0x5a867b===_0x8854f5)_0x1257ee=_0x4bae3e[_0x492602(0xa9)](_0x393050,_0x393050+0x4)[_0x492602(0x146)]('.');else{if(_0x5a867b===_0x261160)_0x1257ee=new TextDecoder()[_0x492602(0xc6)](_0x4bae3e[_0x492602(0xa9)](_0x393050+0x1,_0x393050+0x1+_0x4bae3e[_0x393050]));else _0x5a867b===_0x512c30&&(_0x1257ee=_0x4bae3e['slice'](_0x393050,_0x393050+0x10)[_0x492602(0x70)]((_0x6587f0,_0x32b032,_0xa4ccdb,_0x36a02f)=>_0xa4ccdb%0x2?_0x6587f0[_0x492602(0xae)](((_0x36a02f[_0xa4ccdb-0x1]<<0x8)+_0x32b032)[_0x492602(0xcd)](0x10)):_0x6587f0,[])['join'](':'));}if(!_0x1257ee){log(_0x492602(0x133),'Failed\x20to\x20parse\x20hostname');throw new Error('parse\x20hostname\x20failed');}return log('info',_0x492602(0xbe)+_0x1257ee+':'+_0x4f2449),{'hostname':_0x1257ee,'port':_0x4f2449,'data':_0x4bae3e[_0x492602(0xa9)](_0x2b3b4d),'resp':new Uint8Array([_0x24b83a,0x0])};}async function read_atleast(_0x1fec91,_0x7b90bf){const _0x522d20=_0x3931e9,_0x53e88f=[];let _0x221161=![];while(_0x7b90bf>0x0&&!_0x221161){const _0x9d8017=await _0x1fec91['read']();if(_0x9d8017[_0x522d20(0x167)]){const _0x334d1e=new Uint8Array(_0x9d8017['value']);_0x53e88f['push'](_0x334d1e),_0x7b90bf-=_0x334d1e[_0x522d20(0x127)];}_0x221161=_0x9d8017['done'];}if(_0x7b90bf>0x0)throw new Error('not\x20enough\x20data\x20to\x20read');return{'value':concat_typed_arrays(..._0x53e88f),'done':_0x221161};}async function parse_header(_0x11abd7,_0x28fd0c){const _0x288e8c=_0x3931e9;log(_0x288e8c(0xd8),'Starting\x20to\x20parse\x20VLESS\x20header');const _0x416a27=_0x28fd0c[_0x288e8c(0x17e)][_0x288e8c(0x15b)]();try{const _0x27a266=await read_vless_header(_0x416a27,_0x11abd7);return log(_0x288e8c(0xd8),_0x288e8c(0x124)),_0x27a266;}catch(_0x19c24b){log(_0x288e8c(0x133),'VLESS\x20header\x20parse\x20error:\x20'+_0x19c24b[_0x288e8c(0x102)]);throw new Error(_0x288e8c(0x140)+_0x19c24b[_0x288e8c(0x102)]);}finally{_0x416a27[_0x288e8c(0x114)]();}}async function connect_remote(_0x39d0ce,_0x55bffe){const _0x5b8a90=_0x3931e9,_0x10943b=0x1f40;try{const _0x555eac=await timed_connect(_0x39d0ce,_0x55bffe,_0x10943b);return _0x555eac[_0x5b8a90(0x7a)](!![]),_0x555eac[_0x5b8a90(0x16a)](!![],0x3e8),_0x555eac[_0x5b8a90(0x111)]=parseInt(SETTINGS[_0x5b8a90(0xc5)])*0x400,log(_0x5b8a90(0x14b),_0x5b8a90(0x107)+_0x39d0ce+':'+_0x55bffe),_0x555eac;}catch(_0x395eb8){log(_0x5b8a90(0x133),'Connection\x20failed:\x20'+_0x395eb8[_0x5b8a90(0x102)]);throw _0x395eb8;}}function timed_connect(_0x34a0fc,_0x35cbf4,_0x351380){return new Promise((_0x2a6330,_0x2d2449)=>{const _0x265823=_0x1478,_0x30cc73=net[_0x265823(0x85)]({'host':_0x34a0fc,'port':_0x35cbf4}),_0xf1dc63=setTimeout(()=>{const _0x2c4963=_0x265823;_0x2d2449(new Error(_0x2c4963(0x13a)));},_0x351380);_0x30cc73['on'](_0x265823(0x14d),()=>{clearTimeout(_0xf1dc63),_0x2a6330(_0x30cc73);}),_0x30cc73['on'](_0x265823(0x133),_0x1865f2=>{clearTimeout(_0xf1dc63),_0x2d2449(_0x1865f2);});});}function pipe_relay(){async function _0x424797(_0x40c956,_0x447530,_0x5bf605){const _0x27b91e=_0x1478,_0x1fc336=parseInt(SETTINGS[_0x27b91e(0x96)]);if(_0x5bf605['length']>0x0){if(_0x447530['write'])_0x447530['cork'](),_0x447530['write'](_0x5bf605),process[_0x27b91e(0xdf)](()=>_0x447530[_0x27b91e(0x13f)]());else{const _0x932a80=_0x447530['writable'][_0x27b91e(0x130)]();try{await _0x932a80[_0x27b91e(0xb2)](_0x5bf605);}finally{_0x932a80[_0x27b91e(0x114)]();}}}try{_0x40c956[_0x27b91e(0xd5)]?(_0x40c956[_0x27b91e(0x123)](),_0x40c956[_0x27b91e(0xd5)](_0x447530,{'end':!![],'highWaterMark':_0x1fc336}),_0x40c956['resume']()):await _0x40c956[_0x27b91e(0x17e)][_0x27b91e(0x115)](_0x447530['writable'],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal[_0x27b91e(0x181)](SETTINGS[_0x27b91e(0xa8)])});}catch(_0x6d333){!_0x6d333[_0x27b91e(0x102)]['includes']('aborted')&&log('error',_0x27b91e(0xda),_0x6d333[_0x27b91e(0x102)]);throw _0x6d333;}}return _0x424797;}function socketToWebStream(_0xa4c987){const _0x23d0c6=_0x3931e9;let _0x57f1d8,_0x512a6b;return _0xa4c987['on'](_0x23d0c6(0x133),_0xe8f59e=>{const _0x25dabe=_0x23d0c6;log('error',_0x25dabe(0x163),_0xe8f59e[_0x25dabe(0x102)]),_0x57f1d8?.[_0x25dabe(0x133)](_0xe8f59e),_0x512a6b?.['error'](_0xe8f59e);}),{'readable':new ReadableStream({'start'(_0x1673a0){const _0x5231ee=_0x23d0c6;_0x57f1d8=_0x1673a0,_0xa4c987['on'](_0x5231ee(0x116),_0x26ffec=>{const _0x31588b=_0x5231ee;try{_0x1673a0[_0x31588b(0x113)](_0x26ffec);}catch(_0x1b9420){log(_0x31588b(0x133),'Read\x20controller\x20error:',_0x1b9420[_0x31588b(0x102)]);}}),_0xa4c987['on']('end',()=>{const _0xc157ec=_0x5231ee;try{_0x1673a0[_0xc157ec(0xcc)]();}catch(_0x337803){log(_0xc157ec(0x133),_0xc157ec(0x7d),_0x337803['message']);}});},'cancel'(){_0xa4c987['destroy']();}}),'writable':new WritableStream({'start'(_0x2ac1fb){_0x512a6b=_0x2ac1fb;},'write'(_0x220750){return new Promise((_0x2b1ba1,_0x336dfd)=>{const _0x12a8a3=_0x1478;if(_0xa4c987[_0x12a8a3(0x151)]){_0x336dfd(new Error(_0x12a8a3(0x87)));return;}_0xa4c987[_0x12a8a3(0xb2)](_0x220750,_0x3fba02=>{if(_0x3fba02)_0x336dfd(_0x3fba02);else _0x2b1ba1();});});},'close'(){const _0x502394=_0x23d0c6;!_0xa4c987[_0x502394(0x151)]&&_0xa4c987['end']();},'abort'(_0x178068){const _0x5544bc=_0x23d0c6;_0xa4c987[_0x5544bc(0x95)](_0x178068);}})};}function relay(_0x293f85,_0x3b84cc,_0x31c6a0,_0x4334bb){const _0x464fd=_0x3931e9,_0x158681=pipe_relay();let _0x4ff001=![];const _0x11fa54=socketToWebStream(_0x31c6a0);function _0x3a9023(){const _0x43e0f9=_0x1478;if(!_0x4ff001){_0x4ff001=!![];try{_0x31c6a0[_0x43e0f9(0x95)]();}catch(_0x4f073d){!_0x4f073d['message'][_0x43e0f9(0xea)](_0x43e0f9(0x157))&&!_0x4f073d[_0x43e0f9(0x102)]['includes']('socket\x20hang\x20up')&&log(_0x43e0f9(0x133),_0x43e0f9(0x15f)+_0x4f073d[_0x43e0f9(0x102)]);}}}const _0x4e3eee=_0x158681(_0x3b84cc,_0x11fa54,_0x4334bb[_0x464fd(0x116)])[_0x464fd(0x149)](_0x4d3f8c=>{const _0xc016a3=_0x464fd;!_0x4d3f8c[_0xc016a3(0x102)][_0xc016a3(0xea)]('aborted')&&!_0x4d3f8c[_0xc016a3(0x102)][_0xc016a3(0xea)]('socket\x20hang\x20up')&&log(_0xc016a3(0x133),'Upload\x20error:\x20'+_0x4d3f8c[_0xc016a3(0x102)]);})[_0x464fd(0x8a)](()=>{const _0x53ed97=_0x464fd;_0x3b84cc[_0x53ed97(0x8b)]&&_0x3b84cc[_0x53ed97(0x8b)]();}),_0x45ba6a=_0x158681(_0x11fa54,_0x3b84cc,_0x4334bb['resp'])[_0x464fd(0x149)](_0x5e897f=>{const _0x24fd03=_0x464fd;!_0x5e897f['message']['includes']('aborted')&&!_0x5e897f[_0x24fd03(0x102)][_0x24fd03(0xea)](_0x24fd03(0x10a))&&log(_0x24fd03(0x133),_0x24fd03(0x155)+_0x5e897f[_0x24fd03(0x102)]);});_0x45ba6a[_0x464fd(0x8a)](()=>_0x4e3eee)[_0x464fd(0x8a)](_0x3a9023);}const sessions=new Map();class Session{constructor(_0x39ad7d){const _0x3ce8a7=_0x3931e9;this['uuid']=_0x39ad7d,this['nextSeq']=0x0,this[_0x3ce8a7(0x9c)]=![],this[_0x3ce8a7(0x119)]=Date[_0x3ce8a7(0x11e)](),this['vlessHeader']=null,this['remote']=null,this[_0x3ce8a7(0x132)]=![],this['responseHeader']=null,this['headerSent']=![],this[_0x3ce8a7(0x179)]=new Map(),this[_0x3ce8a7(0x17d)]=![],this['pendingPackets']=[],this['currentStreamRes']=null,this[_0x3ce8a7(0x104)]=new Map(),log(_0x3ce8a7(0xd8),'Created\x20new\x20session\x20with\x20UUID:\x20'+_0x39ad7d);}async[_0x3931e9(0xe4)](_0x4e90b6){const _0x32c800=_0x3931e9;if(this[_0x32c800(0x132)])return!![];try{log('debug',_0x32c800(0xdd));const _0xce7b0=new ReadableStream({'start'(_0x457a9f){const _0x5d4247=_0x32c800;_0x457a9f[_0x5d4247(0x113)](_0x4e90b6),_0x457a9f[_0x5d4247(0xcc)]();}}),_0xf9d8f8={'readable':_0xce7b0,'writable':new WritableStream()};return this[_0x32c800(0xed)]=await parse_header(SETTINGS[_0x32c800(0x11f)],_0xf9d8f8),log(_0x32c800(0x14b),_0x32c800(0x8e)+this[_0x32c800(0xed)][_0x32c800(0x7f)]+':'+this[_0x32c800(0xed)]['port']),this[_0x32c800(0xe9)]=await connect_remote(this[_0x32c800(0xed)][_0x32c800(0x7f)],this[_0x32c800(0xed)][_0x32c800(0xe8)]),log(_0x32c800(0x14b),_0x32c800(0x14f)),this[_0x32c800(0x132)]=!![],!![];}catch(_0x1b9c81){return log(_0x32c800(0x133),_0x32c800(0xee)+_0x1b9c81[_0x32c800(0x102)]),![];}}async['processPacket'](_0x1064c5,_0x2dfbc2){const _0x328378=_0x3931e9;try{this[_0x328378(0x104)][_0x328378(0xff)](_0x1064c5,_0x2dfbc2),log('debug',_0x328378(0x7c)+_0x1064c5+',\x20size='+_0x2dfbc2[_0x328378(0x127)]);while(this['pendingBuffers']['has'](this[_0x328378(0x17c)])){const _0x59f1a6=this[_0x328378(0x104)][_0x328378(0x166)](this['nextSeq']);this[_0x328378(0x104)][_0x328378(0x9a)](this[_0x328378(0x17c)]);if(!this[_0x328378(0x132)]&&this[_0x328378(0x17c)]===0x0){if(!await this[_0x328378(0xe4)](_0x59f1a6))throw new Error(_0x328378(0x12f));this[_0x328378(0xa6)]=Buffer[_0x328378(0xc1)](this[_0x328378(0xed)][_0x328378(0x17b)]),await this['_writeToRemote'](this[_0x328378(0xed)]['data']),this[_0x328378(0x180)]&&this[_0x328378(0x8c)]();}else{if(!this[_0x328378(0x132)]){log(_0x328378(0xf0),_0x328378(0x13d)+_0x1064c5+'\x20before\x20initialization');continue;}await this[_0x328378(0x144)](_0x59f1a6);}this[_0x328378(0x17c)]++,log(_0x328378(0xd8),_0x328378(0xb8)+(this[_0x328378(0x17c)]-0x1));}if(this[_0x328378(0x104)]['size']>SETTINGS['MAX_BUFFERED_POSTS'])throw new Error(_0x328378(0x139));return!![];}catch(_0xbafb3e){log(_0x328378(0x133),_0x328378(0xb0)+_0xbafb3e[_0x328378(0x102)]);throw _0xbafb3e;}}['_startDownstreamResponse'](){const _0x4fe9d7=_0x3931e9;if(!this['currentStreamRes']||!this[_0x4fe9d7(0xa6)])return;try{const _0x4ad622=this['currentStreamRes'][_0x4fe9d7(0x125)]?.['alpnProtocol']||_0x4fe9d7(0xb1),_0x18fa33=_0x4ad622==='h2';!this[_0x4fe9d7(0x81)]&&(log(_0x4fe9d7(0xd8),_0x4fe9d7(0x6c)+_0x4ad622+_0x4fe9d7(0x16e)+this[_0x4fe9d7(0xa6)][_0x4fe9d7(0x127)]+_0x4fe9d7(0x8f)),this['currentStreamRes'][_0x4fe9d7(0xb2)](this[_0x4fe9d7(0xa6)]),this[_0x4fe9d7(0x81)]=!![]);if(_0x18fa33){this['currentStreamRes']['socket'][_0x4fe9d7(0x7a)](!![]);const _0x237bea=new require(_0x4fe9d7(0x93))[_0x4fe9d7(0x178)]({'transform'(_0x14e631,_0x3b7156,_0x37bc26){const _0x5ecae7=_0x4fe9d7,_0x232668=0x4000;for(let _0x5db95d=0x0;_0x5db95d<_0x14e631[_0x5ecae7(0x127)];_0x5db95d+=_0x232668){this[_0x5ecae7(0x73)](_0x14e631[_0x5ecae7(0xa9)](_0x5db95d,_0x5db95d+_0x232668));}_0x37bc26();}});this['remote'][_0x4fe9d7(0xd5)](_0x237bea)[_0x4fe9d7(0xd5)](this['currentStreamRes']);}else this[_0x4fe9d7(0xe9)][_0x4fe9d7(0xd5)](this['currentStreamRes']);this[_0x4fe9d7(0xe9)]['on'](_0x4fe9d7(0x12e),()=>{const _0x51e26a=_0x4fe9d7;!this[_0x51e26a(0x180)]['writableEnded']&&this[_0x51e26a(0x180)]['end']();}),this['remote']['on'](_0x4fe9d7(0x133),_0x4f7404=>{const _0x40fc0a=_0x4fe9d7;log(_0x40fc0a(0x133),_0x40fc0a(0x16d)+_0x4f7404[_0x40fc0a(0x102)]),!this['currentStreamRes'][_0x40fc0a(0x9f)]&&this[_0x40fc0a(0x180)][_0x40fc0a(0x12e)]();});}catch(_0x5c177f){log(_0x4fe9d7(0x133),'Error\x20starting\x20downstream:\x20'+_0x5c177f[_0x4fe9d7(0x102)]),this['cleanup']();}}[_0x3931e9(0xf5)](_0x1b767d,_0xc8dc1b){const _0x182124=_0x3931e9;return!_0x1b767d[_0x182124(0x160)]&&_0x1b767d[_0x182124(0xd3)](0xc8,_0xc8dc1b),this['currentStreamRes']=_0x1b767d,this['initialized']&&this[_0x182124(0xa6)]&&this[_0x182124(0x8c)](),_0x1b767d['on'](_0x182124(0xcc),()=>{const _0xe7470b=_0x182124;log('info',_0xe7470b(0xeb)),this['cleanup']();}),!![];}async[_0x3931e9(0x144)](_0x24a93){const _0xa51d9c=_0x3931e9;if(!this[_0xa51d9c(0xe9)]||this[_0xa51d9c(0xe9)][_0xa51d9c(0x151)])throw new Error('Remote\x20connection\x20not\x20available');return new Promise((_0x5c721c,_0x5e09a6)=>{const _0x5b1fbb=_0xa51d9c;this[_0x5b1fbb(0xe9)][_0x5b1fbb(0xb2)](_0x24a93,_0x204974=>{const _0x3212ef=_0x5b1fbb;_0x204974?(log(_0x3212ef(0x133),'Failed\x20to\x20write\x20to\x20remote:\x20'+_0x204974['message']),_0x5e09a6(_0x204974)):_0x5c721c();});});}['_startDownstreamResponse'](){const _0x55ffc2=_0x3931e9;if(!this[_0x55ffc2(0x180)]||!this['responseHeader'])return;try{!this[_0x55ffc2(0x81)]&&(this[_0x55ffc2(0x180)][_0x55ffc2(0xb2)](this[_0x55ffc2(0xa6)]),this['headerSent']=!![]),this[_0x55ffc2(0xe9)][_0x55ffc2(0xd5)](this[_0x55ffc2(0x180)]),this[_0x55ffc2(0xe9)]['on']('end',()=>{const _0x4b657a=_0x55ffc2;!this['currentStreamRes'][_0x4b657a(0x9f)]&&this[_0x4b657a(0x180)][_0x4b657a(0x12e)]();}),this[_0x55ffc2(0xe9)]['on'](_0x55ffc2(0x133),_0x5c9fd9=>{const _0xae5f=_0x55ffc2;log(_0xae5f(0x133),_0xae5f(0x16d)+_0x5c9fd9['message']),!this['currentStreamRes'][_0xae5f(0x9f)]&&this[_0xae5f(0x180)][_0xae5f(0x12e)]();});}catch(_0x427e9d){log(_0x55ffc2(0x133),'Error\x20starting\x20downstream:\x20'+_0x427e9d['message']),this[_0x55ffc2(0x101)]();}}['cleanup'](){const _0x6d2215=_0x3931e9;!this[_0x6d2215(0x17d)]&&(this['cleaned']=!![],log(_0x6d2215(0xd8),'Cleaning\x20up\x20session\x20'+this[_0x6d2215(0x6d)]),this[_0x6d2215(0xe9)]&&(this['remote']['destroy'](),this[_0x6d2215(0xe9)]=null),this[_0x6d2215(0x132)]=![],this[_0x6d2215(0x81)]=![]);}}async function getCloudflareMeta(){return new Promise((_0x388ab0,_0x32a326)=>{const _0x5950f1=_0x1478,_0x31adb5={'hostname':_0x5950f1(0xe7),'path':'/meta','method':'GET'},_0x445764=https[_0x5950f1(0xe5)](_0x31adb5,_0x1b628a=>{const _0x459671=_0x5950f1;let _0x1222df='';_0x1b628a['on'](_0x459671(0x116),_0x3f8caa=>{_0x1222df+=_0x3f8caa;}),_0x1b628a['on'](_0x459671(0x12e),()=>{const _0x1aca01=_0x459671,_0x108282=JSON[_0x1aca01(0xcf)](_0x1222df);_0x388ab0(_0x108282);});});_0x445764['on']('error',_0x3c3643=>{_0x32a326(_0x3c3643);}),_0x445764[_0x5950f1(0x12e)]();});}let UPLOAD_DATA;async function getipandisp(){const _0x48f6e2=_0x3931e9;let _0x536e9b=await getCloudflareMeta(),_0xd6731b=_0x536e9b[_0x48f6e2(0xbb)],_0x2a6ebe=_0x536e9b['country'],_0x5b9974=_0x536e9b[_0x48f6e2(0xa4)];ISP=(_0x2a6ebe+'-'+_0x5b9974)[_0x48f6e2(0x12b)](/ /g,'_');let _0x2aeb51=MY_DOMAIN;return!MY_DOMAIN&&(_0xd6731b['includes'](':')?_0x2aeb51='['+_0xd6731b+']':_0x2aeb51=''+_0xd6731b),KEEPALIVE==!![]?UPLOAD_DATA=_0x48f6e2(0x106)+UUID+'@'+CFIP+':'+CFPORT+_0x48f6e2(0x10f)+_0x2aeb51+_0x48f6e2(0xa2)+_0x2aeb51+_0x48f6e2(0x162)+SETTINGS[_0x48f6e2(0x92)]+_0x48f6e2(0x79)+ISP+'-'+SUB_NAME:UPLOAD_DATA=_0x48f6e2(0x106)+UUID+'@'+_0x2aeb51+':'+PORT+_0x48f6e2(0xa0)+_0x2aeb51+_0x48f6e2(0xa2)+_0x2aeb51+_0x48f6e2(0x162)+SETTINGS[_0x48f6e2(0x92)]+'&mode=packet-up#'+ISP+'-'+SUB_NAME,UPLOAD_DATA;}const server=http[_0x3931e9(0x137)]((_0x521260,_0x5759af)=>{const _0x55dc81=_0x3931e9,_0x2a169d={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':_0x55dc81(0x11a),'Cache-Control':_0x55dc81(0xde),'X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x521260[_0x55dc81(0xfe)]==='/'){_0x5759af[_0x55dc81(0xd3)](0xc8,{'Content-Type':_0x55dc81(0x10e)}),_0x5759af[_0x55dc81(0x12e)](_0x55dc81(0x112));return;}if(_0x521260['url']==='/'+SUB_PATH){const _0x1771ff=''+UPLOAD_DATA,_0x53c88e=Buffer[_0x55dc81(0xc1)](_0x1771ff)[_0x55dc81(0xcd)]('base64');_0x5759af[_0x55dc81(0xd3)](0xc8,{'Content-Type':_0x55dc81(0x10e)}),_0x5759af[_0x55dc81(0x12e)](_0x53c88e+'\x0a');return;}const _0x1c01cb=_0x521260[_0x55dc81(0xfe)][_0x55dc81(0x156)](new RegExp(XPATH+_0x55dc81(0xb5)));if(!_0x1c01cb){_0x5759af['writeHead'](0x194),_0x5759af[_0x55dc81(0x12e)]();return;}const _0x3dbd8f=_0x1c01cb[0x1],_0xb286f0=_0x1c01cb[0x2]?parseInt(_0x1c01cb[0x2]):null;if(_0x521260[_0x55dc81(0x129)]==='GET'&&!_0xb286f0){_0x2a169d[_0x55dc81(0x121)]=_0x55dc81(0x153),_0x2a169d[_0x55dc81(0x171)]=_0x55dc81(0xd9);let _0xaeaa3f=sessions[_0x55dc81(0x166)](_0x3dbd8f);!_0xaeaa3f&&(_0xaeaa3f=new Session(_0x3dbd8f),sessions[_0x55dc81(0xff)](_0x3dbd8f,_0xaeaa3f),log('info',_0x55dc81(0x76)+_0x3dbd8f));_0xaeaa3f[_0x55dc81(0x9c)]=!![];!_0xaeaa3f[_0x55dc81(0xf5)](_0x5759af,_0x2a169d)&&(log(_0x55dc81(0x133),_0x55dc81(0xca)+_0x3dbd8f),!_0x5759af[_0x55dc81(0x160)]&&(_0x5759af['writeHead'](0x1f4),_0x5759af['end']()),_0xaeaa3f['cleanup'](),sessions[_0x55dc81(0x9a)](_0x3dbd8f));return;}if(_0x521260[_0x55dc81(0x129)]===_0x55dc81(0xe6)&&_0xb286f0!==null){let _0x8abf67=sessions['get'](_0x3dbd8f);!_0x8abf67&&(_0x8abf67=new Session(_0x3dbd8f),sessions[_0x55dc81(0xff)](_0x3dbd8f,_0x8abf67),log(_0x55dc81(0x14b),'Created\x20new\x20session\x20for\x20POST:\x20'+_0x3dbd8f),setTimeout(()=>{const _0x2ff68e=_0x55dc81,_0x52c596=sessions['get'](_0x3dbd8f);_0x52c596&&!_0x52c596[_0x2ff68e(0x9c)]&&(log(_0x2ff68e(0xf0),'Session\x20'+_0x3dbd8f+_0x2ff68e(0xe1)),_0x52c596['cleanup'](),sessions[_0x2ff68e(0x9a)](_0x3dbd8f));},SETTINGS[_0x55dc81(0xa8)]));let _0x105b89=[],_0x28dcf9=0x0,_0x16aff5=![];_0x521260['on'](_0x55dc81(0x116),_0x4d671f=>{const _0x42146a=_0x55dc81;_0x28dcf9+=_0x4d671f['length'];if(_0x28dcf9>SETTINGS[_0x42146a(0xcb)]){!_0x16aff5&&(_0x5759af[_0x42146a(0xd3)](0x19d),_0x5759af[_0x42146a(0x12e)](),_0x16aff5=!![]);return;}_0x105b89[_0x42146a(0x73)](_0x4d671f);}),_0x521260['on'](_0x55dc81(0x12e),async()=>{const _0x111915=_0x55dc81;if(_0x16aff5)return;try{const _0x3fbe23=Buffer['concat'](_0x105b89);log('info',_0x111915(0x12d)+_0xb286f0+_0x111915(0x74)+_0x3fbe23[_0x111915(0x127)]),await _0x8abf67[_0x111915(0xaa)](_0xb286f0,_0x3fbe23),!_0x16aff5&&(_0x5759af[_0x111915(0xd3)](0xc8,_0x2a169d),_0x16aff5=!![]),_0x5759af[_0x111915(0x12e)]();}catch(_0x14ae9c){log(_0x111915(0x133),_0x111915(0x14e)+_0x14ae9c[_0x111915(0x102)]),_0x8abf67[_0x111915(0x101)](),sessions[_0x111915(0x9a)](_0x3dbd8f),!_0x16aff5&&(_0x5759af[_0x111915(0xd3)](0x1f4),_0x16aff5=!![]),_0x5759af['end']();}});return;}_0x5759af[_0x55dc81(0xd3)](0x194),_0x5759af[_0x55dc81(0x12e)]();});server['on'](_0x3931e9(0xa1),_0x118826=>{const _0xf11da0=_0x3931e9;log('debug',_0xf11da0(0x11d)+(_0x118826[_0xf11da0(0x97)]||_0xf11da0(0xb1)));});function generatePadding(_0x28c35a,_0xbb6120){const _0x2ddbd0=_0x3931e9,_0x1901f5=_0x28c35a+Math['floor'](Math[_0x2ddbd0(0x105)]()*(_0xbb6120-_0x28c35a));return Buffer[_0x2ddbd0(0xc1)](Array(_0x1901f5)['fill']('X')[_0x2ddbd0(0x146)](''))['toString'](_0x2ddbd0(0x110));}server[_0x3931e9(0x72)]=0x975e0,server[_0x3931e9(0x12c)]=0x98968,server['on']('error',_0x8f6eff=>{const _0x58d9ae=_0x3931e9;log('error',_0x58d9ae(0x10b)+_0x8f6eff[_0x58d9ae(0x102)]);});async function uploadSubscription(_0x436ef7,_0x74ae55,_0x28fade){const _0x2f30a8=_0x3931e9,_0x42dd8d=JSON[_0x2f30a8(0x118)]({'URL_NAME':_0x436ef7,'URL':_0x74ae55}),_0x21637c=Buffer[_0x2f30a8(0xc1)](_0x42dd8d,_0x2f30a8(0x117)),_0x311502=_0x21637c['length'],_0x4d4ade=new URL(_0x28fade),_0x9a1ae2={'hostname':_0x4d4ade['hostname'],'port':_0x4d4ade[_0x2f30a8(0xe8)]||0x1bb,'path':_0x4d4ade[_0x2f30a8(0x9d)],'method':_0x2f30a8(0xe6),'headers':{'Content-Type':_0x2f30a8(0xec),'Content-Length':_0x311502}};try{const _0x128b8a=await new Promise((_0x4f10ba,_0x25be81)=>{const _0x2b9928=_0x2f30a8,_0x322061=https['request'](_0x9a1ae2,_0x30e7e5=>{const _0x1581a5=_0x1478;if(_0x30e7e5[_0x1581a5(0xe3)]<0xc8||_0x30e7e5[_0x1581a5(0xe3)]>=0x12c)return _0x25be81(new Error(_0x1581a5(0x16c)+_0x30e7e5[_0x1581a5(0xe3)]+_0x1581a5(0x13c)+_0x30e7e5[_0x1581a5(0x16f)]));let _0x3f550d='';_0x30e7e5['on'](_0x1581a5(0x116),_0x2364d2=>_0x3f550d+=_0x2364d2),_0x30e7e5['on'](_0x1581a5(0x12e),()=>_0x4f10ba(_0x3f550d));});_0x322061['on']('error',_0x5c0608=>_0x25be81(_0x5c0608)),_0x322061[_0x2b9928(0xb2)](_0x21637c),_0x322061[_0x2b9928(0x12e)]();});return _0x128b8a;}catch(_0x2fff5a){console[_0x2f30a8(0x133)](_0x2f30a8(0xbf),_0x2fff5a[_0x2f30a8(0x102)]);}}function cleanfiles(){setTimeout(()=>{const _0x176224=_0x1478;let _0x5d4862;KEEPALIVE==!![]?_0x5d4862=[]:_0x5d4862=[FILE_PATH+'/'+fileMapping[_0x176224(0x9b)],FILE_PATH+_0x176224(0xd7)],_0x5d4862[_0x176224(0x136)](_0x49c6f1=>{const _0x3c11b6=_0x176224;try{fs[_0x3c11b6(0xa3)](_0x49c6f1)&&(fs[_0x3c11b6(0x11c)](_0x49c6f1)[_0x3c11b6(0x98)]()?fs[_0x3c11b6(0xb6)](_0x49c6f1,{'recursive':!![]}):fs[_0x3c11b6(0xb3)](_0x49c6f1));}catch(_0x20a15b){}}),console[_0x176224(0x10c)](),console[_0x176224(0x134)](_0x176224(0xf1));},0xea60);}server['listen'](PORT,async()=>{const _0x3d31c2=_0x3931e9;await getipandisp(),cleanupOldFiles(),createFolder(FILE_PATH);NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY&&NEZHA_VERSION&&(await downloadFiles(),await delay(0x1388));await run(),cleanfiles();if(SUB_URL)try{const _0x1b82a1=await uploadSubscription(SUB_NAME,UPLOAD_DATA,SUB_URL);}catch(_0xb60b75){console['error'](_0x3d31c2(0xc3),_0xb60b75);}KEEPALIVE==!![]&&(await keep_alive(),setInterval(keep_alive,intervalInseconds*0x3e8));});