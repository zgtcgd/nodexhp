const _0x522536=_0x4731;function _0x4731(_0x3e0f42,_0x1128db){const _0x103893=_0x1038();return _0x4731=function(_0x4731ac,_0x1cdfd2){_0x4731ac=_0x4731ac-0xe8;let _0x399c9e=_0x103893[_0x4731ac];return _0x399c9e;},_0x4731(_0x3e0f42,_0x1128db);}(function(_0x2db337,_0x195170){const _0x183882=_0x4731,_0x4d5454=_0x2db337();while(!![]){try{const _0x220c1f=-parseInt(_0x183882(0x179))/0x1*(-parseInt(_0x183882(0x18f))/0x2)+parseInt(_0x183882(0x111))/0x3+-parseInt(_0x183882(0x10c))/0x4+parseInt(_0x183882(0x1c4))/0x5+-parseInt(_0x183882(0x178))/0x6+-parseInt(_0x183882(0x1c7))/0x7*(-parseInt(_0x183882(0x1e5))/0x8)+parseInt(_0x183882(0x1c8))/0x9*(parseInt(_0x183882(0x1f6))/0xa);if(_0x220c1f===_0x195170)break;else _0x4d5454['push'](_0x4d5454['shift']());}catch(_0x3f540e){_0x4d5454['push'](_0x4d5454['shift']());}}}(_0x1038,0x952e2));const FILE_PATH=process[_0x522536(0x168)][_0x522536(0x1b6)]||_0x522536(0x101),intervalInseconds=process['env']['TIME']||0x64,SUB_PATH=process[_0x522536(0x168)][_0x522536(0x166)]||'sub',PORT=process[_0x522536(0x168)]['PORT']||0xbb8,CFPORT=process[_0x522536(0x168)][_0x522536(0xed)]||0x1bb,CFIP=process[_0x522536(0x168)][_0x522536(0x13a)]||_0x522536(0x130),KEEPALIVE=process['env'][_0x522536(0x1d0)]||![],SUB_URL=process[_0x522536(0x168)][_0x522536(0x1e0)]||'',UUID=process[_0x522536(0x168)][_0x522536(0xf3)]||_0x522536(0x105),XPATH=process['env']['XPATH']||UUID[_0x522536(0x12a)](0x0,0x8),HTTPSTLS=process[_0x522536(0x168)][_0x522536(0xea)]||!![],NEZHA_VERSION=process[_0x522536(0x168)][_0x522536(0x113)]||'V0',NEZHA_SERVER=process[_0x522536(0x168)][_0x522536(0x175)]||'',NEZHA_PORT=process[_0x522536(0x168)][_0x522536(0x122)]||_0x522536(0x13f),NEZHA_KEY=process[_0x522536(0x168)][_0x522536(0x129)]||'',SUB_NAME=process['env'][_0x522536(0x1fc)]||'',MY_DOMAIN=process['env']['MY_DOMAIN']||'',os=require('os'),fs=require('fs'),net=require(_0x522536(0x19d)),path=require(_0x522536(0xf0)),http=require(_0x522536(0x1da)),https=require('https'),axios=require(_0x522536(0xf5)),{pipeline}=require(_0x522536(0x1d7)),{Buffer}=require(_0x522536(0x136)),exec=require('child_process')[_0x522536(0x104)],delay=_0x6e9d38=>new Promise(_0x10598e=>setTimeout(_0x10598e,_0x6e9d38)),SETTINGS={['UUID']:UUID,[_0x522536(0x1b1)]:_0x522536(0x12b),[_0x522536(0x14d)]:_0x522536(0x152),[_0x522536(0x15c)]:'%2F'+XPATH,[_0x522536(0x1cc)]:0x1e,[_0x522536(0x1c1)]:0xf4240,[_0x522536(0x1e6)]:0x7530,['CHUNK_SIZE']:0x400*0x400,[_0x522536(0x14b)]:!![],[_0x522536(0x1e7)]:!![]};function validate_uuid(_0x54493a,_0x32be53){for(let _0x3dc7fb=0x0;_0x3dc7fb<0x10;_0x3dc7fb++){if(_0x54493a[_0x3dc7fb]!==_0x32be53[_0x3dc7fb])return![];}return!![];}function concat_typed_arrays(_0x1b4686,..._0x51a4f2){const _0xe30cef=_0x522536;if(!_0x51a4f2||_0x51a4f2[_0xe30cef(0x1db)]<0x1)return _0x1b4686;let _0x138127=_0x1b4686['length'];for(let _0x3f9885 of _0x51a4f2)_0x138127+=_0x3f9885[_0xe30cef(0x1db)];const _0x9c3b17=new _0x1b4686[(_0xe30cef(0x1f5))](_0x138127);_0x9c3b17[_0xe30cef(0x1b0)](_0x1b4686,0x0),_0x138127=_0x1b4686[_0xe30cef(0x1db)];for(let _0xb65dd8 of _0x51a4f2){_0x9c3b17[_0xe30cef(0x1b0)](_0xb65dd8,_0x138127),_0x138127+=_0xb65dd8[_0xe30cef(0x1db)];}return _0x9c3b17;}function log(_0x2a48cc,..._0x479796){const _0x4286f4=_0x522536;if(SETTINGS['LOG_LEVEL']===_0x4286f4(0x12b))return;const _0x514b87={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x476fdb={'debug':_0x4286f4(0x198),'info':_0x4286f4(0x1bb),'warn':'\x1b[33m','error':'\x1b[31m','reset':'\x1b[0m'},_0x3744f1=_0x514b87[SETTINGS[_0x4286f4(0x1b1)]]||0x1,_0x377ea4=_0x514b87[_0x2a48cc]||0x0;if(_0x377ea4>=_0x3744f1){const _0x19e5e9=new Date()['toISOString'](),_0x5c168e=_0x476fdb[_0x2a48cc]||_0x476fdb[_0x4286f4(0x1f4)];console[_0x4286f4(0x13b)](_0x5c168e+'['+_0x19e5e9+']\x20['+_0x2a48cc+']',..._0x479796,_0x476fdb[_0x4286f4(0x1f4)]);}}function cleanupOldFiles(){const _0x1b588d=_0x522536;try{fs['existsSync'](path[_0x1b588d(0x120)](FILE_PATH))?(fs[_0x1b588d(0x1c0)](path[_0x1b588d(0x120)](FILE_PATH),{'recursive':!![]}),console[_0x1b588d(0x13b)](FILE_PATH+_0x1b588d(0x1e9))):console[_0x1b588d(0x13b)](FILE_PATH+_0x1b588d(0x11d));}catch(_0x25ef2e){console[_0x1b588d(0x13b)]('unable\x20to\x20rm\x20'+FILE_PATH);}}function createFolder(_0x5a7457){const _0x116264=_0x522536;!fs[_0x116264(0xf8)](_0x5a7457)?(fs['mkdirSync'](_0x5a7457),console[_0x116264(0x13b)](_0x5a7457+_0x116264(0x1fa))):console[_0x116264(0x13b)](_0x5a7457+_0x116264(0x117));}function execPromise(_0x62bd56,_0xf26c47={}){return new Promise((_0x165cd9,_0x1021a7)=>{const _0x303654=exec(_0x62bd56,_0xf26c47,(_0x5b45b5,_0x2c0c10,_0x105b0a)=>{const _0x4e4bca=_0x4731;if(_0x5b45b5){const _0x44810c=new Error(_0x4e4bca(0x180)+_0x5b45b5['message']);_0x44810c['code']=_0x5b45b5['code'],_0x44810c[_0x4e4bca(0x192)]=_0x105b0a[_0x4e4bca(0x114)](),_0x1021a7(_0x44810c);}else _0x165cd9(_0x2c0c10['trim']());});});}async function detectProcess(_0x10ada4){const _0x96a6dd=_0x522536,_0x4a757e=[{'cmd':_0x96a6dd(0x14f)+_0x10ada4+'\x22','name':'pidof'},{'cmd':_0x96a6dd(0x19f)+_0x10ada4+'\x22','name':_0x96a6dd(0x195)},{'cmd':_0x96a6dd(0x16b)+_0x10ada4+_0x96a6dd(0xfa),'name':'ps+awk'}];for(const _0x3c7cd1 of _0x4a757e){try{const _0x579967=await execPromise(_0x3c7cd1[_0x96a6dd(0x19c)]);if(_0x579967)return _0x579967['replace'](/\n/g,'\x20')[_0x96a6dd(0x114)]();}catch(_0x2f107d){_0x2f107d[_0x96a6dd(0xf2)]!==0x7f&&_0x2f107d[_0x96a6dd(0xf2)]!==0x1&&console[_0x96a6dd(0x1ef)]('[detectProcess]\x20'+_0x3c7cd1[_0x96a6dd(0x14c)]+'\x20error:',_0x2f107d['message']);}}return'';}async function killProcess(_0x563e0e){const _0x5b5ebf=_0x522536;console[_0x5b5ebf(0x13b)](_0x5b5ebf(0x16f)+_0x563e0e);try{const _0x9caa7b=await detectProcess(_0x563e0e);if(!_0x9caa7b)return console['warn'](_0x5b5ebf(0x19e)+_0x563e0e+'\x27\x20not\x20found'),{'success':!![],'message':_0x5b5ebf(0x1ee)};await execPromise(_0x5b5ebf(0x1b8)+_0x9caa7b);const _0x409011=_0x5b5ebf(0x17a)+_0x9caa7b+')';return console[_0x5b5ebf(0x13b)](_0x409011),{'success':!![],'message':_0x409011};}catch(_0x5b9528){const _0x348066=_0x5b5ebf(0x15a)+_0x5b9528['message'];return console[_0x5b5ebf(0x126)](_0x348066),{'success':![],'message':_0x348066};}}function generateRandomString(_0xfb8150){const _0x3ff497=_0x522536,_0x5941be='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';let _0x216dd7='';for(let _0x4c81b2=0x0;_0x4c81b2<_0xfb8150;_0x4c81b2++){_0x216dd7+=_0x5941be[_0x3ff497(0xe9)](Math[_0x3ff497(0x156)](Math[_0x3ff497(0x1e2)]()*_0x5941be[_0x3ff497(0x1db)]));}return _0x216dd7;}function getSystemArchitecture(){const _0x50b03a=_0x522536,_0x150552=os['arch']();return _0x150552==='arm'||_0x150552===_0x50b03a(0x139)||_0x150552===_0x50b03a(0x1e4)?_0x50b03a(0xeb):_0x50b03a(0x11a);}function getFilesForArchitecture(_0x399931){const _0x107d68=_0x522536,_0x9d4e79={'app':{'V0':{'arm':_0x107d68(0x161),'amd':_0x107d68(0xfe)},'V1':{'arm':_0x107d68(0xf4),'amd':_0x107d68(0x167)}}};if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY&&NEZHA_VERSION){const _0x2f10d5=[{'fileName':_0x107d68(0x17f)+generateRandomString(0x5),'originalName':_0x107d68(0x10d),'fileUrl':_0x9d4e79[_0x107d68(0x10d)][NEZHA_VERSION][_0x399931]}];return _0x2f10d5;}else return[];}async function download_function(_0xce2b2f,_0x51a75b,_0x262554){const _0x526be0=_0x522536,_0x5c92c0=path[_0x526be0(0x120)](FILE_PATH,_0xce2b2f);let _0x108521=![];try{const _0x45fb5d=await axios({'method':_0x526be0(0x151),'url':_0x262554,'responseType':_0x526be0(0x1b2)});await pipeline(_0x45fb5d[_0x526be0(0x1ff)],fs[_0x526be0(0x11f)](_0x5c92c0)),console[_0x526be0(0x13b)]('Download\x20'+_0x51a75b+_0x526be0(0x1d3)+_0xce2b2f+')\x20successfully'),_0x108521=!![];}catch(_0x5611a1){console[_0x526be0(0x13b)]('Download\x20'+_0x51a75b+_0x526be0(0x1d3)+_0xce2b2f+_0x526be0(0x1df)+_0x5611a1[_0x526be0(0x142)]);}return{'fileName':_0xce2b2f,'originalName':_0x51a75b,'filePath':_0x5c92c0,'success':_0x108521};}let fileMapping={};async function downloadFiles(){const _0x46bedb=_0x522536;try{const _0x2c301a=getSystemArchitecture();if(!_0x2c301a)return console['log'](_0x46bedb(0x162)),fileMapping;const _0x376597=getFilesForArchitecture(_0x2c301a);if(_0x376597[_0x46bedb(0x1db)]===0x0)return console[_0x46bedb(0x13b)](_0x46bedb(0x172)),fileMapping;const _0x4a6899=_0x376597[_0x46bedb(0x1d8)](_0x526763=>download_function(_0x526763[_0x46bedb(0x165)],_0x526763[_0x46bedb(0x1f8)],_0x526763['fileUrl'])),_0x531c39=await Promise[_0x46bedb(0x194)](_0x4a6899);return _0x531c39[_0x46bedb(0x12d)](_0xf70aee=>{const _0x3be818=_0x46bedb;if(_0xf70aee[_0x3be818(0x118)])try{fs['chmodSync'](_0xf70aee['filePath'],0x1ed),console['log'](_0x3be818(0x109)+_0xf70aee[_0x3be818(0x165)]+':\x20755'),fileMapping[_0xf70aee['originalName']]=_0xf70aee[_0x3be818(0x165)];}catch(_0x2b430f){console[_0x3be818(0x1d2)]('Empowerment\x20failed\x20for\x20'+_0xf70aee[_0x3be818(0x165)]+':\x20'+_0x2b430f[_0x3be818(0x142)]);}}),fileMapping;}catch(_0x1b4a8d){return console['error']('Error\x20downloading\x20files:',_0x1b4a8d),fileMapping;}}let NEZHA_TLS;function nezconfig(){const _0xf9c8bd=_0x522536,_0x6af304=[_0xf9c8bd(0x13f),_0xf9c8bd(0x107),_0xf9c8bd(0x1a3),_0xf9c8bd(0x1ae),_0xf9c8bd(0xff),_0xf9c8bd(0x116)];if(NEZHA_VERSION==='V0')return _0x6af304[_0xf9c8bd(0x141)](NEZHA_PORT)?NEZHA_TLS='--tls':NEZHA_TLS='',NEZHA_TLS;else{if(NEZHA_VERSION==='V1'){_0x6af304[_0xf9c8bd(0x141)](NEZHA_PORT)?NEZHA_TLS=_0xf9c8bd(0x176):NEZHA_TLS=_0xf9c8bd(0x10b);const _0x50b111=path[_0xf9c8bd(0x120)](FILE_PATH,_0xf9c8bd(0x1cf)),_0x137ba9='client_secret:\x20'+NEZHA_KEY+_0xf9c8bd(0x1ca)+NEZHA_SERVER+':'+NEZHA_PORT+'\x0askip_connection_count:\x20false\x0askip_procs_count:\x20false\x0atemperature:\x20false\x0atls:\x20'+NEZHA_TLS+_0xf9c8bd(0x17c)+UUID;try{fs[_0xf9c8bd(0x1bc)](_0x50b111,_0x137ba9),console[_0xf9c8bd(0x13b)](_0xf9c8bd(0x147));}catch(_0x25b312){console[_0xf9c8bd(0x126)](_0xf9c8bd(0x158),_0x25b312);}}}}async function runapp(){const _0x5b82a5=_0x522536;if(fileMapping[_0x5b82a5(0x10d)]&&fs[_0x5b82a5(0xf8)](path['join'](FILE_PATH,fileMapping[_0x5b82a5(0x10d)]))){if(NEZHA_VERSION==='V0'){const _0x69e213=_0x5b82a5(0x1fd)+FILE_PATH+'/'+fileMapping[_0x5b82a5(0x10d)]+_0x5b82a5(0x1f9)+NEZHA_SERVER+':'+NEZHA_PORT+_0x5b82a5(0x19b)+NEZHA_KEY+'\x20'+NEZHA_TLS+_0x5b82a5(0x18c);try{await execPromise(_0x69e213);}catch(_0x1173db){console[_0x5b82a5(0x126)](fileMapping[_0x5b82a5(0x10d)]+_0x5b82a5(0x1cd)+_0x1173db);}}else{if(NEZHA_VERSION==='V1'){const _0x22f6e6=_0x5b82a5(0x1fd)+FILE_PATH+'/'+fileMapping[_0x5b82a5(0x10d)]+_0x5b82a5(0x171)+FILE_PATH+_0x5b82a5(0x1a5);try{await execPromise(_0x22f6e6);}catch(_0x16639c){console[_0x5b82a5(0x126)](fileMapping[_0x5b82a5(0x10d)]+_0x5b82a5(0x1cd)+_0x16639c);}}}}else console['log'](_0x5b82a5(0x145));}async function run(){const _0x507ba7=_0x522536;if(NEZHA_VERSION&&NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){nezconfig();const _0x41f431=await detectProcess(''+fileMapping['app']);if(_0x41f431){}else await runapp();await delay(0x3e8),console['log'](fileMapping[_0x507ba7(0x10d)]+_0x507ba7(0x163));}else console[_0x507ba7(0x13b)]('app\x20variable\x20is\x20empty,\x20skip\x20running');}async function keep_alive(){const _0x596fae=_0x522536;if(NEZHA_VERSION&&NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x1917af=await detectProcess(''+fileMapping[_0x596fae(0x10d)]);if(_0x1917af){}else console[_0x596fae(0x13b)](fileMapping[_0x596fae(0x10d)]+'\x20runs\x20again\x20!'),await runapp();}}function parse_uuid(_0x141ef4){const _0x922419=_0x522536;_0x141ef4=_0x141ef4[_0x922419(0x174)]('-','');const _0x246dc6=[];for(let _0x2f3a3b=0x0;_0x2f3a3b<0x10;_0x2f3a3b++){_0x246dc6[_0x922419(0x1f2)](parseInt(_0x141ef4[_0x922419(0x143)](_0x2f3a3b*0x2,0x2),0x10));}return _0x246dc6;}async function read_vless_header(_0x268fbf,_0x3c5c9f){const _0x13d49d=_0x522536;let _0x16808f=0x0,_0x2f5012=new Uint8Array(),_0x1626af={'value':_0x2f5012,'done':![]};async function _0x507ebf(_0x3af94b){const _0x4797d2=_0x4731;if(_0x1626af[_0x4797d2(0x1c5)])throw new Error(_0x4797d2(0x15e));const _0x4771ef=_0x3af94b-_0x16808f;if(_0x4771ef<0x1)return;_0x1626af=await read_atleast(_0x268fbf,_0x4771ef),_0x16808f+=_0x1626af[_0x4797d2(0x177)]['length'],_0x2f5012=concat_typed_arrays(_0x2f5012,_0x1626af[_0x4797d2(0x177)]);}await _0x507ebf(0x1+0x10+0x1);const _0x103ed5=_0x2f5012[0x0],_0x14916b=_0x2f5012[_0x13d49d(0x12a)](0x1,0x1+0x10),_0x54d684=parse_uuid(_0x3c5c9f);if(!validate_uuid(_0x14916b,_0x54d684))throw new Error(_0x13d49d(0x1b3));const _0x50df2c=_0x2f5012[0x1+0x10],_0x4f60d3=0x1+0x10+0x1+_0x50df2c+0x1+0x2+0x1;await _0x507ebf(_0x4f60d3+0x1);const _0x277abb=_0x2f5012[0x1+0x10+0x1+_0x50df2c],_0x4efe06=0x1;if(_0x277abb!==_0x4efe06)throw new Error(_0x13d49d(0x102)+_0x277abb);const _0x160fe2=(_0x2f5012[_0x4f60d3-0x1-0x2]<<0x8)+_0x2f5012[_0x4f60d3-0x1-0x1],_0x4758a8=_0x2f5012[_0x4f60d3-0x1],_0x5f3627=0x1,_0x682d52=0x2,_0x4260fe=0x3;let _0x832253=-0x1;if(_0x4758a8===_0x5f3627)_0x832253=_0x4f60d3+0x4;else{if(_0x4758a8===_0x4260fe)_0x832253=_0x4f60d3+0x10;else _0x4758a8===_0x682d52&&(_0x832253=_0x4f60d3+0x1+_0x2f5012[_0x4f60d3]);}if(_0x832253<0x0)throw new Error(_0x13d49d(0x1fe));await _0x507ebf(_0x832253);const _0x4910c2=_0x4f60d3;let _0x25f100='';if(_0x4758a8===_0x5f3627)_0x25f100=_0x2f5012[_0x13d49d(0x12a)](_0x4910c2,_0x4910c2+0x4)[_0x13d49d(0x120)]('.');else{if(_0x4758a8===_0x682d52)_0x25f100=new TextDecoder()[_0x13d49d(0x15f)](_0x2f5012['slice'](_0x4910c2+0x1,_0x4910c2+0x1+_0x2f5012[_0x4910c2]));else _0x4758a8===_0x4260fe&&(_0x25f100=_0x2f5012[_0x13d49d(0x12a)](_0x4910c2,_0x4910c2+0x10)[_0x13d49d(0x1dd)]((_0x138334,_0x61fc10,_0x34e28e,_0x4e85d1)=>_0x34e28e%0x2?_0x138334[_0x13d49d(0x19a)](((_0x4e85d1[_0x34e28e-0x1]<<0x8)+_0x61fc10)[_0x13d49d(0x17b)](0x10)):_0x138334,[])[_0x13d49d(0x120)](':'));}if(!_0x25f100){log(_0x13d49d(0x126),_0x13d49d(0x1ce));throw new Error(_0x13d49d(0x1c9));}return log('info',_0x13d49d(0x201)+_0x25f100+':'+_0x160fe2),{'hostname':_0x25f100,'port':_0x160fe2,'data':_0x2f5012[_0x13d49d(0x12a)](_0x832253),'resp':new Uint8Array([_0x103ed5,0x0])};}async function read_atleast(_0x599021,_0x4d785f){const _0x4d53d7=_0x522536,_0x4f371b=[];let _0x3bc1bc=![];while(_0x4d785f>0x0&&!_0x3bc1bc){const _0x204ba1=await _0x599021[_0x4d53d7(0x12c)]();if(_0x204ba1[_0x4d53d7(0x177)]){const _0x3d9093=new Uint8Array(_0x204ba1[_0x4d53d7(0x177)]);_0x4f371b[_0x4d53d7(0x1f2)](_0x3d9093),_0x4d785f-=_0x3d9093['length'];}_0x3bc1bc=_0x204ba1['done'];}if(_0x4d785f>0x0)throw new Error(_0x4d53d7(0x16e));return{'value':concat_typed_arrays(..._0x4f371b),'done':_0x3bc1bc};}async function parse_header(_0x5a2a1b,_0x6dcc30){const _0x2f68bc=_0x522536;log(_0x2f68bc(0x1ef),_0x2f68bc(0x1a2));const _0x555033=_0x6dcc30['readable'][_0x2f68bc(0x1b9)]();try{const _0x2afeb9=await read_vless_header(_0x555033,_0x5a2a1b);return log(_0x2f68bc(0x1ef),_0x2f68bc(0x1a9)),_0x2afeb9;}catch(_0x5f9d85){log(_0x2f68bc(0x126),_0x2f68bc(0x1ac)+_0x5f9d85[_0x2f68bc(0x142)]);throw new Error('read\x20vless\x20header\x20error:\x20'+_0x5f9d85[_0x2f68bc(0x142)]);}finally{_0x555033['releaseLock']();}}async function connect_remote(_0x4e9641,_0x1bee76){const _0xc95de8=_0x522536,_0xd6f3e7=0x1f40;try{const _0xf2eaa1=await timed_connect(_0x4e9641,_0x1bee76,_0xd6f3e7);return _0xf2eaa1[_0xc95de8(0x12e)](!![]),_0xf2eaa1['setKeepAlive'](!![],0x3e8),_0xf2eaa1[_0xc95de8(0xf9)]=parseInt(SETTINGS[_0xc95de8(0x14d)])*0x400,log('info','Connected\x20to\x20'+_0x4e9641+':'+_0x1bee76),_0xf2eaa1;}catch(_0x25436f){log('error','Connection\x20failed:\x20'+_0x25436f['message']);throw _0x25436f;}}function timed_connect(_0x3295c3,_0x53da42,_0x35a6dc){return new Promise((_0x3be906,_0x377000)=>{const _0x4fbb94=_0x4731,_0x263c5a=net['createConnection']({'host':_0x3295c3,'port':_0x53da42}),_0x1c1942=setTimeout(()=>{const _0x5b5997=_0x4731;_0x377000(new Error(_0x5b5997(0x1c2)));},_0x35a6dc);_0x263c5a['on']('connect',()=>{clearTimeout(_0x1c1942),_0x3be906(_0x263c5a);}),_0x263c5a['on'](_0x4fbb94(0x126),_0x71cfc4=>{clearTimeout(_0x1c1942),_0x377000(_0x71cfc4);});});}function pipe_relay(){async function _0x42fc8d(_0x4f4278,_0x13edf5,_0x2d2667){const _0x26b33a=_0x4731,_0x35a04a=parseInt(SETTINGS['CHUNK_SIZE']);if(_0x2d2667[_0x26b33a(0x1db)]>0x0){if(_0x13edf5[_0x26b33a(0x160)])_0x13edf5[_0x26b33a(0x185)](),_0x13edf5['write'](_0x2d2667),process[_0x26b33a(0x1bd)](()=>_0x13edf5[_0x26b33a(0x1af)]());else{const _0xdddbcb=_0x13edf5[_0x26b33a(0x1e8)][_0x26b33a(0x146)]();try{await _0xdddbcb[_0x26b33a(0x160)](_0x2d2667);}finally{_0xdddbcb[_0x26b33a(0x108)]();}}}try{_0x4f4278[_0x26b33a(0x181)]?(_0x4f4278['pause'](),_0x4f4278[_0x26b33a(0x181)](_0x13edf5,{'end':!![],'highWaterMark':_0x35a04a}),_0x4f4278[_0x26b33a(0x123)]()):await _0x4f4278[_0x26b33a(0xf1)][_0x26b33a(0x159)](_0x13edf5[_0x26b33a(0x1e8)],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal[_0x26b33a(0x199)](SETTINGS[_0x26b33a(0x1e6)])});}catch(_0x5d86a5){!_0x5d86a5[_0x26b33a(0x142)]['includes'](_0x26b33a(0x17e))&&log(_0x26b33a(0x126),_0x26b33a(0x16d),_0x5d86a5[_0x26b33a(0x142)]);throw _0x5d86a5;}}return _0x42fc8d;}function socketToWebStream(_0x107d1f){const _0x415868=_0x522536;let _0xb44df9,_0x554074;return _0x107d1f['on'](_0x415868(0x126),_0x2ed73f=>{const _0x53d19e=_0x415868;log('error',_0x53d19e(0x187),_0x2ed73f[_0x53d19e(0x142)]),_0xb44df9?.[_0x53d19e(0x126)](_0x2ed73f),_0x554074?.['error'](_0x2ed73f);}),{'readable':new ReadableStream({'start'(_0x1d4c8a){_0xb44df9=_0x1d4c8a,_0x107d1f['on']('data',_0x26de60=>{const _0x524d02=_0x4731;try{_0x1d4c8a['enqueue'](_0x26de60);}catch(_0x11699b){log(_0x524d02(0x126),_0x524d02(0x1f3),_0x11699b[_0x524d02(0x142)]);}}),_0x107d1f['on']('end',()=>{const _0x304786=_0x4731;try{_0x1d4c8a[_0x304786(0x1b7)]();}catch(_0x3f17dd){log('error',_0x304786(0x1be),_0x3f17dd['message']);}});},'cancel'(){const _0x5c9b87=_0x415868;_0x107d1f[_0x5c9b87(0x149)]();}}),'writable':new WritableStream({'start'(_0x47623e){_0x554074=_0x47623e;},'write'(_0x74bc18){return new Promise((_0x305c59,_0x4423aa)=>{const _0x4ee3ab=_0x4731;if(_0x107d1f['destroyed']){_0x4423aa(new Error('Socket\x20is\x20destroyed'));return;}_0x107d1f[_0x4ee3ab(0x160)](_0x74bc18,_0x7dea02=>{if(_0x7dea02)_0x4423aa(_0x7dea02);else _0x305c59();});});},'close'(){const _0x32debc=_0x415868;!_0x107d1f[_0x32debc(0xec)]&&_0x107d1f[_0x32debc(0x1dc)]();},'abort'(_0x1fd577){const _0x56060e=_0x415868;_0x107d1f[_0x56060e(0x149)](_0x1fd577);}})};}function relay(_0x229949,_0x58e5a6,_0x1191c9,_0x37fd1b){const _0x50cef5=_0x522536,_0x25cbc2=pipe_relay();let _0x2b937d=![];const _0x144d4a=socketToWebStream(_0x1191c9);function _0x29fece(){const _0x13e45c=_0x4731;if(!_0x2b937d){_0x2b937d=!![];try{_0x1191c9[_0x13e45c(0x149)]();}catch(_0x2cc0f0){!_0x2cc0f0[_0x13e45c(0x142)][_0x13e45c(0x141)](_0x13e45c(0x17e))&&!_0x2cc0f0[_0x13e45c(0x142)][_0x13e45c(0x141)](_0x13e45c(0x188))&&log(_0x13e45c(0x126),_0x13e45c(0x144)+_0x2cc0f0[_0x13e45c(0x142)]);}}}const _0x439692=_0x25cbc2(_0x58e5a6,_0x144d4a,_0x37fd1b[_0x50cef5(0x1ff)])[_0x50cef5(0x10e)](_0x25574d=>{const _0x487366=_0x50cef5;!_0x25574d[_0x487366(0x142)][_0x487366(0x141)](_0x487366(0x17e))&&!_0x25574d[_0x487366(0x142)][_0x487366(0x141)](_0x487366(0x188))&&log(_0x487366(0x126),_0x487366(0x18d)+_0x25574d['message']);})[_0x50cef5(0x1e1)](()=>{const _0x4d8055=_0x50cef5;_0x58e5a6['reading_done']&&_0x58e5a6[_0x4d8055(0x10a)]();}),_0x561a27=_0x25cbc2(_0x144d4a,_0x58e5a6,_0x37fd1b[_0x50cef5(0x11e)])[_0x50cef5(0x10e)](_0x13c10b=>{const _0x1905c0=_0x50cef5;!_0x13c10b[_0x1905c0(0x142)][_0x1905c0(0x141)](_0x1905c0(0x17e))&&!_0x13c10b[_0x1905c0(0x142)][_0x1905c0(0x141)](_0x1905c0(0x188))&&log('error','Download\x20error:\x20'+_0x13c10b[_0x1905c0(0x142)]);});_0x561a27[_0x50cef5(0x1e1)](()=>_0x439692)[_0x50cef5(0x1e1)](_0x29fece);}const sessions=new Map();class Session{constructor(_0x16b296){const _0x371666=_0x522536;this[_0x371666(0x1ed)]=_0x16b296,this['nextSeq']=0x0,this[_0x371666(0x153)]=![],this[_0x371666(0x1f7)]=Date[_0x371666(0x189)](),this[_0x371666(0x1c6)]=null,this[_0x371666(0x134)]=null,this[_0x371666(0x1cb)]=![],this[_0x371666(0xfb)]=null,this[_0x371666(0x155)]=![],this[_0x371666(0x182)]=new Map(),this['cleaned']=![],this[_0x371666(0x1a6)]=[],this[_0x371666(0x131)]=null,this[_0x371666(0x196)]=new Map(),log(_0x371666(0x1ef),_0x371666(0x148)+_0x16b296);}async[_0x522536(0x150)](_0x55fa24){const _0xe9a06a=_0x522536;if(this[_0xe9a06a(0x1cb)])return!![];try{log(_0xe9a06a(0x1ef),_0xe9a06a(0xf6));const _0x19d32c=new ReadableStream({'start'(_0x5a33aa){const _0x28ee52=_0xe9a06a;_0x5a33aa[_0x28ee52(0x13c)](_0x55fa24),_0x5a33aa[_0x28ee52(0x1b7)]();}}),_0x49d013={'readable':_0x19d32c,'writable':new WritableStream()};return this[_0xe9a06a(0x1c6)]=await parse_header(SETTINGS[_0xe9a06a(0xf3)],_0x49d013),log('info',_0xe9a06a(0x1a7)+this[_0xe9a06a(0x1c6)][_0xe9a06a(0x191)]+':'+this['vlessHeader'][_0xe9a06a(0x112)]),this[_0xe9a06a(0x134)]=await connect_remote(this[_0xe9a06a(0x1c6)][_0xe9a06a(0x191)],this['vlessHeader'][_0xe9a06a(0x112)]),log('info',_0xe9a06a(0x197)),this[_0xe9a06a(0x1cb)]=!![],!![];}catch(_0x101982){return log(_0xe9a06a(0x126),_0xe9a06a(0xf7)+_0x101982[_0xe9a06a(0x142)]),![];}}async[_0x522536(0x1d5)](_0x22112c,_0x3c0e32){const _0x1d6f01=_0x522536;try{this[_0x1d6f01(0x196)][_0x1d6f01(0x1b0)](_0x22112c,_0x3c0e32),log(_0x1d6f01(0x1ef),'Buffered\x20packet\x20seq='+_0x22112c+',\x20size='+_0x3c0e32[_0x1d6f01(0x1db)]);while(this[_0x1d6f01(0x196)]['has'](this[_0x1d6f01(0x1ba)])){const _0x2cebb4=this[_0x1d6f01(0x196)][_0x1d6f01(0x151)](this['nextSeq']);this[_0x1d6f01(0x196)][_0x1d6f01(0xfc)](this[_0x1d6f01(0x1ba)]);if(!this[_0x1d6f01(0x1cb)]&&this[_0x1d6f01(0x1ba)]===0x0){if(!await this['initializeVLESS'](_0x2cebb4))throw new Error(_0x1d6f01(0x133));this[_0x1d6f01(0xfb)]=Buffer['from'](this[_0x1d6f01(0x1c6)]['resp']),await this[_0x1d6f01(0xef)](this[_0x1d6f01(0x1c6)][_0x1d6f01(0x1ff)]),this[_0x1d6f01(0x131)]&&this['_startDownstreamResponse']();}else{if(!this[_0x1d6f01(0x1cb)]){log('warn','Received\x20out\x20of\x20order\x20packet\x20seq='+_0x22112c+_0x1d6f01(0x15b));continue;}await this['_writeToRemote'](_0x2cebb4);}this[_0x1d6f01(0x1ba)]++,log(_0x1d6f01(0x1ef),_0x1d6f01(0x100)+(this[_0x1d6f01(0x1ba)]-0x1));}if(this[_0x1d6f01(0x196)][_0x1d6f01(0x1ad)]>SETTINGS[_0x1d6f01(0x1cc)])throw new Error(_0x1d6f01(0x125));return!![];}catch(_0xc34fb){log(_0x1d6f01(0x126),'Process\x20packet\x20error:\x20'+_0xc34fb[_0x1d6f01(0x142)]);throw _0xc34fb;}}[_0x522536(0x17d)](){const _0x4ad9ac=_0x522536;if(!this[_0x4ad9ac(0x131)]||!this[_0x4ad9ac(0xfb)])return;try{const _0x1f1829=this[_0x4ad9ac(0x131)]['socket']?.[_0x4ad9ac(0x132)]||_0x4ad9ac(0x103),_0x2bfe39=_0x1f1829==='h2';!this[_0x4ad9ac(0x155)]&&(log('debug',_0x4ad9ac(0x15d)+_0x1f1829+_0x4ad9ac(0x11c)+this[_0x4ad9ac(0xfb)]['length']+'\x20bytes'),this[_0x4ad9ac(0x131)][_0x4ad9ac(0x160)](this[_0x4ad9ac(0xfb)]),this[_0x4ad9ac(0x155)]=!![]);if(_0x2bfe39){this[_0x4ad9ac(0x131)][_0x4ad9ac(0x1d6)][_0x4ad9ac(0x12e)](!![]);const _0x4805b8=new require(_0x4ad9ac(0x1b2))[_0x4ad9ac(0x18a)]({'transform'(_0x4663df,_0x44adc2,_0x5be85c){const _0x42f6ed=_0x4ad9ac,_0x4baeba=0x4000;for(let _0x54b816=0x0;_0x54b816<_0x4663df['length'];_0x54b816+=_0x4baeba){this[_0x42f6ed(0x1f2)](_0x4663df[_0x42f6ed(0x12a)](_0x54b816,_0x54b816+_0x4baeba));}_0x5be85c();}});this[_0x4ad9ac(0x134)][_0x4ad9ac(0x181)](_0x4805b8)[_0x4ad9ac(0x181)](this['currentStreamRes']);}else this[_0x4ad9ac(0x134)][_0x4ad9ac(0x181)](this['currentStreamRes']);this[_0x4ad9ac(0x134)]['on']('end',()=>{const _0x5b1b24=_0x4ad9ac;!this['currentStreamRes'][_0x5b1b24(0x128)]&&this[_0x5b1b24(0x131)][_0x5b1b24(0x1dc)]();}),this[_0x4ad9ac(0x134)]['on'](_0x4ad9ac(0x126),_0x3ea943=>{const _0x5f4f6d=_0x4ad9ac;log(_0x5f4f6d(0x126),_0x5f4f6d(0x106)+_0x3ea943['message']),!this[_0x5f4f6d(0x131)][_0x5f4f6d(0x128)]&&this['currentStreamRes'][_0x5f4f6d(0x1dc)]();});}catch(_0x3a1fbe){log(_0x4ad9ac(0x126),'Error\x20starting\x20downstream:\x20'+_0x3a1fbe[_0x4ad9ac(0x142)]),this[_0x4ad9ac(0x13e)]();}}[_0x522536(0x1a4)](_0x49c890,_0x53fb17){const _0x527785=_0x522536;return!_0x49c890[_0x527785(0x119)]&&_0x49c890[_0x527785(0x1b5)](0xc8,_0x53fb17),this[_0x527785(0x131)]=_0x49c890,this['initialized']&&this[_0x527785(0xfb)]&&this[_0x527785(0x17d)](),_0x49c890['on'](_0x527785(0x1b7),()=>{const _0x4d247c=_0x527785;log(_0x4d247c(0x1eb),'Client\x20connection\x20closed'),this[_0x4d247c(0x13e)]();}),!![];}async[_0x522536(0xef)](_0x5c818c){const _0x4924b1=_0x522536;if(!this[_0x4924b1(0x134)]||this[_0x4924b1(0x134)][_0x4924b1(0xec)])throw new Error(_0x4924b1(0x13d));return new Promise((_0x52e48b,_0x118596)=>{const _0x33c427=_0x4924b1;this[_0x33c427(0x134)][_0x33c427(0x160)](_0x5c818c,_0x5c0cbd=>{const _0x23cc2d=_0x33c427;_0x5c0cbd?(log(_0x23cc2d(0x126),'Failed\x20to\x20write\x20to\x20remote:\x20'+_0x5c0cbd[_0x23cc2d(0x142)]),_0x118596(_0x5c0cbd)):_0x52e48b();});});}[_0x522536(0x17d)](){const _0x47d21b=_0x522536;if(!this['currentStreamRes']||!this['responseHeader'])return;try{!this[_0x47d21b(0x155)]&&(this[_0x47d21b(0x131)][_0x47d21b(0x160)](this[_0x47d21b(0xfb)]),this[_0x47d21b(0x155)]=!![]),this['remote'][_0x47d21b(0x181)](this[_0x47d21b(0x131)]),this['remote']['on']('end',()=>{const _0x3e6af4=_0x47d21b;!this[_0x3e6af4(0x131)][_0x3e6af4(0x128)]&&this['currentStreamRes'][_0x3e6af4(0x1dc)]();}),this[_0x47d21b(0x134)]['on'](_0x47d21b(0x126),_0x77d04a=>{const _0x421166=_0x47d21b;log(_0x421166(0x126),_0x421166(0x106)+_0x77d04a[_0x421166(0x142)]),!this[_0x421166(0x131)][_0x421166(0x128)]&&this[_0x421166(0x131)][_0x421166(0x1dc)]();});}catch(_0x3d2800){log(_0x47d21b(0x126),_0x47d21b(0x1a8)+_0x3d2800[_0x47d21b(0x142)]),this[_0x47d21b(0x13e)]();}}[_0x522536(0x13e)](){const _0x159f99=_0x522536;!this[_0x159f99(0x1d4)]&&(this['cleaned']=!![],log('debug',_0x159f99(0x1de)+this['uuid']),this['remote']&&(this[_0x159f99(0x134)][_0x159f99(0x149)](),this[_0x159f99(0x134)]=null),this[_0x159f99(0x1cb)]=![],this[_0x159f99(0x155)]=![]);}}async function getCloudflareMeta(){return new Promise((_0x596b25,_0x13425d)=>{const _0x4eb061=_0x4731,_0x2cb3d2={'hostname':_0x4eb061(0x1e3),'path':_0x4eb061(0x184),'method':'GET'},_0x510c71=https[_0x4eb061(0x18b)](_0x2cb3d2,_0x318a19=>{const _0x3373f3=_0x4eb061;let _0x52f25a='';_0x318a19['on'](_0x3373f3(0x1ff),_0x48b5bf=>{_0x52f25a+=_0x48b5bf;}),_0x318a19['on']('end',()=>{const _0x3b3c4a=_0x3373f3,_0x4bba2a=JSON[_0x3b3c4a(0x170)](_0x52f25a);_0x596b25(_0x4bba2a);});});_0x510c71['on'](_0x4eb061(0x126),_0x2027f7=>{_0x13425d(_0x2027f7);}),_0x510c71[_0x4eb061(0x1dc)]();});}let UPLOAD_DATA;function _0x1038(){const _0x14186a=['get','2048','downstreamStarted','from','headerSent','floor','HTTP\x20error!\x20status:\x20','Error\x20creating\x20or\x20writing\x20config.yml\x20file:','pipeTo','Kill\x20failed:\x20','\x20before\x20initialization','XPATH','Sending\x20VLESS\x20response\x20header\x20(','header\x20length\x20too\x20short','decode','write','https://github.com/kahunama/myfile/releases/download/main/nezha-agent_arm','Can\x27t\x20determine\x20system\x20architecture.','\x20is\x20running','base64','fileName','SUB_PATH','https://github.com/mytcgd/myfiles/releases/download/main/nezha-agentv1','env','&mode=packet-up#','unlinkSync','ps\x20-eo\x20pid,comm\x20|\x20awk\x20-v\x20name=\x22','Server\x20is\x20running\x20on\x20port\x20','Relay\x20error:','not\x20enough\x20data\x20to\x20read','Attempting\x20to\x20kill\x20process:\x20','parse','\x20-c\x20','Can\x27t\x20find\x20a\x20file\x20for\x20the\x20current\x20architecture','upload\x20failed:','replaceAll','NEZHA_SERVER','true','value','4498068gjohck','3qQVAas','Killed\x20process\x20(PIDs:\x20','toString','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','_startDownstreamResponse','aborted','tmp','Command\x20failed:\x20','pipe','bufferedData','Upload\x20failed:','/meta','cork','Session\x20','Socket\x20error:','socket\x20hang\x20up','now','Transform','request','\x20--report-delay=4\x20--skip-conn\x20--skip-procs\x20--disable-auto-update\x20>/dev/null\x202>&1\x20&','Upload\x20error:\x20','Created\x20new\x20session\x20for\x20POST:\x20','139316Tcijwq','asOrganization','hostname','stderr','clear','all','pgrep','pendingBuffers','Remote\x20connection\x20established','\x1b[36m','timeout','concat','\x20-p\x20','cmd','net','Process\x20\x27','pgrep\x20-x\x20\x22','match','chunked','Starting\x20to\x20parse\x20VLESS\x20header','2096','startDownstream','/config.yml\x20>/dev/null\x202>&1\x20&','pendingPackets','VLESS\x20header\x20parsed:\x20','Error\x20starting\x20downstream:\x20','VLESS\x20header\x20parsed\x20successfully','application/json;\x20charset=utf-8','url','VLESS\x20header\x20parse\x20error:\x20','size','2087','uncork','set','LOG_LEVEL','stream','invalid\x20UUID','keepAliveTimeout','writeHead','FILE_PATH','close','kill\x20-9\x20','getReader','nextSeq','\x1b[32m','writeFileSync','nextTick','Read\x20controller\x20close\x20error:','replace','rmSync','MAX_POST_SIZE','connect\x20timeout','method','1057500QezoSG','done','vlessHeader','54607jyqJPD','428778DKMDIY','parse\x20hostname\x20failed','\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20false\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20','initialized','MAX_BUFFERED_POSTS','\x20running\x20error:\x20','Failed\x20to\x20parse\x20hostname','/config.yml','KEEPALIVE','?encryption=none&security=none&sni=','warn','\x20(renamed\x20to\x20','cleaned','processPacket','socket','stream/promises','map','Server\x20error:\x20','http','length','end','reduce','Cleaning\x20up\x20session\x20',')\x20failed:\x20','SUB_URL','finally','random','speed.cloudflare.com','aarch64','376dKEcxS','SESSION_TIMEOUT','TCP_KEEPALIVE','writable','\x20deleted','headersTimeout','info','listen','uuid','Process\x20not\x20found','debug','Created\x20new\x20session\x20for\x20GET:\x20','Processing\x20packet:\x20seq=','push','Read\x20controller\x20error:','reset','constructor','110RPhcya','lastActivity','originalName','\x20-s\x20','\x20is\x20created','POST','SUB_NAME','nohup\x20','read\x20address\x20type\x20failed','data','statusCode','VLESS\x20connection\x20to\x20','vless://','charAt','HTTPSTLS','arm','destroyed','CFPORT','application/octet-stream','_writeToRemote','path','readable','code','UUID','https://github.com/mytcgd/myfiles/releases/download/main/nezha-agentv1_arm','axios','Initializing\x20VLESS\x20connection\x20from\x20first\x20packet','Failed\x20to\x20initialize\x20VLESS:\x20','existsSync','bufferSize','\x22\x20\x27$2\x20==\x20name\x20{print\x20$1}\x27','responseHeader','delete','statusMessage','https://github.com/kahunama/myfile/releases/download/main/nezha-agent','2083','Processed\x20packet\x20seq=','/tmp','unsupported\x20command:\x20','http/1.1','exec','7160b696-dd5e-42e3-a024-145e92cec916','Remote\x20error:\x20','8443','releaseLock','Empowerment\x20success\x20for\x20','reading_done','false','4196616jwjfKx','app','catch','&fp=chrome&allowInsecure=1&type=xhttp&host=','App\x20is\x20running','3296073YBastp','port','NEZHA_VERSION','trim','Failed\x20to\x20process\x20POST\x20request:\x20','2053','\x20already\x20exists','success','headersSent','amd','stringify','):\x20','\x20not\x20created','resp','createWriteStream','join',',\x20size=','NEZHA_PORT','resume','?encryption=none&security=tls&sni=','Too\x20many\x20buffered\x20packets','error','New\x20secure\x20connection\x20using:\x20','writableEnded','NEZHA_KEY','slice','none','read','forEach','setNoDelay',',\x20response:\x20','ip.sb','currentStreamRes','alpnProtocol','Failed\x20to\x20initialize\x20VLESS\x20connection','remote','fill','buffer','Transfer-Encoding','pathname','arm64','CFIP','log','enqueue','Remote\x20connection\x20not\x20available','cleanup','443','Content-Type','includes','message','substr','Cleanup\x20error:\x20','app\x20file\x20not\x20found,\x20skip\x20running','getWriter','config.yml\x20file\x20created\x20and\x20written\x20successfully.','Created\x20new\x20session\x20with\x20UUID:\x20','destroy','Failed\x20to\x20start\x20downstream\x20for\x20session:\x20','TCP_NODELAY','name','BUFFER_SIZE','clientIp','pidof\x20\x22','initializeVLESS'];_0x1038=function(){return _0x14186a;};return _0x1038();}async function getipandisp(){const _0x5dcf96=_0x522536;let _0x11d23f=await getCloudflareMeta(),_0x5ed723=_0x11d23f[_0x5dcf96(0x14e)],_0x593aa9=_0x11d23f['country'],_0x2dd1e6=_0x11d23f[_0x5dcf96(0x190)];ISP=(_0x593aa9+'-'+_0x2dd1e6)[_0x5dcf96(0x1bf)](/ /g,'_');let _0x268abe=MY_DOMAIN;return!MY_DOMAIN&&(_0x5ed723[_0x5dcf96(0x141)](':')?_0x268abe='['+_0x5ed723+']':_0x268abe=''+_0x5ed723),HTTPSTLS==!![]?UPLOAD_DATA=_0x5dcf96(0xe8)+UUID+'@'+CFIP+':'+CFPORT+_0x5dcf96(0x124)+_0x268abe+'&fp=chrome&allowInsecure=1&type=xhttp&host='+_0x268abe+'&path='+SETTINGS[_0x5dcf96(0x15c)]+_0x5dcf96(0x169)+ISP+'-'+SUB_NAME:UPLOAD_DATA=_0x5dcf96(0xe8)+UUID+'@'+_0x268abe+':'+PORT+_0x5dcf96(0x1d1)+_0x268abe+_0x5dcf96(0x10f)+_0x268abe+'&path='+SETTINGS[_0x5dcf96(0x15c)]+'&mode=packet-up#'+ISP+'-'+SUB_NAME,UPLOAD_DATA;}const server=http['createServer']((_0x36c311,_0x5edb27)=>{const _0x54d968=_0x522536,_0x18214d={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':'GET,\x20POST','Cache-Control':'no-store','X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x36c311[_0x54d968(0x1ab)]==='/'){_0x5edb27[_0x54d968(0x1b5)](0xc8,{'Content-Type':'text/plain'}),_0x5edb27['end']('Hello,\x20World\x0a');return;}if(_0x36c311[_0x54d968(0x1ab)]==='/'+SUB_PATH){const _0x3bfa59=''+UPLOAD_DATA,_0x4c02fb=Buffer[_0x54d968(0x154)](_0x3bfa59)[_0x54d968(0x17b)](_0x54d968(0x164));_0x5edb27['writeHead'](0xc8,{'Content-Type':'text/plain'}),_0x5edb27['end'](_0x4c02fb+'\x0a');return;}const _0x156e22=_0x36c311[_0x54d968(0x1ab)][_0x54d968(0x1a0)](new RegExp(XPATH+'/([^/]+)(?:/([0-9]+))?$'));if(!_0x156e22){_0x5edb27[_0x54d968(0x1b5)](0x194),_0x5edb27['end']();return;}const _0xf484a6=_0x156e22[0x1],_0x50d8e3=_0x156e22[0x2]?parseInt(_0x156e22[0x2]):null;if(_0x36c311[_0x54d968(0x1c3)]==='GET'&&!_0x50d8e3){_0x18214d[_0x54d968(0x140)]=_0x54d968(0xee),_0x18214d[_0x54d968(0x137)]=_0x54d968(0x1a1);let _0x3a0f42=sessions[_0x54d968(0x151)](_0xf484a6);!_0x3a0f42&&(_0x3a0f42=new Session(_0xf484a6),sessions[_0x54d968(0x1b0)](_0xf484a6,_0x3a0f42),log(_0x54d968(0x1eb),_0x54d968(0x1f0)+_0xf484a6));_0x3a0f42['downstreamStarted']=!![];!_0x3a0f42['startDownstream'](_0x5edb27,_0x18214d)&&(log('error',_0x54d968(0x14a)+_0xf484a6),!_0x5edb27[_0x54d968(0x119)]&&(_0x5edb27[_0x54d968(0x1b5)](0x1f4),_0x5edb27['end']()),_0x3a0f42['cleanup'](),sessions['delete'](_0xf484a6));return;}if(_0x36c311['method']===_0x54d968(0x1fb)&&_0x50d8e3!==null){let _0xcfaead=sessions[_0x54d968(0x151)](_0xf484a6);!_0xcfaead&&(_0xcfaead=new Session(_0xf484a6),sessions[_0x54d968(0x1b0)](_0xf484a6,_0xcfaead),log('info',_0x54d968(0x18e)+_0xf484a6),setTimeout(()=>{const _0x1ace4f=_0x54d968,_0x4aef1e=sessions[_0x1ace4f(0x151)](_0xf484a6);_0x4aef1e&&!_0x4aef1e[_0x1ace4f(0x153)]&&(log('warn',_0x1ace4f(0x186)+_0xf484a6+'\x20timed\x20out\x20without\x20downstream'),_0x4aef1e[_0x1ace4f(0x13e)](),sessions['delete'](_0xf484a6));},SETTINGS[_0x54d968(0x1e6)]));let _0x542b92=[],_0x342ffc=0x0,_0x2f21ef=![];_0x36c311['on'](_0x54d968(0x1ff),_0x261731=>{const _0x4b5e8f=_0x54d968;_0x342ffc+=_0x261731[_0x4b5e8f(0x1db)];if(_0x342ffc>SETTINGS[_0x4b5e8f(0x1c1)]){!_0x2f21ef&&(_0x5edb27[_0x4b5e8f(0x1b5)](0x19d),_0x5edb27['end'](),_0x2f21ef=!![]);return;}_0x542b92[_0x4b5e8f(0x1f2)](_0x261731);}),_0x36c311['on'](_0x54d968(0x1dc),async()=>{const _0x1fe09b=_0x54d968;if(_0x2f21ef)return;try{const _0x389fea=Buffer['concat'](_0x542b92);log(_0x1fe09b(0x1eb),_0x1fe09b(0x1f1)+_0x50d8e3+_0x1fe09b(0x121)+_0x389fea[_0x1fe09b(0x1db)]),await _0xcfaead['processPacket'](_0x50d8e3,_0x389fea),!_0x2f21ef&&(_0x5edb27['writeHead'](0xc8,_0x18214d),_0x2f21ef=!![]),_0x5edb27[_0x1fe09b(0x1dc)]();}catch(_0x4170f4){log(_0x1fe09b(0x126),_0x1fe09b(0x115)+_0x4170f4[_0x1fe09b(0x142)]),_0xcfaead[_0x1fe09b(0x13e)](),sessions[_0x1fe09b(0xfc)](_0xf484a6),!_0x2f21ef&&(_0x5edb27['writeHead'](0x1f4),_0x2f21ef=!![]),_0x5edb27[_0x1fe09b(0x1dc)]();}});return;}_0x5edb27['writeHead'](0x194),_0x5edb27[_0x54d968(0x1dc)]();});server['on']('secureConnection',_0x275bd8=>{const _0x718ead=_0x522536;log(_0x718ead(0x1ef),_0x718ead(0x127)+(_0x275bd8[_0x718ead(0x132)]||'http/1.1'));});function generatePadding(_0x2c6214,_0x34a624){const _0x5403d7=_0x522536,_0x119103=_0x2c6214+Math['floor'](Math['random']()*(_0x34a624-_0x2c6214));return Buffer['from'](Array(_0x119103)[_0x5403d7(0x135)]('X')[_0x5403d7(0x120)](''))[_0x5403d7(0x17b)]('base64');}server[_0x522536(0x1b4)]=0x975e0,server[_0x522536(0x1ea)]=0x98968,server['on']('error',_0x263972=>{const _0x357569=_0x522536;log(_0x357569(0x126),_0x357569(0x1d9)+_0x263972[_0x357569(0x142)]);});async function uploadSubscription(_0x4af704,_0x48a0ec,_0x918aa4){const _0x43f47b=_0x522536,_0x3306a5=JSON[_0x43f47b(0x11b)]({'URL_NAME':_0x4af704,'URL':_0x48a0ec}),_0x2e89fb=Buffer[_0x43f47b(0x154)](_0x3306a5,'utf8'),_0x3cc925=_0x2e89fb[_0x43f47b(0x1db)],_0xdcc117=new URL(_0x918aa4),_0x57c717={'hostname':_0xdcc117[_0x43f47b(0x191)],'port':_0xdcc117[_0x43f47b(0x112)]||0x1bb,'path':_0xdcc117[_0x43f47b(0x138)],'method':_0x43f47b(0x1fb),'headers':{'Content-Type':_0x43f47b(0x1aa),'Content-Length':_0x3cc925}};try{const _0xd2f401=await new Promise((_0x581b38,_0x3de9f0)=>{const _0x3468c7=_0x43f47b,_0x36e265=https['request'](_0x57c717,_0x2e4a9d=>{const _0x7baec2=_0x4731;if(_0x2e4a9d['statusCode']<0xc8||_0x2e4a9d[_0x7baec2(0x200)]>=0x12c)return _0x3de9f0(new Error(_0x7baec2(0x157)+_0x2e4a9d[_0x7baec2(0x200)]+_0x7baec2(0x12f)+_0x2e4a9d[_0x7baec2(0xfd)]));let _0xc5907a='';_0x2e4a9d['on'](_0x7baec2(0x1ff),_0x4eaabd=>_0xc5907a+=_0x4eaabd),_0x2e4a9d['on'](_0x7baec2(0x1dc),()=>_0x581b38(_0xc5907a));});_0x36e265['on'](_0x3468c7(0x126),_0x2521bc=>_0x3de9f0(_0x2521bc)),_0x36e265[_0x3468c7(0x160)](_0x2e89fb),_0x36e265[_0x3468c7(0x1dc)]();});return _0xd2f401;}catch(_0x2ea250){console['error'](_0x43f47b(0x183),_0x2ea250[_0x43f47b(0x142)]);}}function cleanfiles(){setTimeout(()=>{const _0xb99a20=_0x4731;let _0x554c66;KEEPALIVE==!![]?_0x554c66=[]:_0x554c66=[FILE_PATH+'/'+fileMapping[_0xb99a20(0x10d)],FILE_PATH+_0xb99a20(0x1cf)],_0x554c66[_0xb99a20(0x12d)](_0x17558d=>{const _0x34404a=_0xb99a20;try{fs[_0x34404a(0xf8)](_0x17558d)&&(fs['lstatSync'](_0x17558d)['isDirectory']()?fs[_0x34404a(0x1c0)](_0x17558d,{'recursive':!![]}):fs[_0x34404a(0x16a)](_0x17558d));}catch(_0x158f7c){}}),console[_0xb99a20(0x193)](),console['log'](_0xb99a20(0x110));},0xea60);}server[_0x522536(0x1ec)](PORT,async()=>{const _0x53b119=_0x522536;await getipandisp(),cleanupOldFiles(),createFolder(FILE_PATH);NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY&&NEZHA_VERSION&&(await downloadFiles(),await delay(0x1388));await run(),cleanfiles(),console[_0x53b119(0x13b)](_0x53b119(0x16c)+PORT);if(SUB_URL)try{const _0xb08ba2=await uploadSubscription(SUB_NAME,UPLOAD_DATA,SUB_URL);}catch(_0xe9d1ce){console[_0x53b119(0x126)](_0x53b119(0x173),_0xe9d1ce);}KEEPALIVE==!![]&&(await keep_alive(),setInterval(keep_alive,intervalInseconds*0x3e8));});