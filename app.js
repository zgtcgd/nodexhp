const _0xe794fb=_0x1182;(function(_0x2200fd,_0x506168){const _0x443b4d=_0x1182,_0x1469f6=_0x2200fd();while(!![]){try{const _0x51c23c=-parseInt(_0x443b4d(0xc9))/0x1+-parseInt(_0x443b4d(0x19c))/0x2+parseInt(_0x443b4d(0xef))/0x3*(-parseInt(_0x443b4d(0x11e))/0x4)+parseInt(_0x443b4d(0xd4))/0x5+-parseInt(_0x443b4d(0x108))/0x6*(parseInt(_0x443b4d(0x1a4))/0x7)+parseInt(_0x443b4d(0x1b4))/0x8+parseInt(_0x443b4d(0xc3))/0x9;if(_0x51c23c===_0x506168)break;else _0x1469f6['push'](_0x1469f6['shift']());}catch(_0x33af1e){_0x1469f6['push'](_0x1469f6['shift']());}}}(_0x3df2,0x7feb0));const FILE_PATH=process[_0xe794fb(0x18f)][_0xe794fb(0x198)]||'/tmp',intervalInseconds=process[_0xe794fb(0x18f)][_0xe794fb(0x102)]||0x64,SUB_PATH=process['env'][_0xe794fb(0x1b7)]||_0xe794fb(0xf1),PORT=process[_0xe794fb(0x18f)][_0xe794fb(0x10a)]||0xbb8,CFPORT=process[_0xe794fb(0x18f)][_0xe794fb(0x158)]||0x1bb,CFIP=process[_0xe794fb(0x18f)][_0xe794fb(0x162)]||_0xe794fb(0x17c),KEEPALIVE=process['env'][_0xe794fb(0x135)]||![],SUB_URL=process['env']['SUB_URL']||'',UUID=process[_0xe794fb(0x18f)][_0xe794fb(0x1b1)]||_0xe794fb(0x1b8),XPATH=process[_0xe794fb(0x18f)][_0xe794fb(0x1a0)]||UUID[_0xe794fb(0xd9)](0x0,0x8),HTTPSTLS=process[_0xe794fb(0x18f)][_0xe794fb(0x109)]||!![],NEZHA_VERSION=process[_0xe794fb(0x18f)]['NEZHA_VERSION']||'V0',NEZHA_SERVER=process[_0xe794fb(0x18f)]['NEZHA_SERVER']||'',NEZHA_PORT=process[_0xe794fb(0x18f)]['NEZHA_PORT']||_0xe794fb(0xd7),NEZHA_KEY=process[_0xe794fb(0x18f)][_0xe794fb(0x12c)]||'',SUB_NAME=process[_0xe794fb(0x18f)][_0xe794fb(0x14f)]||'',MY_DOMAIN=process[_0xe794fb(0x18f)][_0xe794fb(0xeb)]||'',LOCAL_DOMAIN=process[_0xe794fb(0x18f)][_0xe794fb(0x1af)]||'',os=require('os'),fs=require('fs'),net=require(_0xe794fb(0x12a)),path=require(_0xe794fb(0x187)),http=require('http'),https=require(_0xe794fb(0xf7)),axios=require(_0xe794fb(0xd1)),{pipeline}=require(_0xe794fb(0xc2)),{Buffer}=require(_0xe794fb(0x1c3)),exec=require(_0xe794fb(0x14e))[_0xe794fb(0x1c5)],delay=_0x43bfd1=>new Promise(_0x4b57bc=>setTimeout(_0x4b57bc,_0x43bfd1)),SETTINGS={['UUID']:UUID,[_0xe794fb(0x164)]:_0xe794fb(0x152),[_0xe794fb(0x120)]:_0xe794fb(0x131),[_0xe794fb(0x1a0)]:_0xe794fb(0x169)+XPATH,[_0xe794fb(0x16b)]:0x1e,[_0xe794fb(0x1c8)]:0xf4240,[_0xe794fb(0x175)]:0x7530,[_0xe794fb(0xf0)]:0x400*0x400,[_0xe794fb(0xd5)]:!![],[_0xe794fb(0xee)]:!![]};function validate_uuid(_0x8d04ad,_0x248bad){for(let _0x47f266=0x0;_0x47f266<0x10;_0x47f266++){if(_0x8d04ad[_0x47f266]!==_0x248bad[_0x47f266])return![];}return!![];}function concat_typed_arrays(_0x1f03b8,..._0x30f804){const _0x5585b1=_0xe794fb;if(!_0x30f804||_0x30f804[_0x5585b1(0x136)]<0x1)return _0x1f03b8;let _0x2d7c39=_0x1f03b8[_0x5585b1(0x136)];for(let _0x5e9317 of _0x30f804)_0x2d7c39+=_0x5e9317[_0x5585b1(0x136)];const _0x478ce6=new _0x1f03b8[(_0x5585b1(0xda))](_0x2d7c39);_0x478ce6[_0x5585b1(0x1c7)](_0x1f03b8,0x0),_0x2d7c39=_0x1f03b8[_0x5585b1(0x136)];for(let _0x13f764 of _0x30f804){_0x478ce6[_0x5585b1(0x1c7)](_0x13f764,_0x2d7c39),_0x2d7c39+=_0x13f764[_0x5585b1(0x136)];}return _0x478ce6;}function log(_0x234289,..._0x26de00){const _0x82c083=_0xe794fb;if(SETTINGS['LOG_LEVEL']===_0x82c083(0x152))return;const _0xd37688={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x1f6920={'debug':_0x82c083(0x125),'info':_0x82c083(0x10f),'warn':_0x82c083(0x13b),'error':_0x82c083(0xcf),'reset':_0x82c083(0x1be)},_0xfd848=_0xd37688[SETTINGS[_0x82c083(0x164)]]||0x1,_0x4824b1=_0xd37688[_0x234289]||0x0;if(_0x4824b1>=_0xfd848){const _0x23055e=new Date()[_0x82c083(0x12e)](),_0x228070=_0x1f6920[_0x234289]||_0x1f6920['reset'];console[_0x82c083(0x151)](_0x228070+'['+_0x23055e+']\x20['+_0x234289+']',..._0x26de00,_0x1f6920['reset']);}}function cleanupOldFiles(){const _0x5447e6=_0xe794fb;try{if(fs[_0x5447e6(0x139)](path[_0x5447e6(0x10c)](FILE_PATH)))fs[_0x5447e6(0x1bf)](path[_0x5447e6(0x10c)](FILE_PATH),{'recursive':!![]});else{}}catch(_0x48b090){}}function createFolder(_0x58c25b){const _0x21acad=_0xe794fb;if(!fs[_0x21acad(0x139)](_0x58c25b))fs['mkdirSync'](_0x58c25b);else{}}function execPromise(_0xf5f75d,_0x3f8e76={}){return new Promise((_0xa4f98c,_0x1972d6)=>{const _0x21ebdc=exec(_0xf5f75d,_0x3f8e76,(_0x14951a,_0x71dce8,_0x530021)=>{const _0x1e7eab=_0x1182;if(_0x14951a){const _0x17b966=new Error(_0x1e7eab(0x18e)+_0x14951a[_0x1e7eab(0x13e)]);_0x17b966[_0x1e7eab(0xd0)]=_0x14951a[_0x1e7eab(0xd0)],_0x17b966['stderr']=_0x530021['trim'](),_0x1972d6(_0x17b966);}else _0xa4f98c(_0x71dce8['trim']());});});}async function detectProcess(_0x20829e){const _0x537c7c=_0xe794fb,_0x2ed797=[{'cmd':'pidof\x20\x22'+_0x20829e+'\x22','name':_0x537c7c(0x143)},{'cmd':_0x537c7c(0x15a)+_0x20829e+'\x22','name':_0x537c7c(0xf2)},{'cmd':'ps\x20-eo\x20pid,comm\x20|\x20awk\x20-v\x20name=\x22'+_0x20829e+_0x537c7c(0xc8),'name':_0x537c7c(0x182)}];for(const _0x957798 of _0x2ed797){try{const _0x797e1c=await execPromise(_0x957798[_0x537c7c(0xbd)]);if(_0x797e1c)return _0x797e1c[_0x537c7c(0x107)](/\n/g,'\x20')[_0x537c7c(0x1b9)]();}catch(_0x4dfbab){_0x4dfbab[_0x537c7c(0xd0)]!==0x7f&&_0x4dfbab['code']!==0x1&&console[_0x537c7c(0x15c)]('[detectProcess]\x20'+_0x957798[_0x537c7c(0xfd)]+_0x537c7c(0xf3),_0x4dfbab['message']);}}return'';}async function killProcess(_0x1c86bf){const _0x4b12b7=_0xe794fb;console[_0x4b12b7(0x151)]('Attempting\x20to\x20kill\x20process:\x20'+_0x1c86bf);try{const _0x26f4e5=await detectProcess(_0x1c86bf);if(!_0x26f4e5)return console[_0x4b12b7(0xe3)](_0x4b12b7(0xe8)+_0x1c86bf+_0x4b12b7(0x17d)),{'success':!![],'message':_0x4b12b7(0xed)};await execPromise('kill\x20-9\x20'+_0x26f4e5);const _0x179baf=_0x4b12b7(0xd8)+_0x26f4e5+')';return console[_0x4b12b7(0x151)](_0x179baf),{'success':!![],'message':_0x179baf};}catch(_0x9a7549){const _0x4bd99c=_0x4b12b7(0x14a)+_0x9a7549['message'];return console[_0x4b12b7(0x18d)](_0x4bd99c),{'success':![],'message':_0x4bd99c};}}function generateRandomString(_0x2310d4){const _0x531e3d=_0xe794fb,_0x43ec1f='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';let _0x5bc89a='';for(let _0xc09862=0x0;_0xc09862<_0x2310d4;_0xc09862++){_0x5bc89a+=_0x43ec1f[_0x531e3d(0x119)](Math[_0x531e3d(0x15b)](Math[_0x531e3d(0xfb)]()*_0x43ec1f['length']));}return _0x5bc89a;}function getSystemArchitecture(){const _0xac2b95=_0xe794fb,_0x3b9143=os[_0xac2b95(0xc5)]();return _0x3b9143==='arm'||_0x3b9143===_0xac2b95(0x1a3)||_0x3b9143===_0xac2b95(0xc6)?'arm':_0xac2b95(0x11b);}function getFilesForArchitecture(_0x5c5902){const _0x515a9f=_0xe794fb,_0x592444={'app':{'V0':{'arm':_0x515a9f(0x192),'amd':'https://github.com/kahunama/myfile/releases/download/main/nezha-agent'},'V1':{'arm':_0x515a9f(0x155),'amd':_0x515a9f(0xbe)}}};if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY&&NEZHA_VERSION){const _0x167874=[{'fileName':'tmp'+generateRandomString(0x5),'originalName':_0x515a9f(0x180),'fileUrl':_0x592444[_0x515a9f(0x180)][NEZHA_VERSION][_0x5c5902]}];return _0x167874;}else return[];}async function download_function(_0x3c7480,_0x451df3,_0x1ec8c1){const _0x2930b7=_0xe794fb,_0x17e37d=path['join'](FILE_PATH,_0x3c7480);let _0x473ac0=![];try{const _0x23a200=await axios({'method':'get','url':_0x1ec8c1,'responseType':'stream'});await pipeline(_0x23a200['data'],fs[_0x2930b7(0x104)](_0x17e37d)),_0x473ac0=!![];}catch(_0x26066c){}return{'fileName':_0x3c7480,'originalName':_0x451df3,'filePath':_0x17e37d,'success':_0x473ac0};}let fileMapping={};async function downloadFiles(){const _0x326476=_0xe794fb;try{const _0x31a873=getSystemArchitecture();if(!_0x31a873)return console[_0x326476(0x151)](_0x326476(0x1bd)),fileMapping;const _0x6b267d=getFilesForArchitecture(_0x31a873);if(_0x6b267d[_0x326476(0x136)]===0x0)return console[_0x326476(0x151)](_0x326476(0xcb)),fileMapping;const _0x2be258=_0x6b267d[_0x326476(0x179)](_0x27936d=>download_function(_0x27936d[_0x326476(0x11a)],_0x27936d['originalName'],_0x27936d[_0x326476(0xfc)])),_0x4d62e2=await Promise[_0x326476(0x166)](_0x2be258);return _0x4d62e2[_0x326476(0xe1)](_0x4e1f87=>{const _0x2c28a9=_0x326476;if(_0x4e1f87[_0x2c28a9(0x156)])try{fs[_0x2c28a9(0xdf)](_0x4e1f87[_0x2c28a9(0x19b)],0x1ed),fileMapping[_0x4e1f87[_0x2c28a9(0xcd)]]=_0x4e1f87['fileName'];}catch(_0x5a1902){}}),fileMapping;}catch(_0x94617b){return console[_0x326476(0x18d)](_0x326476(0x1c2),_0x94617b),fileMapping;}}let NEZHA_TLS;function nezconfig(){const _0x339e19=_0xe794fb,_0x45cf9a=[_0x339e19(0xd7),'8443',_0x339e19(0x117),'2087',_0x339e19(0x18b),_0x339e19(0x157)];if(NEZHA_VERSION==='V0')return _0x45cf9a['includes'](NEZHA_PORT)?NEZHA_TLS='--tls':NEZHA_TLS='',NEZHA_TLS;else{if(NEZHA_VERSION==='V1'){_0x45cf9a[_0x339e19(0x172)](NEZHA_PORT)?NEZHA_TLS='true':NEZHA_TLS=_0x339e19(0xe2);const _0x4a6b6d=path[_0x339e19(0x10c)](FILE_PATH,'/config.yml'),_0x4a77ac=_0x339e19(0x1b5)+NEZHA_KEY+_0x339e19(0x17a)+NEZHA_SERVER+':'+NEZHA_PORT+_0x339e19(0x174)+NEZHA_TLS+_0x339e19(0x15d)+UUID;try{fs[_0x339e19(0x161)](_0x4a6b6d,_0x4a77ac);}catch(_0x3b8e30){}}}}async function runapp(){const _0x56dc83=_0xe794fb;if(fileMapping[_0x56dc83(0x180)]&&fs['existsSync'](path[_0x56dc83(0x10c)](FILE_PATH,fileMapping[_0x56dc83(0x180)]))){if(NEZHA_VERSION==='V0'){const _0x27dc7f=_0x56dc83(0x100)+FILE_PATH+'/'+fileMapping[_0x56dc83(0x180)]+_0x56dc83(0x145)+NEZHA_SERVER+':'+NEZHA_PORT+_0x56dc83(0x12b)+NEZHA_KEY+'\x20'+NEZHA_TLS+_0x56dc83(0x1b3);try{await execPromise(_0x27dc7f);}catch(_0x46efba){console['error'](fileMapping[_0x56dc83(0x180)]+_0x56dc83(0xf6)+_0x46efba);}}else{if(NEZHA_VERSION==='V1'){const _0x11a136=_0x56dc83(0x100)+FILE_PATH+'/'+fileMapping[_0x56dc83(0x180)]+_0x56dc83(0x163)+FILE_PATH+_0x56dc83(0xc1);try{await execPromise(_0x11a136);}catch(_0x4727e0){console[_0x56dc83(0x18d)](fileMapping['app']+_0x56dc83(0xf6)+_0x4727e0);}}}}else console['log'](_0x56dc83(0x190));}function _0x3df2(){const _0x5d9cc8=['success','2053','CFPORT','port','pgrep\x20-x\x20\x22','floor','debug','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','aborted','HTTP\x20error!\x20status:\x20','Server\x20is\x20running\x20on\x20port\x20','writeFileSync','CFIP','\x20-c\x20','LOG_LEVEL','Too\x20many\x20buffered\x20packets','all','/meta','request','%2F','bufferedData','MAX_BUFFERED_POSTS','Remote\x20connection\x20established','writeHead','socket\x20hang\x20up','&fp=chrome&allowInsecure=1&type=xhttp&host=','clear','catch','includes','bufferSize','\x0askip_connection_count:\x20false\x0askip_procs_count:\x20false\x0atemperature:\x20false\x0atls:\x20','SESSION_TIMEOUT','push','Transform','http/1.1','map','\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20false\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20','Failed\x20to\x20initialize\x20VLESS\x20connection','ip.sb','\x27\x20not\x20found','currentStreamRes','Session\x20','app','utf8','ps+awk','read\x20vless\x20header\x20error:\x20','speed.cloudflare.com','&path=','?encryption=none&security=none&sni=','path','application/json;\x20charset=utf-8','Failed\x20to\x20process\x20POST\x20request:\x20','alpnProtocol','2083','Connected\x20to\x20','error','Command\x20failed:\x20','env','app\x20file\x20not\x20found,\x20skip\x20running','_startDownstreamResponse','https://github.com/kahunama/myfile/releases/download/main/nezha-agent_arm','writable','Upload\x20error:\x20','pipeTo','resp','timeout','FILE_PATH','Remote\x20connection\x20not\x20available','Node\x20variable\x20is\x20empty,\x20skip\x20running','filePath','1580066dCRHib','nextSeq','cleaned','Relay\x20error:','XPATH','startDownstream','Buffered\x20packet\x20seq=','arm64','7qPAQJC','releaseLock','&mode=packet-up#','Failed\x20to\x20parse\x20hostname','stringify','createServer','statusMessage','nextTick','decode','getWriter','Process\x20packet\x20error:\x20','LOCAL_DOMAIN','listen','UUID','chunked','\x20--report-delay=4\x20--skip-conn\x20--skip-procs\x20--disable-auto-update\x20>/dev/null\x202>&1\x20&','6057384tswuMw','client_secret:\x20','parse','SUB_PATH','7160b696-dd5e-42e3-a024-145e92cec916','trim','application/octet-stream','setNoDelay','pendingBuffers','Can\x27t\x20determine\x20system\x20architecture.','\x1b[0m','rmSync','get','data','Error\x20downloading\x20files:','buffer','App\x20is\x20running','exec','Socket\x20is\x20destroyed','set','MAX_POST_SIZE','cmd','https://github.com/mytcgd/myfiles/releases/download/main/nezha-agentv1','headersSent','readable','/config.yml\x20>/dev/null\x202>&1\x20&','stream/promises','9301491TuePkR','setKeepAlive','arch','aarch64','headersTimeout','\x22\x20\x27$2\x20==\x20name\x20{print\x20$1}\x27','462583zZuNgQ','Created\x20new\x20session\x20for\x20POST:\x20','Can\x27t\x20find\x20a\x20file\x20for\x20the\x20current\x20architecture','GET','originalName','):\x20','\x1b[31m','code','axios','url','remote','1393135BdLFLz','TCP_NODELAY','downstreamStarted','443','Killed\x20process\x20(PIDs:\x20','slice','constructor','\x20timed\x20out\x20without\x20downstream','VLESS\x20connection\x20to\x20','Download\x20error:\x20','POST','chmodSync','Content-Type','forEach','false','warn','secureConnection','uuid','VLESS\x20header\x20parsed:\x20','initializeVLESS','Process\x20\x27','socket','destroyed','MY_DOMAIN','Error\x20starting\x20downstream:\x20','Process\x20not\x20found','TCP_KEEPALIVE','137343qnbXNM','CHUNK_SIZE','sub','pgrep','\x20error:','Cleanup\x20error:\x20','Connection\x20failed:\x20','\x20running\x20error:\x20','https','toString','invalid\x20UUID','end','random','fileUrl','name','connect','not\x20enough\x20data\x20to\x20read','nohup\x20','VLESS\x20header\x20parse\x20error:\x20','TIME','vless://','createWriteStream','Received\x20out\x20of\x20order\x20packet\x20seq=','from','replace','1207014crtPJy','HTTPSTLS','PORT','replaceAll','join','statusCode','Hello,\x20World\x0a','\x1b[32m','value','no-store','enqueue','fill','resume','createConnection','delete','2096','\x20before\x20initialization','charAt','fileName','amd','cleanup','finally','8PqqwKB','pipe','BUFFER_SIZE','headerSent','Failed\x20to\x20write\x20to\x20remote:\x20','write','_writeToRemote','\x1b[36m','responseHeader','concat','upload\x20failed:','close','net','\x20-p\x20','NEZHA_KEY','initialized','toISOString','unsupported\x20command:\x20','Created\x20new\x20session\x20for\x20GET:\x20','2048','text/plain','getReader','Client\x20connection\x20closed','KEEPALIVE','length','vlessHeader','processPacket','existsSync','Server\x20error:\x20','\x1b[33m','writableEnded','cork','message','hostname','Cleaning\x20up\x20session\x20','stream','\x20bytes','pidof','read','\x20-s\x20','Read\x20controller\x20close\x20error:','reduce','pendingPackets','Starting\x20to\x20parse\x20VLESS\x20header','Kill\x20failed:\x20','/config.yml','info',',\x20size=','child_process','SUB_NAME',',\x20response:\x20','log','none','destroy','method','https://github.com/mytcgd/myfiles/releases/download/main/nezha-agentv1_arm'];_0x3df2=function(){return _0x5d9cc8;};return _0x3df2();}async function run(){const _0x399b9b=_0xe794fb;if(NEZHA_VERSION&&NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){nezconfig();const _0x496d57=await detectProcess(''+fileMapping['app']);if(_0x496d57){}else await runapp();await delay(0x3e8);}else console[_0x399b9b(0x151)](_0x399b9b(0x19a));}async function keep_alive(){const _0x2af681=_0xe794fb;if(NEZHA_VERSION&&NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0xe91577=await detectProcess(''+fileMapping[_0x2af681(0x180)]);if(_0xe91577){}else await runapp();}}function parse_uuid(_0xd179c5){const _0x2c3738=_0xe794fb;_0xd179c5=_0xd179c5[_0x2c3738(0x10b)]('-','');const _0x308d4d=[];for(let _0x28ea7f=0x0;_0x28ea7f<0x10;_0x28ea7f++){_0x308d4d[_0x2c3738(0x176)](parseInt(_0xd179c5['substr'](_0x28ea7f*0x2,0x2),0x10));}return _0x308d4d;}async function read_vless_header(_0x50dd17,_0x3a72e3){const _0x10a86a=_0xe794fb;let _0x24a739=0x0,_0x347798=new Uint8Array(),_0x494ed6={'value':_0x347798,'done':![]};async function _0x1537b0(_0x3a9038){const _0x4ccef2=_0x1182;if(_0x494ed6['done'])throw new Error('header\x20length\x20too\x20short');const _0x3f4c79=_0x3a9038-_0x24a739;if(_0x3f4c79<0x1)return;_0x494ed6=await read_atleast(_0x50dd17,_0x3f4c79),_0x24a739+=_0x494ed6[_0x4ccef2(0x110)][_0x4ccef2(0x136)],_0x347798=concat_typed_arrays(_0x347798,_0x494ed6[_0x4ccef2(0x110)]);}await _0x1537b0(0x1+0x10+0x1);const _0x4ddb4a=_0x347798[0x0],_0x5d4606=_0x347798['slice'](0x1,0x1+0x10),_0x3af5aa=parse_uuid(_0x3a72e3);if(!validate_uuid(_0x5d4606,_0x3af5aa))throw new Error(_0x10a86a(0xf9));const _0x1fe2c0=_0x347798[0x1+0x10],_0x181def=0x1+0x10+0x1+_0x1fe2c0+0x1+0x2+0x1;await _0x1537b0(_0x181def+0x1);const _0x24a653=_0x347798[0x1+0x10+0x1+_0x1fe2c0],_0xba9e4e=0x1;if(_0x24a653!==_0xba9e4e)throw new Error(_0x10a86a(0x12f)+_0x24a653);const _0x409e66=(_0x347798[_0x181def-0x1-0x2]<<0x8)+_0x347798[_0x181def-0x1-0x1],_0x3cd4ed=_0x347798[_0x181def-0x1],_0x49ab71=0x1,_0x5068c0=0x2,_0x140b4a=0x3;let _0x1832ba=-0x1;if(_0x3cd4ed===_0x49ab71)_0x1832ba=_0x181def+0x4;else{if(_0x3cd4ed===_0x140b4a)_0x1832ba=_0x181def+0x10;else _0x3cd4ed===_0x5068c0&&(_0x1832ba=_0x181def+0x1+_0x347798[_0x181def]);}if(_0x1832ba<0x0)throw new Error('read\x20address\x20type\x20failed');await _0x1537b0(_0x1832ba);const _0x573120=_0x181def;let _0xee9c07='';if(_0x3cd4ed===_0x49ab71)_0xee9c07=_0x347798[_0x10a86a(0xd9)](_0x573120,_0x573120+0x4)[_0x10a86a(0x10c)]('.');else{if(_0x3cd4ed===_0x5068c0)_0xee9c07=new TextDecoder()[_0x10a86a(0x1ac)](_0x347798[_0x10a86a(0xd9)](_0x573120+0x1,_0x573120+0x1+_0x347798[_0x573120]));else _0x3cd4ed===_0x140b4a&&(_0xee9c07=_0x347798['slice'](_0x573120,_0x573120+0x10)[_0x10a86a(0x147)]((_0x249d51,_0x34f41f,_0x590fef,_0x3e8004)=>_0x590fef%0x2?_0x249d51[_0x10a86a(0x127)](((_0x3e8004[_0x590fef-0x1]<<0x8)+_0x34f41f)[_0x10a86a(0xf8)](0x10)):_0x249d51,[])[_0x10a86a(0x10c)](':'));}if(!_0xee9c07){log('error',_0x10a86a(0x1a7));throw new Error('parse\x20hostname\x20failed');}return log('info',_0x10a86a(0xdc)+_0xee9c07+':'+_0x409e66),{'hostname':_0xee9c07,'port':_0x409e66,'data':_0x347798[_0x10a86a(0xd9)](_0x1832ba),'resp':new Uint8Array([_0x4ddb4a,0x0])};}async function read_atleast(_0x55c199,_0x3e121a){const _0x186dd4=_0xe794fb,_0x37d3d5=[];let _0x5d7990=![];while(_0x3e121a>0x0&&!_0x5d7990){const _0x5fcdd3=await _0x55c199[_0x186dd4(0x144)]();if(_0x5fcdd3[_0x186dd4(0x110)]){const _0x57da15=new Uint8Array(_0x5fcdd3[_0x186dd4(0x110)]);_0x37d3d5['push'](_0x57da15),_0x3e121a-=_0x57da15[_0x186dd4(0x136)];}_0x5d7990=_0x5fcdd3['done'];}if(_0x3e121a>0x0)throw new Error(_0x186dd4(0xff));return{'value':concat_typed_arrays(..._0x37d3d5),'done':_0x5d7990};}async function parse_header(_0x1efccc,_0x53f86c){const _0x55e1f0=_0xe794fb;log(_0x55e1f0(0x15c),_0x55e1f0(0x149));const _0x301bb4=_0x53f86c[_0x55e1f0(0xc0)][_0x55e1f0(0x133)]();try{const _0x3b2b65=await read_vless_header(_0x301bb4,_0x1efccc);return log(_0x55e1f0(0x15c),'VLESS\x20header\x20parsed\x20successfully'),_0x3b2b65;}catch(_0x5c6b75){log(_0x55e1f0(0x18d),_0x55e1f0(0x101)+_0x5c6b75[_0x55e1f0(0x13e)]);throw new Error(_0x55e1f0(0x183)+_0x5c6b75[_0x55e1f0(0x13e)]);}finally{_0x301bb4[_0x55e1f0(0x1a5)]();}}async function connect_remote(_0x251921,_0x5c6cd3){const _0x3446f0=_0xe794fb,_0x3d4b03=0x1f40;try{const _0x2daa43=await timed_connect(_0x251921,_0x5c6cd3,_0x3d4b03);return _0x2daa43[_0x3446f0(0x1bb)](!![]),_0x2daa43[_0x3446f0(0xc4)](!![],0x3e8),_0x2daa43[_0x3446f0(0x173)]=parseInt(SETTINGS[_0x3446f0(0x120)])*0x400,log(_0x3446f0(0x14c),_0x3446f0(0x18c)+_0x251921+':'+_0x5c6cd3),_0x2daa43;}catch(_0x3d0fc){log(_0x3446f0(0x18d),_0x3446f0(0xf5)+_0x3d0fc[_0x3446f0(0x13e)]);throw _0x3d0fc;}}function timed_connect(_0x31bea3,_0x57ae74,_0x2a9111){return new Promise((_0x2ebf24,_0x3ba947)=>{const _0x325970=_0x1182,_0x3d04d7=net[_0x325970(0x115)]({'host':_0x31bea3,'port':_0x57ae74}),_0x359a5b=setTimeout(()=>{_0x3ba947(new Error('connect\x20timeout'));},_0x2a9111);_0x3d04d7['on'](_0x325970(0xfe),()=>{clearTimeout(_0x359a5b),_0x2ebf24(_0x3d04d7);}),_0x3d04d7['on'](_0x325970(0x18d),_0x5cd8e1=>{clearTimeout(_0x359a5b),_0x3ba947(_0x5cd8e1);});});}function pipe_relay(){async function _0xf4d907(_0x46502f,_0x3d694f,_0xd2ad54){const _0x5e9b6e=_0x1182,_0x3816d8=parseInt(SETTINGS['CHUNK_SIZE']);if(_0xd2ad54['length']>0x0){if(_0x3d694f[_0x5e9b6e(0x123)])_0x3d694f[_0x5e9b6e(0x13d)](),_0x3d694f[_0x5e9b6e(0x123)](_0xd2ad54),process[_0x5e9b6e(0x1ab)](()=>_0x3d694f['uncork']());else{const _0x338139=_0x3d694f['writable'][_0x5e9b6e(0x1ad)]();try{await _0x338139[_0x5e9b6e(0x123)](_0xd2ad54);}finally{_0x338139[_0x5e9b6e(0x1a5)]();}}}try{_0x46502f[_0x5e9b6e(0x11f)]?(_0x46502f['pause'](),_0x46502f[_0x5e9b6e(0x11f)](_0x3d694f,{'end':!![],'highWaterMark':_0x3816d8}),_0x46502f[_0x5e9b6e(0x114)]()):await _0x46502f[_0x5e9b6e(0xc0)][_0x5e9b6e(0x195)](_0x3d694f[_0x5e9b6e(0x193)],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal[_0x5e9b6e(0x197)](SETTINGS['SESSION_TIMEOUT'])});}catch(_0x3149d1){!_0x3149d1[_0x5e9b6e(0x13e)][_0x5e9b6e(0x172)](_0x5e9b6e(0x15e))&&log('error',_0x5e9b6e(0x19f),_0x3149d1[_0x5e9b6e(0x13e)]);throw _0x3149d1;}}return _0xf4d907;}function socketToWebStream(_0x51a83e){const _0x180666=_0xe794fb;let _0x9c517a,_0x340642;return _0x51a83e['on'](_0x180666(0x18d),_0x121359=>{const _0x167be3=_0x180666;log(_0x167be3(0x18d),'Socket\x20error:',_0x121359['message']),_0x9c517a?.['error'](_0x121359),_0x340642?.[_0x167be3(0x18d)](_0x121359);}),{'readable':new ReadableStream({'start'(_0x2ce8ae){const _0x28788f=_0x180666;_0x9c517a=_0x2ce8ae,_0x51a83e['on'](_0x28788f(0x1c1),_0x33b49d=>{const _0x3e2bf9=_0x28788f;try{_0x2ce8ae[_0x3e2bf9(0x112)](_0x33b49d);}catch(_0xcf762f){log(_0x3e2bf9(0x18d),'Read\x20controller\x20error:',_0xcf762f['message']);}}),_0x51a83e['on'](_0x28788f(0xfa),()=>{const _0x1168c8=_0x28788f;try{_0x2ce8ae['close']();}catch(_0x923159){log('error',_0x1168c8(0x146),_0x923159['message']);}});},'cancel'(){_0x51a83e['destroy']();}}),'writable':new WritableStream({'start'(_0x471484){_0x340642=_0x471484;},'write'(_0x3510e3){return new Promise((_0x287cde,_0x5f4388)=>{const _0xc74e2e=_0x1182;if(_0x51a83e[_0xc74e2e(0xea)]){_0x5f4388(new Error(_0xc74e2e(0x1c6)));return;}_0x51a83e[_0xc74e2e(0x123)](_0x3510e3,_0x385d5e=>{if(_0x385d5e)_0x5f4388(_0x385d5e);else _0x287cde();});});},'close'(){const _0x31c098=_0x180666;!_0x51a83e[_0x31c098(0xea)]&&_0x51a83e['end']();},'abort'(_0x2daa36){_0x51a83e['destroy'](_0x2daa36);}})};}function relay(_0x114588,_0x230f2d,_0x28b078,_0x28060e){const _0x2dd6e0=_0xe794fb,_0x5e9096=pipe_relay();let _0x2f8d3a=![];const _0x5336b7=socketToWebStream(_0x28b078);function _0x415531(){const _0x329ef4=_0x1182;if(!_0x2f8d3a){_0x2f8d3a=!![];try{_0x28b078[_0x329ef4(0x153)]();}catch(_0x238609){!_0x238609[_0x329ef4(0x13e)]['includes'](_0x329ef4(0x15e))&&!_0x238609['message'][_0x329ef4(0x172)](_0x329ef4(0x16e))&&log(_0x329ef4(0x18d),_0x329ef4(0xf4)+_0x238609[_0x329ef4(0x13e)]);}}}const _0x33a546=_0x5e9096(_0x230f2d,_0x5336b7,_0x28060e[_0x2dd6e0(0x1c1)])[_0x2dd6e0(0x171)](_0x467de8=>{const _0x450e45=_0x2dd6e0;!_0x467de8[_0x450e45(0x13e)][_0x450e45(0x172)](_0x450e45(0x15e))&&!_0x467de8[_0x450e45(0x13e)]['includes'](_0x450e45(0x16e))&&log('error',_0x450e45(0x194)+_0x467de8[_0x450e45(0x13e)]);})[_0x2dd6e0(0x11d)](()=>{_0x230f2d['reading_done']&&_0x230f2d['reading_done']();}),_0x548a8d=_0x5e9096(_0x5336b7,_0x230f2d,_0x28060e[_0x2dd6e0(0x196)])['catch'](_0x4daf57=>{const _0x751c8f=_0x2dd6e0;!_0x4daf57[_0x751c8f(0x13e)]['includes']('aborted')&&!_0x4daf57['message'][_0x751c8f(0x172)](_0x751c8f(0x16e))&&log(_0x751c8f(0x18d),_0x751c8f(0xdd)+_0x4daf57[_0x751c8f(0x13e)]);});_0x548a8d[_0x2dd6e0(0x11d)](()=>_0x33a546)[_0x2dd6e0(0x11d)](_0x415531);}const sessions=new Map();class Session{constructor(_0x1dbb1a){const _0x3ccc2a=_0xe794fb;this['uuid']=_0x1dbb1a,this[_0x3ccc2a(0x19d)]=0x0,this[_0x3ccc2a(0xd6)]=![],this['lastActivity']=Date['now'](),this[_0x3ccc2a(0x137)]=null,this[_0x3ccc2a(0xd3)]=null,this[_0x3ccc2a(0x12d)]=![],this[_0x3ccc2a(0x126)]=null,this[_0x3ccc2a(0x121)]=![],this[_0x3ccc2a(0x16a)]=new Map(),this[_0x3ccc2a(0x19e)]=![],this[_0x3ccc2a(0x148)]=[],this[_0x3ccc2a(0x17e)]=null,this[_0x3ccc2a(0x1bc)]=new Map(),log(_0x3ccc2a(0x15c),'Created\x20new\x20session\x20with\x20UUID:\x20'+_0x1dbb1a);}async['initializeVLESS'](_0x3beb90){const _0x30600e=_0xe794fb;if(this[_0x30600e(0x12d)])return!![];try{log(_0x30600e(0x15c),'Initializing\x20VLESS\x20connection\x20from\x20first\x20packet');const _0x9a9095=new ReadableStream({'start'(_0x2e30d7){const _0x109c96=_0x30600e;_0x2e30d7[_0x109c96(0x112)](_0x3beb90),_0x2e30d7[_0x109c96(0x129)]();}}),_0x323871={'readable':_0x9a9095,'writable':new WritableStream()};return this[_0x30600e(0x137)]=await parse_header(SETTINGS[_0x30600e(0x1b1)],_0x323871),log(_0x30600e(0x14c),_0x30600e(0xe6)+this['vlessHeader'][_0x30600e(0x13f)]+':'+this[_0x30600e(0x137)][_0x30600e(0x159)]),this[_0x30600e(0xd3)]=await connect_remote(this[_0x30600e(0x137)][_0x30600e(0x13f)],this['vlessHeader']['port']),log(_0x30600e(0x14c),_0x30600e(0x16c)),this['initialized']=!![],!![];}catch(_0x1abb32){return log(_0x30600e(0x18d),'Failed\x20to\x20initialize\x20VLESS:\x20'+_0x1abb32[_0x30600e(0x13e)]),![];}}async[_0xe794fb(0x138)](_0x335b39,_0x493263){const _0x12ba2b=_0xe794fb;try{this['pendingBuffers'][_0x12ba2b(0x1c7)](_0x335b39,_0x493263),log(_0x12ba2b(0x15c),_0x12ba2b(0x1a2)+_0x335b39+_0x12ba2b(0x14d)+_0x493263[_0x12ba2b(0x136)]);while(this[_0x12ba2b(0x1bc)]['has'](this['nextSeq'])){const _0x5cd7e8=this[_0x12ba2b(0x1bc)][_0x12ba2b(0x1c0)](this[_0x12ba2b(0x19d)]);this[_0x12ba2b(0x1bc)]['delete'](this[_0x12ba2b(0x19d)]);if(!this[_0x12ba2b(0x12d)]&&this['nextSeq']===0x0){if(!await this[_0x12ba2b(0xe7)](_0x5cd7e8))throw new Error(_0x12ba2b(0x17b));this[_0x12ba2b(0x126)]=Buffer[_0x12ba2b(0x106)](this[_0x12ba2b(0x137)][_0x12ba2b(0x196)]),await this[_0x12ba2b(0x124)](this[_0x12ba2b(0x137)][_0x12ba2b(0x1c1)]),this[_0x12ba2b(0x17e)]&&this['_startDownstreamResponse']();}else{if(!this['initialized']){log('warn',_0x12ba2b(0x105)+_0x335b39+_0x12ba2b(0x118));continue;}await this[_0x12ba2b(0x124)](_0x5cd7e8);}this['nextSeq']++,log(_0x12ba2b(0x15c),'Processed\x20packet\x20seq='+(this[_0x12ba2b(0x19d)]-0x1));}if(this[_0x12ba2b(0x1bc)]['size']>SETTINGS[_0x12ba2b(0x16b)])throw new Error(_0x12ba2b(0x165));return!![];}catch(_0x32a0f9){log(_0x12ba2b(0x18d),_0x12ba2b(0x1ae)+_0x32a0f9[_0x12ba2b(0x13e)]);throw _0x32a0f9;}}[_0xe794fb(0x191)](){const _0x21a6e1=_0xe794fb;if(!this[_0x21a6e1(0x17e)]||!this['responseHeader'])return;try{const _0xc359ee=this[_0x21a6e1(0x17e)][_0x21a6e1(0xe9)]?.[_0x21a6e1(0x18a)]||'http/1.1',_0x537fd3=_0xc359ee==='h2';!this[_0x21a6e1(0x121)]&&(log(_0x21a6e1(0x15c),'Sending\x20VLESS\x20response\x20header\x20('+_0xc359ee+_0x21a6e1(0xce)+this[_0x21a6e1(0x126)][_0x21a6e1(0x136)]+_0x21a6e1(0x142)),this[_0x21a6e1(0x17e)][_0x21a6e1(0x123)](this['responseHeader']),this['headerSent']=!![]);if(_0x537fd3){this[_0x21a6e1(0x17e)][_0x21a6e1(0xe9)]['setNoDelay'](!![]);const _0x2bfe60=new require(_0x21a6e1(0x141))[_0x21a6e1(0x177)]({'transform'(_0x194b86,_0x3c4a19,_0x43a46e){const _0x3b1939=_0x21a6e1,_0x1beadf=0x4000;for(let _0x5b4b28=0x0;_0x5b4b28<_0x194b86['length'];_0x5b4b28+=_0x1beadf){this[_0x3b1939(0x176)](_0x194b86[_0x3b1939(0xd9)](_0x5b4b28,_0x5b4b28+_0x1beadf));}_0x43a46e();}});this[_0x21a6e1(0xd3)][_0x21a6e1(0x11f)](_0x2bfe60)[_0x21a6e1(0x11f)](this['currentStreamRes']);}else this['remote'][_0x21a6e1(0x11f)](this[_0x21a6e1(0x17e)]);this[_0x21a6e1(0xd3)]['on']('end',()=>{const _0x346043=_0x21a6e1;!this[_0x346043(0x17e)][_0x346043(0x13c)]&&this[_0x346043(0x17e)][_0x346043(0xfa)]();}),this[_0x21a6e1(0xd3)]['on']('error',_0x358b8a=>{const _0x242cb3=_0x21a6e1;log(_0x242cb3(0x18d),'Remote\x20error:\x20'+_0x358b8a[_0x242cb3(0x13e)]),!this[_0x242cb3(0x17e)][_0x242cb3(0x13c)]&&this['currentStreamRes']['end']();});}catch(_0x3cfe75){log(_0x21a6e1(0x18d),_0x21a6e1(0xec)+_0x3cfe75[_0x21a6e1(0x13e)]),this['cleanup']();}}[_0xe794fb(0x1a1)](_0x1ebc39,_0x2eb77b){const _0x58e750=_0xe794fb;return!_0x1ebc39[_0x58e750(0xbf)]&&_0x1ebc39[_0x58e750(0x16d)](0xc8,_0x2eb77b),this[_0x58e750(0x17e)]=_0x1ebc39,this[_0x58e750(0x12d)]&&this[_0x58e750(0x126)]&&this['_startDownstreamResponse'](),_0x1ebc39['on'](_0x58e750(0x129),()=>{const _0x22926f=_0x58e750;log(_0x22926f(0x14c),_0x22926f(0x134)),this[_0x22926f(0x11c)]();}),!![];}async[_0xe794fb(0x124)](_0x5cfce8){const _0x3c70f4=_0xe794fb;if(!this[_0x3c70f4(0xd3)]||this[_0x3c70f4(0xd3)][_0x3c70f4(0xea)])throw new Error(_0x3c70f4(0x199));return new Promise((_0x18fb07,_0x12e6d8)=>{const _0x299556=_0x3c70f4;this[_0x299556(0xd3)][_0x299556(0x123)](_0x5cfce8,_0xd6b8d1=>{const _0x6b110b=_0x299556;_0xd6b8d1?(log(_0x6b110b(0x18d),_0x6b110b(0x122)+_0xd6b8d1['message']),_0x12e6d8(_0xd6b8d1)):_0x18fb07();});});}[_0xe794fb(0x191)](){const _0x3b0723=_0xe794fb;if(!this[_0x3b0723(0x17e)]||!this[_0x3b0723(0x126)])return;try{!this['headerSent']&&(this[_0x3b0723(0x17e)][_0x3b0723(0x123)](this[_0x3b0723(0x126)]),this[_0x3b0723(0x121)]=!![]),this['remote'][_0x3b0723(0x11f)](this[_0x3b0723(0x17e)]),this[_0x3b0723(0xd3)]['on'](_0x3b0723(0xfa),()=>{const _0x3888d5=_0x3b0723;!this['currentStreamRes'][_0x3888d5(0x13c)]&&this['currentStreamRes'][_0x3888d5(0xfa)]();}),this[_0x3b0723(0xd3)]['on'](_0x3b0723(0x18d),_0x1e5757=>{const _0x594324=_0x3b0723;log('error','Remote\x20error:\x20'+_0x1e5757['message']),!this[_0x594324(0x17e)][_0x594324(0x13c)]&&this[_0x594324(0x17e)][_0x594324(0xfa)]();});}catch(_0x3b6012){log(_0x3b0723(0x18d),_0x3b0723(0xec)+_0x3b6012['message']),this[_0x3b0723(0x11c)]();}}['cleanup'](){const _0xecda11=_0xe794fb;!this[_0xecda11(0x19e)]&&(this[_0xecda11(0x19e)]=!![],log(_0xecda11(0x15c),_0xecda11(0x140)+this[_0xecda11(0xe5)]),this[_0xecda11(0xd3)]&&(this[_0xecda11(0xd3)]['destroy'](),this['remote']=null),this['initialized']=![],this['headerSent']=![]);}}async function getCloudflareMeta(){return new Promise((_0x265176,_0x4f96cd)=>{const _0x18d625=_0x1182,_0xe7070={'hostname':_0x18d625(0x184),'path':_0x18d625(0x167),'method':_0x18d625(0xcc)},_0x11335e=https[_0x18d625(0x168)](_0xe7070,_0x570300=>{const _0xb82e05=_0x18d625;let _0x4ee175='';_0x570300['on']('data',_0x3514d2=>{_0x4ee175+=_0x3514d2;}),_0x570300['on'](_0xb82e05(0xfa),()=>{const _0x2ffebd=_0xb82e05,_0x4fea6d=JSON[_0x2ffebd(0x1b6)](_0x4ee175);_0x265176(_0x4fea6d);});});_0x11335e['on'](_0x18d625(0x18d),_0x315605=>{_0x4f96cd(_0x315605);}),_0x11335e['end']();});}let UPLOAD_DATA;async function getipandisp(){const _0x2b48c2=_0xe794fb;let _0x3ee295=await getCloudflareMeta(),_0x1132de=_0x3ee295['clientIp'],_0x8bb15=_0x3ee295['country'],_0x2db9c8=_0x3ee295['asOrganization'];ISP=(_0x8bb15+'-'+_0x2db9c8)[_0x2b48c2(0x107)](/ /g,'_');if(MY_DOMAIN)IP=MY_DOMAIN;else{if(LOCAL_DOMAIN)IP=LOCAL_DOMAIN;else!MY_DOMAIN&&!LOCAL_DOMAIN&&(_0x1132de[_0x2b48c2(0x172)](':')?IP='['+_0x1132de+']':IP=''+_0x1132de);}if(HTTPSTLS==!![])UPLOAD_DATA='vless://'+UUID+'@'+CFIP+':'+CFPORT+'?encryption=none&security=tls&sni='+IP+_0x2b48c2(0x16f)+IP+'&path='+SETTINGS[_0x2b48c2(0x1a0)]+_0x2b48c2(0x1a6)+ISP+'-'+SUB_NAME;else HTTPSTLS==![]&&(UPLOAD_DATA=_0x2b48c2(0x103)+UUID+'@'+IP+':'+PORT+_0x2b48c2(0x186)+IP+_0x2b48c2(0x16f)+IP+_0x2b48c2(0x185)+SETTINGS[_0x2b48c2(0x1a0)]+_0x2b48c2(0x1a6)+ISP+'-'+SUB_NAME);return UPLOAD_DATA;}const server=http[_0xe794fb(0x1a9)]((_0x5c94b3,_0x18dee4)=>{const _0x41cc74=_0xe794fb,_0x3a6e88={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':'GET,\x20POST','Cache-Control':_0x41cc74(0x111),'X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x5c94b3['url']==='/'){_0x18dee4[_0x41cc74(0x16d)](0xc8,{'Content-Type':'text/plain'}),_0x18dee4[_0x41cc74(0xfa)](_0x41cc74(0x10e));return;}if(_0x5c94b3[_0x41cc74(0xd2)]==='/'+SUB_PATH){const _0x5e1929=''+UPLOAD_DATA,_0x12bbe7=Buffer['from'](_0x5e1929)[_0x41cc74(0xf8)]('base64');_0x18dee4['writeHead'](0xc8,{'Content-Type':_0x41cc74(0x132)}),_0x18dee4[_0x41cc74(0xfa)](_0x12bbe7+'\x0a');return;}const _0x352ad9=_0x5c94b3[_0x41cc74(0xd2)]['match'](new RegExp(XPATH+'/([^/]+)(?:/([0-9]+))?$'));if(!_0x352ad9){_0x18dee4[_0x41cc74(0x16d)](0x194),_0x18dee4[_0x41cc74(0xfa)]();return;}const _0x2a0f3d=_0x352ad9[0x1],_0x4f5d32=_0x352ad9[0x2]?parseInt(_0x352ad9[0x2]):null;if(_0x5c94b3['method']===_0x41cc74(0xcc)&&!_0x4f5d32){_0x3a6e88[_0x41cc74(0xe0)]=_0x41cc74(0x1ba),_0x3a6e88['Transfer-Encoding']=_0x41cc74(0x1b2);let _0x508b20=sessions['get'](_0x2a0f3d);!_0x508b20&&(_0x508b20=new Session(_0x2a0f3d),sessions[_0x41cc74(0x1c7)](_0x2a0f3d,_0x508b20),log(_0x41cc74(0x14c),_0x41cc74(0x130)+_0x2a0f3d));_0x508b20[_0x41cc74(0xd6)]=!![];!_0x508b20[_0x41cc74(0x1a1)](_0x18dee4,_0x3a6e88)&&(log(_0x41cc74(0x18d),'Failed\x20to\x20start\x20downstream\x20for\x20session:\x20'+_0x2a0f3d),!_0x18dee4[_0x41cc74(0xbf)]&&(_0x18dee4[_0x41cc74(0x16d)](0x1f4),_0x18dee4[_0x41cc74(0xfa)]()),_0x508b20[_0x41cc74(0x11c)](),sessions['delete'](_0x2a0f3d));return;}if(_0x5c94b3[_0x41cc74(0x154)]===_0x41cc74(0xde)&&_0x4f5d32!==null){let _0x4aba41=sessions['get'](_0x2a0f3d);!_0x4aba41&&(_0x4aba41=new Session(_0x2a0f3d),sessions[_0x41cc74(0x1c7)](_0x2a0f3d,_0x4aba41),log('info',_0x41cc74(0xca)+_0x2a0f3d),setTimeout(()=>{const _0x2943a8=_0x41cc74,_0x39bd1a=sessions[_0x2943a8(0x1c0)](_0x2a0f3d);_0x39bd1a&&!_0x39bd1a['downstreamStarted']&&(log(_0x2943a8(0xe3),_0x2943a8(0x17f)+_0x2a0f3d+_0x2943a8(0xdb)),_0x39bd1a['cleanup'](),sessions['delete'](_0x2a0f3d));},SETTINGS['SESSION_TIMEOUT']));let _0x2b4fcc=[],_0x883459=0x0,_0x3ad385=![];_0x5c94b3['on'](_0x41cc74(0x1c1),_0x1d771e=>{const _0x309d1f=_0x41cc74;_0x883459+=_0x1d771e[_0x309d1f(0x136)];if(_0x883459>SETTINGS[_0x309d1f(0x1c8)]){!_0x3ad385&&(_0x18dee4[_0x309d1f(0x16d)](0x19d),_0x18dee4[_0x309d1f(0xfa)](),_0x3ad385=!![]);return;}_0x2b4fcc['push'](_0x1d771e);}),_0x5c94b3['on'](_0x41cc74(0xfa),async()=>{const _0x4a27df=_0x41cc74;if(_0x3ad385)return;try{const _0x2f1c2f=Buffer['concat'](_0x2b4fcc);log(_0x4a27df(0x14c),'Processing\x20packet:\x20seq='+_0x4f5d32+_0x4a27df(0x14d)+_0x2f1c2f[_0x4a27df(0x136)]),await _0x4aba41[_0x4a27df(0x138)](_0x4f5d32,_0x2f1c2f),!_0x3ad385&&(_0x18dee4[_0x4a27df(0x16d)](0xc8,_0x3a6e88),_0x3ad385=!![]),_0x18dee4[_0x4a27df(0xfa)]();}catch(_0x4ba87e){log(_0x4a27df(0x18d),_0x4a27df(0x189)+_0x4ba87e[_0x4a27df(0x13e)]),_0x4aba41[_0x4a27df(0x11c)](),sessions[_0x4a27df(0x116)](_0x2a0f3d),!_0x3ad385&&(_0x18dee4[_0x4a27df(0x16d)](0x1f4),_0x3ad385=!![]),_0x18dee4[_0x4a27df(0xfa)]();}});return;}_0x18dee4[_0x41cc74(0x16d)](0x194),_0x18dee4['end']();});server['on'](_0xe794fb(0xe4),_0xa3e872=>{const _0x4f84d0=_0xe794fb;log(_0x4f84d0(0x15c),'New\x20secure\x20connection\x20using:\x20'+(_0xa3e872[_0x4f84d0(0x18a)]||_0x4f84d0(0x178)));});function generatePadding(_0x381867,_0x2e07d5){const _0x34da5a=_0xe794fb,_0x4028f3=_0x381867+Math['floor'](Math[_0x34da5a(0xfb)]()*(_0x2e07d5-_0x381867));return Buffer[_0x34da5a(0x106)](Array(_0x4028f3)[_0x34da5a(0x113)]('X')['join'](''))['toString']('base64');}server['keepAliveTimeout']=0x975e0,server[_0xe794fb(0xc7)]=0x98968,server['on'](_0xe794fb(0x18d),_0x2b1787=>{const _0x3e345f=_0xe794fb;log(_0x3e345f(0x18d),_0x3e345f(0x13a)+_0x2b1787[_0x3e345f(0x13e)]);});async function uploadSubscription(_0x2b609a,_0x4435c2,_0x18f9a1){const _0x649d3c=_0xe794fb,_0x1c86d6=JSON[_0x649d3c(0x1a8)]({'URL_NAME':_0x2b609a,'URL':_0x4435c2}),_0x8510ae=Buffer[_0x649d3c(0x106)](_0x1c86d6,_0x649d3c(0x181)),_0xfc2c6f=_0x8510ae['length'],_0x20b964=new URL(_0x18f9a1),_0x2d1963={'hostname':_0x20b964[_0x649d3c(0x13f)],'port':_0x20b964[_0x649d3c(0x159)]||0x1bb,'path':_0x20b964['pathname'],'method':_0x649d3c(0xde),'headers':{'Content-Type':_0x649d3c(0x188),'Content-Length':_0xfc2c6f}};try{const _0x3a2957=await new Promise((_0x5692b7,_0x15704c)=>{const _0x4a8a1e=_0x649d3c,_0x6956cf=https[_0x4a8a1e(0x168)](_0x2d1963,_0x15258f=>{const _0x5d12bb=_0x4a8a1e;if(_0x15258f[_0x5d12bb(0x10d)]<0xc8||_0x15258f[_0x5d12bb(0x10d)]>=0x12c)return _0x15704c(new Error(_0x5d12bb(0x15f)+_0x15258f[_0x5d12bb(0x10d)]+_0x5d12bb(0x150)+_0x15258f[_0x5d12bb(0x1aa)]));let _0x50ff3e='';_0x15258f['on']('data',_0x524641=>_0x50ff3e+=_0x524641),_0x15258f['on'](_0x5d12bb(0xfa),()=>_0x5692b7(_0x50ff3e));});_0x6956cf['on'](_0x4a8a1e(0x18d),_0x5f4955=>_0x15704c(_0x5f4955)),_0x6956cf[_0x4a8a1e(0x123)](_0x8510ae),_0x6956cf[_0x4a8a1e(0xfa)]();});return _0x3a2957;}catch(_0x46dec8){console['error']('Upload\x20failed:',_0x46dec8[_0x649d3c(0x13e)]);}}function _0x1182(_0x2dae76,_0x329e33){const _0x3df2eb=_0x3df2();return _0x1182=function(_0x1182f0,_0x2fba85){_0x1182f0=_0x1182f0-0xbd;let _0x4bd97e=_0x3df2eb[_0x1182f0];return _0x4bd97e;},_0x1182(_0x2dae76,_0x329e33);}function cleanfiles(){setTimeout(()=>{const _0xdac386=_0x1182;let _0x29a204;KEEPALIVE==!![]?_0x29a204=[]:_0x29a204=[FILE_PATH+'/'+fileMapping[_0xdac386(0x180)],FILE_PATH+_0xdac386(0x14b)],_0x29a204[_0xdac386(0xe1)](_0x6eabf1=>{const _0x20865f=_0xdac386;try{fs[_0x20865f(0x139)](_0x6eabf1)&&(fs['lstatSync'](_0x6eabf1)['isDirectory']()?fs['rmSync'](_0x6eabf1,{'recursive':!![]}):fs['unlinkSync'](_0x6eabf1));}catch(_0x37cfcf){}}),console[_0xdac386(0x170)](),console['log'](_0xdac386(0x1c4));},0xea60);}server[_0xe794fb(0x1b0)](PORT,async()=>{const _0x590da3=_0xe794fb;await getipandisp(),cleanupOldFiles(),createFolder(FILE_PATH);NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY&&NEZHA_VERSION&&(await downloadFiles(),await delay(0x1388));await run(),cleanfiles(),console[_0x590da3(0x151)](_0x590da3(0x160)+PORT);if(SUB_URL)try{const _0x3714be=await uploadSubscription(SUB_NAME,UPLOAD_DATA,SUB_URL);}catch(_0x43b3ed){console[_0x590da3(0x18d)](_0x590da3(0x128),_0x43b3ed);}KEEPALIVE==!![]&&(await keep_alive(),setInterval(keep_alive,intervalInseconds*0x3e8));});