const _0x491b11=_0x2a35;(function(_0x316a6c,_0x412e02){const _0x41f05c=_0x2a35,_0x182da2=_0x316a6c();while(!![]){try{const _0xd15c0e=parseInt(_0x41f05c(0x18e))/0x1+-parseInt(_0x41f05c(0x1de))/0x2+parseInt(_0x41f05c(0x25f))/0x3+-parseInt(_0x41f05c(0x25c))/0x4*(parseInt(_0x41f05c(0x1d0))/0x5)+-parseInt(_0x41f05c(0x260))/0x6*(parseInt(_0x41f05c(0x285))/0x7)+parseInt(_0x41f05c(0x197))/0x8*(-parseInt(_0x41f05c(0x196))/0x9)+parseInt(_0x41f05c(0x1ed))/0xa*(parseInt(_0x41f05c(0x192))/0xb);if(_0xd15c0e===_0x412e02)break;else _0x182da2['push'](_0x182da2['shift']());}catch(_0x1ce32b){_0x182da2['push'](_0x182da2['shift']());}}}(_0x48dd,0x7d238));const FILE_PATH=process[_0x491b11(0x1eb)][_0x491b11(0x1c1)]||_0x491b11(0x28a),intervalInseconds=process['env'][_0x491b11(0x1a5)]||0x64,PORT=process['env'][_0x491b11(0x1b3)]||0xbb8,CFPORT=process['env']['CFPORT']||0x1bb,CFIP=process[_0x491b11(0x1eb)][_0x491b11(0x22b)]||_0x491b11(0x24f),KEEPALIVE=(process['env']['KEEPALIVE']||_0x491b11(0x26c))===_0x491b11(0x20e),HTTPSTLS=(process[_0x491b11(0x1eb)][_0x491b11(0x225)]||_0x491b11(0x20e))==='true',SUB_URL=process[_0x491b11(0x1eb)]['SUB_URL']||'',UUID=process['env'][_0x491b11(0x234)]||_0x491b11(0x239),XPATH=process['env'][_0x491b11(0x1c5)]||UUID[_0x491b11(0x18a)](0x0,0x8),NEZHA_VERSION=process['env']['NEZHA_VERSION']||'V0',NEZHA_SERVER=process['env']['NEZHA_SERVER']||'',NEZHA_PORT=process['env'][_0x491b11(0x27b)]||_0x491b11(0x24c),NEZHA_KEY=process[_0x491b11(0x1eb)]['NEZHA_KEY']||'',SUB_NAME=process[_0x491b11(0x1eb)][_0x491b11(0x19c)]||'',MY_DOMAIN=process[_0x491b11(0x1eb)]['MY_DOMAIN']||'',LOCAL_DOMAIN=process[_0x491b11(0x1eb)]['LOCAL_DOMAIN']||'',os=require('os'),fs=require('fs'),net=require('net'),path=require(_0x491b11(0x19b)),http=require(_0x491b11(0x1df)),https=require('https'),axios=require(_0x491b11(0x1f8)),{pipeline}=require(_0x491b11(0x282)),{Buffer}=require(_0x491b11(0x263)),exec=require(_0x491b11(0x1e3))[_0x491b11(0x23a)],delay=_0x2dc077=>new Promise(_0x388f9e=>setTimeout(_0x388f9e,_0x2dc077)),SETTINGS={[_0x491b11(0x234)]:UUID,[_0x491b11(0x1ef)]:'none',[_0x491b11(0x1ec)]:_0x491b11(0x1af),['XPATH']:_0x491b11(0x27f)+XPATH,[_0x491b11(0x1a6)]:0x1e,['MAX_POST_SIZE']:0xf4240,[_0x491b11(0x275)]:0x7530,[_0x491b11(0x267)]:0x400*0x400,[_0x491b11(0x25a)]:!![],[_0x491b11(0x1bf)]:!![]};function validate_uuid(_0x4238e1,_0x36cb25){for(let _0xb040f6=0x0;_0xb040f6<0x10;_0xb040f6++){if(_0x4238e1[_0xb040f6]!==_0x36cb25[_0xb040f6])return![];}return!![];}function concat_typed_arrays(_0x5920e1,..._0x1ca7c6){const _0x4fd00a=_0x491b11;if(!_0x1ca7c6||_0x1ca7c6['length']<0x1)return _0x5920e1;let _0x311f49=_0x5920e1[_0x4fd00a(0x21a)];for(let _0x2ba37d of _0x1ca7c6)_0x311f49+=_0x2ba37d[_0x4fd00a(0x21a)];const _0x33ca25=new _0x5920e1[(_0x4fd00a(0x220))](_0x311f49);_0x33ca25[_0x4fd00a(0x277)](_0x5920e1,0x0),_0x311f49=_0x5920e1[_0x4fd00a(0x21a)];for(let _0x3cc0f4 of _0x1ca7c6){_0x33ca25[_0x4fd00a(0x277)](_0x3cc0f4,_0x311f49),_0x311f49+=_0x3cc0f4['length'];}return _0x33ca25;}function log(_0x3c57dd,..._0x660654){const _0x3af5ef=_0x491b11;if(SETTINGS[_0x3af5ef(0x1ef)]===_0x3af5ef(0x242))return;const _0x40875a={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x9f0d55={'debug':'\x1b[36m','info':_0x3af5ef(0x1d3),'warn':_0x3af5ef(0x1d8),'error':_0x3af5ef(0x1a0),'reset':_0x3af5ef(0x194)},_0x4dcbec=_0x40875a[SETTINGS[_0x3af5ef(0x1ef)]]||0x1,_0x2f5b87=_0x40875a[_0x3c57dd]||0x0;if(_0x2f5b87>=_0x4dcbec){const _0x2f54ae=new Date()['toISOString'](),_0x1395a4=_0x9f0d55[_0x3c57dd]||_0x9f0d55[_0x3af5ef(0x27c)];console['log'](_0x1395a4+'['+_0x2f54ae+_0x3af5ef(0x24d)+_0x3c57dd+']',..._0x660654,_0x9f0d55[_0x3af5ef(0x27c)]);}}function execPromise(_0x5e0673,_0x5588d0={}){return new Promise((_0x25de8e,_0x547ad9)=>{const _0x53b32a=exec(_0x5e0673,_0x5588d0,(_0x5d7374,_0x4eaa1b,_0x590d65)=>{const _0x5afe23=_0x2a35;if(_0x5d7374){const _0xe31832=new Error(_0x5afe23(0x1f0)+_0x5d7374[_0x5afe23(0x1a8)]);_0xe31832[_0x5afe23(0x246)]=_0x5d7374['code'],_0xe31832[_0x5afe23(0x206)]=_0x590d65[_0x5afe23(0x248)](),_0x547ad9(_0xe31832);}else _0x25de8e(_0x4eaa1b[_0x5afe23(0x248)]());});});}async function detectProcess(_0x243e08){const _0x24138e=_0x491b11,_0x5b1bad=[{'cmd':_0x24138e(0x284)+_0x243e08+'\x22','name':_0x24138e(0x254)},{'cmd':_0x24138e(0x23d)+_0x243e08+'\x22','name':'pgrep'},{'cmd':_0x24138e(0x1fa)+_0x243e08+_0x24138e(0x1c3),'name':_0x24138e(0x273)}];for(const _0x1ce163 of _0x5b1bad){try{const _0x582c70=await execPromise(_0x1ce163[_0x24138e(0x243)]);if(_0x582c70)return _0x582c70[_0x24138e(0x268)](/\n/g,'\x20')[_0x24138e(0x248)]();}catch(_0x514209){_0x514209['code']!==0x7f&&_0x514209[_0x24138e(0x246)]!==0x1&&console[_0x24138e(0x21d)](_0x24138e(0x1ad)+_0x1ce163[_0x24138e(0x18f)]+'\x20error:',_0x514209['message']);}}return'';}async function killProcess(_0x55c55f){const _0x417d77=_0x491b11;console[_0x417d77(0x287)](_0x417d77(0x1d9)+_0x55c55f);try{const _0x1923d3=await detectProcess(_0x55c55f);if(!_0x1923d3)return console[_0x417d77(0x216)](_0x417d77(0x1f7)+_0x55c55f+_0x417d77(0x27e)),{'success':!![],'message':_0x417d77(0x19d)};await execPromise(_0x417d77(0x21e)+_0x1923d3);const _0x5d6175='Killed\x20process\x20(PIDs:\x20'+_0x1923d3+')';return console['log'](_0x5d6175),{'success':!![],'message':_0x5d6175};}catch(_0x1fe90c){const _0x1f4531=_0x417d77(0x293)+_0x1fe90c[_0x417d77(0x1a8)];return console[_0x417d77(0x20c)](_0x1f4531),{'success':![],'message':_0x1f4531};}}function generateRandomString(_0x132c5b){const _0x412a41=_0x491b11,_0x17b2f2=_0x412a41(0x294);let _0x208bff='';for(let _0x3eb726=0x0;_0x3eb726<_0x132c5b;_0x3eb726++){_0x208bff+=_0x17b2f2[_0x412a41(0x20d)](Math[_0x412a41(0x1ba)](Math[_0x412a41(0x26f)]()*_0x17b2f2[_0x412a41(0x21a)]));}return _0x208bff;}function _0x2a35(_0xc25978,_0x20b8ec){const _0x48dd55=_0x48dd();return _0x2a35=function(_0x2a3504,_0x108394){_0x2a3504=_0x2a3504-0x18a;let _0x53b7f2=_0x48dd55[_0x2a3504];return _0x53b7f2;},_0x2a35(_0xc25978,_0x20b8ec);}function getSystemArchitecture(){const _0x2ed522=_0x491b11,_0xc65f8b=os['arch']();return _0xc65f8b===_0x2ed522(0x230)||_0xc65f8b===_0x2ed522(0x288)||_0xc65f8b===_0x2ed522(0x274)?_0x2ed522(0x230):'amd';}function getFilesForArchitecture(_0x181dca){const _0x4bff17=_0x491b11,_0x44511c={'app':{'V0':{'arm':'https://github.com/kahunama/myfile/releases/download/main/nezha-agent_arm','amd':_0x4bff17(0x235)},'V1':{'arm':_0x4bff17(0x231),'amd':'https://github.com/mytcgd/myfiles/releases/download/main/nezha-agentv1'}}};if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY&&NEZHA_VERSION){const _0x1a9e84=[{'fileName':_0x4bff17(0x1be)+generateRandomString(0x5),'originalName':'app','fileUrl':_0x44511c['app'][NEZHA_VERSION][_0x181dca]}];return _0x1a9e84;}else return[];}async function download_function(_0x624079,_0x45356a,_0x31ff55){const _0x5daf78=_0x491b11,_0x41d94c=path[_0x5daf78(0x207)](FILE_PATH,_0x624079);let _0x286f6a=![];try{const _0x30cf62=await axios({'method':'get','url':_0x31ff55,'responseType':_0x5daf78(0x28b)});await pipeline(_0x30cf62['data'],fs[_0x5daf78(0x199)](_0x41d94c)),_0x286f6a=!![];}catch(_0x48152d){}return{'fileName':_0x624079,'originalName':_0x45356a,'filePath':_0x41d94c,'success':_0x286f6a};}let fileMapping={};async function downloadFiles(){const _0x19987b=_0x491b11;try{const _0x1e5ea6=getSystemArchitecture();if(!_0x1e5ea6)return console[_0x19987b(0x287)](_0x19987b(0x224)),fileMapping;const _0x367ecc=getFilesForArchitecture(_0x1e5ea6);if(_0x367ecc[_0x19987b(0x21a)]===0x0)return console[_0x19987b(0x287)](_0x19987b(0x1cb)),fileMapping;const _0x4235ba=_0x367ecc[_0x19987b(0x1e1)](_0x5c1a19=>download_function(_0x5c1a19['fileName'],_0x5c1a19[_0x19987b(0x18c)],_0x5c1a19[_0x19987b(0x208)])),_0x42b924=await Promise[_0x19987b(0x1ce)](_0x4235ba);return _0x42b924['forEach'](_0x20f732=>{const _0x117b72=_0x19987b;if(_0x20f732[_0x117b72(0x26e)])try{fs['chmodSync'](_0x20f732[_0x117b72(0x1c8)],0x1ed),fileMapping[_0x20f732['originalName']]=_0x20f732['fileName'];}catch(_0x37fff0){}}),fileMapping;}catch(_0x36e69f){return console['error']('Error\x20downloading\x20files:',_0x36e69f),fileMapping;}}let NEZHA_TLS;function nezconfig(){const _0x15f1e7=_0x491b11,_0x4f289a=[_0x15f1e7(0x24c),_0x15f1e7(0x1d6),_0x15f1e7(0x1c0),_0x15f1e7(0x28c),'2083',_0x15f1e7(0x247)];if(NEZHA_VERSION==='V0')return _0x4f289a[_0x15f1e7(0x1ab)](NEZHA_PORT)?NEZHA_TLS='--tls':NEZHA_TLS='',NEZHA_TLS;else{if(NEZHA_VERSION==='V1'){_0x4f289a[_0x15f1e7(0x1ab)](NEZHA_PORT)?NEZHA_TLS=_0x15f1e7(0x20e):NEZHA_TLS=_0x15f1e7(0x26c);const _0x57662e=path[_0x15f1e7(0x207)](FILE_PATH,_0x15f1e7(0x1bb)),_0x2fb157='client_secret:\x20'+NEZHA_KEY+_0x15f1e7(0x28f)+NEZHA_SERVER+':'+NEZHA_PORT+_0x15f1e7(0x279)+NEZHA_TLS+_0x15f1e7(0x291)+UUID;try{fs[_0x15f1e7(0x191)](_0x57662e,_0x2fb157);}catch(_0x5f0e4e){}}}}async function runapp(){const _0x515bf4=_0x491b11;if(fileMapping['app']&&fs['existsSync'](path[_0x515bf4(0x207)](FILE_PATH,fileMapping[_0x515bf4(0x1fb)]))){if(NEZHA_VERSION==='V0'){const _0x23ebe5=_0x515bf4(0x1e7)+FILE_PATH+'/'+fileMapping[_0x515bf4(0x1fb)]+_0x515bf4(0x22d)+NEZHA_SERVER+':'+NEZHA_PORT+_0x515bf4(0x195)+NEZHA_KEY+'\x20'+NEZHA_TLS+_0x515bf4(0x1db);try{await execPromise(_0x23ebe5);}catch(_0x3a7f2a){console[_0x515bf4(0x20c)](fileMapping[_0x515bf4(0x1fb)]+_0x515bf4(0x201)+_0x3a7f2a);}}else{if(NEZHA_VERSION==='V1'){const _0x88b9a3=_0x515bf4(0x1e7)+FILE_PATH+'/'+fileMapping[_0x515bf4(0x1fb)]+'\x20-c\x20'+FILE_PATH+_0x515bf4(0x222);try{await execPromise(_0x88b9a3);}catch(_0x2d0ba8){console['error'](fileMapping[_0x515bf4(0x1fb)]+_0x515bf4(0x201)+_0x2d0ba8);}}}}else console['log'](_0x515bf4(0x272));}function _0x48dd(){const _0xecd285=['read','1000380sydvFO','POST','Remote\x20connection\x20not\x20available','\x1b[32m','push','getWriter','8443','rmSync','\x1b[33m','Attempting\x20to\x20kill\x20process:\x20','application/json;\x20charset=utf-8','\x20--report-delay=4\x20--skip-conn\x20--skip-procs\x20--disable-auto-update\x20>/dev/null\x202>&1\x20&','GET,\x20POST','method','1258422fnvgqf','http','end','map','vlessHeader','child_process','utf8','\x20before\x20initialization','stringify','nohup\x20','bufferedData','\x20timed\x20out\x20without\x20downstream','toString','env','BUFFER_SIZE','370XkezvG','VLESS\x20header\x20parse\x20error:\x20','LOG_LEVEL','Command\x20failed:\x20','releaseLock','port','VLESS\x20connection\x20to\x20','App\x20is\x20running','http/1.1','now','Process\x20\x27','axios','Server\x20error:\x20','ps\x20-eo\x20pid,comm\x20|\x20awk\x20-v\x20name=\x22','app','existsSync','parse\x20hostname\x20failed','VLESS\x20header\x20parsed\x20successfully','done','Socket\x20error:','\x20running\x20error:\x20','header\x20length\x20too\x20short','uuid','Failed\x20to\x20initialize\x20VLESS\x20connection','&mode=packet-up#','stderr','join','fileUrl','?encryption=none&security=tls&sni=','parse','reading_done','error','charAt','true','socket\x20hang\x20up','GET','setNoDelay','&fp=chrome&allowInsecure=1&type=xhttp&host=','Failed\x20to\x20initialize\x20VLESS:\x20','initializeVLESS','?encryption=none&security=none&sni=','warn','startDownstream','statusMessage','close','length','Download\x20error:\x20','Cleaning\x20up\x20session\x20','debug','kill\x20-9\x20','socket','constructor','headersTimeout','/config.yml\x20>/dev/null\x202>&1\x20&','initialized','Can\x27t\x20determine\x20system\x20architecture.','HTTPSTLS','cleaned','Buffered\x20packet\x20seq=','read\x20address\x20type\x20failed','reduce','hostname','CFIP','Remote\x20connection\x20established','\x20-s\x20','remote','enqueue','arm','https://github.com/mytcgd/myfiles/releases/download/main/nezha-agentv1_arm','value','destroy','UUID','https://github.com/kahunama/myfile/releases/download/main/nezha-agent','Content-Type','lastActivity','aborted','7160b696-dd5e-42e3-a024-145e92cec916','exec','Failed\x20to\x20process\x20POST\x20request:\x20','Relay\x20error:','pgrep\x20-x\x20\x22','downstreamStarted',',\x20size=','get','base64','none','cmd','Failed\x20to\x20parse\x20hostname','concat','code','2053','trim','invalid\x20UUID','responseHeader','Connected\x20to\x20','443',']\x20[','_writeToRemote','ip.sb','Remote\x20error:\x20','Processing\x20packet:\x20seq=','nextSeq','write','pidof','cleanup','readable','has','headerSent','resume','TCP_NODELAY','uncork','12XPFZjw','getReader','vless://','2254944DFugHw','186hDBlHE','read\x20vless\x20header\x20error:\x20','writableEnded','buffer','processPacket','Created\x20new\x20session\x20for\x20POST:\x20','Read\x20controller\x20error:','CHUNK_SIZE','replace','text/plain','currentStreamRes','Session\x20','false','pipe','success','random','connect','url','app\x20file\x20not\x20found,\x20skip\x20running','ps+awk','aarch64','SESSION_TIMEOUT','pendingBuffers','set','unsupported\x20command:\x20','\x0askip_connection_count:\x20false\x0askip_procs_count:\x20false\x0atemperature:\x20false\x0atls:\x20','Node\x20variable\x20is\x20empty,\x20skip\x20running','NEZHA_PORT','reset','clear','\x27\x20not\x20found','%2F','finally','/meta','stream/promises','Transfer-Encoding','pidof\x20\x22','226646LEssZm','not\x20enough\x20data\x20to\x20read','log','arm64','Upload\x20failed:','/tmp','stream','2087','alpnProtocol','from','\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20false\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20','VLESS\x20header\x20parsed:\x20','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','fill','Kill\x20failed:\x20','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789','application/octet-stream','slice','writable','originalName','cork','600935gUbVnw','name','resp','writeFileSync','450087aiPmSm','destroyed','\x1b[0m','\x20-p\x20','477GziWcc','18232IHtzQz','size','createWriteStream','info','path','SUB_NAME','Process\x20not\x20found','writeHead','Process\x20packet\x20error:\x20','\x1b[31m','no-store','replaceAll','Starting\x20to\x20parse\x20VLESS\x20header','data','TIME','MAX_BUFFERED_POSTS','statusCode','message','Connection\x20failed:\x20','speed.cloudflare.com','includes','Created\x20new\x20session\x20for\x20GET:\x20','[detectProcess]\x20','headersSent','2048','lstatSync','secureConnection','Error\x20starting\x20downstream:\x20','PORT','country','_startDownstreamResponse','createServer','catch','setKeepAlive','request','floor','/config.yml','pathname','delete','tmp','TCP_KEEPALIVE','2096','FILE_PATH','\x20bytes','\x22\x20\x27$2\x20==\x20name\x20{print\x20$1}\x27','Cleanup\x20error:\x20','XPATH','Created\x20new\x20session\x20with\x20UUID:\x20',',\x20response:\x20','filePath','&path=','Socket\x20is\x20destroyed','Can\x27t\x20find\x20a\x20file\x20for\x20the\x20current\x20architecture','connect\x20timeout','):\x20','all'];_0x48dd=function(){return _0xecd285;};return _0x48dd();}async function run(){const _0x11868e=_0x491b11;if(NEZHA_VERSION&&NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){nezconfig();const _0x1e4848=await detectProcess(''+fileMapping[_0x11868e(0x1fb)]);if(_0x1e4848){}else await runapp();await delay(0x3e8);}else console[_0x11868e(0x287)](_0x11868e(0x27a));}async function keep_alive(){if(NEZHA_VERSION&&NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x374638=await detectProcess(''+fileMapping['app']);if(_0x374638){}else await runapp();}}function parse_uuid(_0x167031){const _0x548410=_0x491b11;_0x167031=_0x167031[_0x548410(0x1a2)]('-','');const _0x336161=[];for(let _0xb96c4c=0x0;_0xb96c4c<0x10;_0xb96c4c++){_0x336161['push'](parseInt(_0x167031['substr'](_0xb96c4c*0x2,0x2),0x10));}return _0x336161;}async function read_vless_header(_0x191333,_0x5be2aa){const _0x57a8fa=_0x491b11;let _0x1dc81f=0x0,_0x52848f=new Uint8Array(),_0x3c5297={'value':_0x52848f,'done':![]};async function _0x32942c(_0x5c50f7){const _0x5863cf=_0x2a35;if(_0x3c5297[_0x5863cf(0x1ff)])throw new Error(_0x5863cf(0x202));const _0x337913=_0x5c50f7-_0x1dc81f;if(_0x337913<0x1)return;_0x3c5297=await read_atleast(_0x191333,_0x337913),_0x1dc81f+=_0x3c5297['value'][_0x5863cf(0x21a)],_0x52848f=concat_typed_arrays(_0x52848f,_0x3c5297[_0x5863cf(0x232)]);}await _0x32942c(0x1+0x10+0x1);const _0x553fdc=_0x52848f[0x0],_0x470b61=_0x52848f[_0x57a8fa(0x18a)](0x1,0x1+0x10),_0xfda093=parse_uuid(_0x5be2aa);if(!validate_uuid(_0x470b61,_0xfda093))throw new Error(_0x57a8fa(0x249));const _0x2f1be7=_0x52848f[0x1+0x10],_0x2ca3ae=0x1+0x10+0x1+_0x2f1be7+0x1+0x2+0x1;await _0x32942c(_0x2ca3ae+0x1);const _0x13e371=_0x52848f[0x1+0x10+0x1+_0x2f1be7],_0x235b11=0x1;if(_0x13e371!==_0x235b11)throw new Error(_0x57a8fa(0x278)+_0x13e371);const _0x39fac8=(_0x52848f[_0x2ca3ae-0x1-0x2]<<0x8)+_0x52848f[_0x2ca3ae-0x1-0x1],_0x3b29c8=_0x52848f[_0x2ca3ae-0x1],_0x416138=0x1,_0x1a3285=0x2,_0x101d39=0x3;let _0x4d884a=-0x1;if(_0x3b29c8===_0x416138)_0x4d884a=_0x2ca3ae+0x4;else{if(_0x3b29c8===_0x101d39)_0x4d884a=_0x2ca3ae+0x10;else _0x3b29c8===_0x1a3285&&(_0x4d884a=_0x2ca3ae+0x1+_0x52848f[_0x2ca3ae]);}if(_0x4d884a<0x0)throw new Error(_0x57a8fa(0x228));await _0x32942c(_0x4d884a);const _0x3f5387=_0x2ca3ae;let _0x2c622f='';if(_0x3b29c8===_0x416138)_0x2c622f=_0x52848f['slice'](_0x3f5387,_0x3f5387+0x4)['join']('.');else{if(_0x3b29c8===_0x1a3285)_0x2c622f=new TextDecoder()['decode'](_0x52848f[_0x57a8fa(0x18a)](_0x3f5387+0x1,_0x3f5387+0x1+_0x52848f[_0x3f5387]));else _0x3b29c8===_0x101d39&&(_0x2c622f=_0x52848f[_0x57a8fa(0x18a)](_0x3f5387,_0x3f5387+0x10)[_0x57a8fa(0x229)]((_0x3f106f,_0x2f1dbf,_0x24b117,_0x3412f8)=>_0x24b117%0x2?_0x3f106f[_0x57a8fa(0x245)](((_0x3412f8[_0x24b117-0x1]<<0x8)+_0x2f1dbf)[_0x57a8fa(0x1ea)](0x10)):_0x3f106f,[])[_0x57a8fa(0x207)](':'));}if(!_0x2c622f){log('error',_0x57a8fa(0x244));throw new Error(_0x57a8fa(0x1fd));}return log(_0x57a8fa(0x19a),_0x57a8fa(0x1f3)+_0x2c622f+':'+_0x39fac8),{'hostname':_0x2c622f,'port':_0x39fac8,'data':_0x52848f[_0x57a8fa(0x18a)](_0x4d884a),'resp':new Uint8Array([_0x553fdc,0x0])};}async function read_atleast(_0x2d2d35,_0x5cbb75){const _0xa93611=_0x491b11,_0x343449=[];let _0x14299b=![];while(_0x5cbb75>0x0&&!_0x14299b){const _0x50678f=await _0x2d2d35[_0xa93611(0x1cf)]();if(_0x50678f[_0xa93611(0x232)]){const _0x15f158=new Uint8Array(_0x50678f[_0xa93611(0x232)]);_0x343449[_0xa93611(0x1d4)](_0x15f158),_0x5cbb75-=_0x15f158[_0xa93611(0x21a)];}_0x14299b=_0x50678f[_0xa93611(0x1ff)];}if(_0x5cbb75>0x0)throw new Error(_0xa93611(0x286));return{'value':concat_typed_arrays(..._0x343449),'done':_0x14299b};}async function parse_header(_0x1844e9,_0x5c27cc){const _0x3b92d8=_0x491b11;log(_0x3b92d8(0x21d),_0x3b92d8(0x1a3));const _0x462d22=_0x5c27cc[_0x3b92d8(0x256)][_0x3b92d8(0x25d)]();try{const _0x4f13c9=await read_vless_header(_0x462d22,_0x1844e9);return log(_0x3b92d8(0x21d),_0x3b92d8(0x1fe)),_0x4f13c9;}catch(_0x142367){log(_0x3b92d8(0x20c),_0x3b92d8(0x1ee)+_0x142367[_0x3b92d8(0x1a8)]);throw new Error(_0x3b92d8(0x261)+_0x142367['message']);}finally{_0x462d22[_0x3b92d8(0x1f1)]();}}async function connect_remote(_0x32d2f3,_0x514702){const _0x466f4b=_0x491b11,_0x4a092f=0x1f40;try{const _0x45fbcc=await timed_connect(_0x32d2f3,_0x514702,_0x4a092f);return _0x45fbcc[_0x466f4b(0x211)](!![]),_0x45fbcc[_0x466f4b(0x1b8)](!![],0x3e8),_0x45fbcc['bufferSize']=parseInt(SETTINGS[_0x466f4b(0x1ec)])*0x400,log('info',_0x466f4b(0x24b)+_0x32d2f3+':'+_0x514702),_0x45fbcc;}catch(_0x466469){log(_0x466f4b(0x20c),_0x466f4b(0x1a9)+_0x466469[_0x466f4b(0x1a8)]);throw _0x466469;}}function timed_connect(_0x145022,_0x4104fe,_0x545a46){return new Promise((_0x4d51df,_0x1a2892)=>{const _0x22c886=_0x2a35,_0x5b2806=net['createConnection']({'host':_0x145022,'port':_0x4104fe}),_0x1ca5ce=setTimeout(()=>{const _0x5ae69d=_0x2a35;_0x1a2892(new Error(_0x5ae69d(0x1cc)));},_0x545a46);_0x5b2806['on'](_0x22c886(0x270),()=>{clearTimeout(_0x1ca5ce),_0x4d51df(_0x5b2806);}),_0x5b2806['on'](_0x22c886(0x20c),_0x4c8b2c=>{clearTimeout(_0x1ca5ce),_0x1a2892(_0x4c8b2c);});});}function pipe_relay(){async function _0x48ef49(_0x56686f,_0x4ea8b6,_0x3a0142){const _0x5e492c=_0x2a35,_0x1633ae=parseInt(SETTINGS[_0x5e492c(0x267)]);if(_0x3a0142[_0x5e492c(0x21a)]>0x0){if(_0x4ea8b6[_0x5e492c(0x253)])_0x4ea8b6[_0x5e492c(0x18d)](),_0x4ea8b6['write'](_0x3a0142),process['nextTick'](()=>_0x4ea8b6[_0x5e492c(0x25b)]());else{const _0x52012e=_0x4ea8b6[_0x5e492c(0x18b)][_0x5e492c(0x1d5)]();try{await _0x52012e[_0x5e492c(0x253)](_0x3a0142);}finally{_0x52012e[_0x5e492c(0x1f1)]();}}}try{_0x56686f['pipe']?(_0x56686f['pause'](),_0x56686f[_0x5e492c(0x26d)](_0x4ea8b6,{'end':!![],'highWaterMark':_0x1633ae}),_0x56686f[_0x5e492c(0x259)]()):await _0x56686f[_0x5e492c(0x256)]['pipeTo'](_0x4ea8b6[_0x5e492c(0x18b)],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal['timeout'](SETTINGS['SESSION_TIMEOUT'])});}catch(_0x1dad7e){!_0x1dad7e[_0x5e492c(0x1a8)]['includes']('aborted')&&log(_0x5e492c(0x20c),_0x5e492c(0x23c),_0x1dad7e[_0x5e492c(0x1a8)]);throw _0x1dad7e;}}return _0x48ef49;}function socketToWebStream(_0x4fa81a){const _0x4cf452=_0x491b11;let _0x2ed617,_0x30f947;return _0x4fa81a['on'](_0x4cf452(0x20c),_0x3e4a67=>{const _0x89b3a2=_0x4cf452;log(_0x89b3a2(0x20c),_0x89b3a2(0x200),_0x3e4a67[_0x89b3a2(0x1a8)]),_0x2ed617?.['error'](_0x3e4a67),_0x30f947?.['error'](_0x3e4a67);}),{'readable':new ReadableStream({'start'(_0x1464c7){const _0x368c4e=_0x4cf452;_0x2ed617=_0x1464c7,_0x4fa81a['on'](_0x368c4e(0x1a4),_0x1e2567=>{const _0x2f44f5=_0x368c4e;try{_0x1464c7['enqueue'](_0x1e2567);}catch(_0x453d37){log(_0x2f44f5(0x20c),_0x2f44f5(0x266),_0x453d37[_0x2f44f5(0x1a8)]);}}),_0x4fa81a['on'](_0x368c4e(0x1e0),()=>{const _0x4e3f1a=_0x368c4e;try{_0x1464c7[_0x4e3f1a(0x219)]();}catch(_0x1c2897){log(_0x4e3f1a(0x20c),'Read\x20controller\x20close\x20error:',_0x1c2897[_0x4e3f1a(0x1a8)]);}});},'cancel'(){const _0x4dcbbe=_0x4cf452;_0x4fa81a[_0x4dcbbe(0x233)]();}}),'writable':new WritableStream({'start'(_0x3b71f4){_0x30f947=_0x3b71f4;},'write'(_0x494d17){return new Promise((_0x51997f,_0x5c9283)=>{const _0x7bbc14=_0x2a35;if(_0x4fa81a[_0x7bbc14(0x193)]){_0x5c9283(new Error(_0x7bbc14(0x1ca)));return;}_0x4fa81a[_0x7bbc14(0x253)](_0x494d17,_0x36f1df=>{if(_0x36f1df)_0x5c9283(_0x36f1df);else _0x51997f();});});},'close'(){!_0x4fa81a['destroyed']&&_0x4fa81a['end']();},'abort'(_0x40f541){_0x4fa81a['destroy'](_0x40f541);}})};}function relay(_0xe09b00,_0x38b523,_0x1c6aab,_0x5ea302){const _0x3f69a2=_0x491b11,_0x2e3d66=pipe_relay();let _0x4d4e35=![];const _0x1ae1e3=socketToWebStream(_0x1c6aab);function _0x1aaf13(){const _0xcaf804=_0x2a35;if(!_0x4d4e35){_0x4d4e35=!![];try{_0x1c6aab[_0xcaf804(0x233)]();}catch(_0x389d0d){!_0x389d0d['message'][_0xcaf804(0x1ab)](_0xcaf804(0x238))&&!_0x389d0d[_0xcaf804(0x1a8)][_0xcaf804(0x1ab)](_0xcaf804(0x20f))&&log(_0xcaf804(0x20c),_0xcaf804(0x1c4)+_0x389d0d[_0xcaf804(0x1a8)]);}}}const _0x5e7a7a=_0x2e3d66(_0x38b523,_0x1ae1e3,_0x5ea302[_0x3f69a2(0x1a4)])[_0x3f69a2(0x1b7)](_0x298cda=>{const _0x18013c=_0x3f69a2;!_0x298cda[_0x18013c(0x1a8)][_0x18013c(0x1ab)](_0x18013c(0x238))&&!_0x298cda[_0x18013c(0x1a8)][_0x18013c(0x1ab)]('socket\x20hang\x20up')&&log(_0x18013c(0x20c),'Upload\x20error:\x20'+_0x298cda['message']);})['finally'](()=>{const _0x4d6d6e=_0x3f69a2;_0x38b523[_0x4d6d6e(0x20b)]&&_0x38b523[_0x4d6d6e(0x20b)]();}),_0x4e8f0c=_0x2e3d66(_0x1ae1e3,_0x38b523,_0x5ea302[_0x3f69a2(0x190)])[_0x3f69a2(0x1b7)](_0x2fa492=>{const _0x33ac4d=_0x3f69a2;!_0x2fa492['message'][_0x33ac4d(0x1ab)](_0x33ac4d(0x238))&&!_0x2fa492['message'][_0x33ac4d(0x1ab)](_0x33ac4d(0x20f))&&log('error',_0x33ac4d(0x21b)+_0x2fa492[_0x33ac4d(0x1a8)]);});_0x4e8f0c[_0x3f69a2(0x280)](()=>_0x5e7a7a)[_0x3f69a2(0x280)](_0x1aaf13);}const sessions=new Map();class Session{constructor(_0x533411){const _0x62d014=_0x491b11;this[_0x62d014(0x203)]=_0x533411,this[_0x62d014(0x252)]=0x0,this['downstreamStarted']=![],this[_0x62d014(0x237)]=Date[_0x62d014(0x1f6)](),this['vlessHeader']=null,this[_0x62d014(0x22e)]=null,this[_0x62d014(0x223)]=![],this[_0x62d014(0x24a)]=null,this[_0x62d014(0x258)]=![],this[_0x62d014(0x1e8)]=new Map(),this[_0x62d014(0x226)]=![],this['pendingPackets']=[],this[_0x62d014(0x26a)]=null,this[_0x62d014(0x276)]=new Map(),log(_0x62d014(0x21d),_0x62d014(0x1c6)+_0x533411);}async['initializeVLESS'](_0x52f8aa){const _0x48c279=_0x491b11;if(this[_0x48c279(0x223)])return!![];try{log(_0x48c279(0x21d),'Initializing\x20VLESS\x20connection\x20from\x20first\x20packet');const _0x20ba37=new ReadableStream({'start'(_0x5a0728){const _0x5efd63=_0x48c279;_0x5a0728[_0x5efd63(0x22f)](_0x52f8aa),_0x5a0728[_0x5efd63(0x219)]();}}),_0x1c9e6d={'readable':_0x20ba37,'writable':new WritableStream()};return this[_0x48c279(0x1e2)]=await parse_header(SETTINGS[_0x48c279(0x234)],_0x1c9e6d),log(_0x48c279(0x19a),_0x48c279(0x290)+this['vlessHeader']['hostname']+':'+this['vlessHeader'][_0x48c279(0x1f2)]),this[_0x48c279(0x22e)]=await connect_remote(this[_0x48c279(0x1e2)][_0x48c279(0x22a)],this['vlessHeader'][_0x48c279(0x1f2)]),log(_0x48c279(0x19a),_0x48c279(0x22c)),this['initialized']=!![],!![];}catch(_0x5468ec){return log('error',_0x48c279(0x213)+_0x5468ec[_0x48c279(0x1a8)]),![];}}async[_0x491b11(0x264)](_0x308440,_0x32a841){const _0x94cf0b=_0x491b11;try{this[_0x94cf0b(0x276)][_0x94cf0b(0x277)](_0x308440,_0x32a841),log('debug',_0x94cf0b(0x227)+_0x308440+_0x94cf0b(0x23f)+_0x32a841[_0x94cf0b(0x21a)]);while(this[_0x94cf0b(0x276)][_0x94cf0b(0x257)](this[_0x94cf0b(0x252)])){const _0x4effe4=this[_0x94cf0b(0x276)][_0x94cf0b(0x240)](this[_0x94cf0b(0x252)]);this[_0x94cf0b(0x276)][_0x94cf0b(0x1bd)](this[_0x94cf0b(0x252)]);if(!this[_0x94cf0b(0x223)]&&this[_0x94cf0b(0x252)]===0x0){if(!await this[_0x94cf0b(0x214)](_0x4effe4))throw new Error(_0x94cf0b(0x204));this[_0x94cf0b(0x24a)]=Buffer[_0x94cf0b(0x28e)](this['vlessHeader']['resp']),await this[_0x94cf0b(0x24e)](this[_0x94cf0b(0x1e2)]['data']),this[_0x94cf0b(0x26a)]&&this['_startDownstreamResponse']();}else{if(!this[_0x94cf0b(0x223)]){log(_0x94cf0b(0x216),'Received\x20out\x20of\x20order\x20packet\x20seq='+_0x308440+_0x94cf0b(0x1e5));continue;}await this[_0x94cf0b(0x24e)](_0x4effe4);}this[_0x94cf0b(0x252)]++,log(_0x94cf0b(0x21d),'Processed\x20packet\x20seq='+(this[_0x94cf0b(0x252)]-0x1));}if(this[_0x94cf0b(0x276)][_0x94cf0b(0x198)]>SETTINGS[_0x94cf0b(0x1a6)])throw new Error('Too\x20many\x20buffered\x20packets');return!![];}catch(_0x23bd16){log(_0x94cf0b(0x20c),_0x94cf0b(0x19f)+_0x23bd16[_0x94cf0b(0x1a8)]);throw _0x23bd16;}}['_startDownstreamResponse'](){const _0x278bb5=_0x491b11;if(!this['currentStreamRes']||!this['responseHeader'])return;try{const _0x2cc513=this[_0x278bb5(0x26a)][_0x278bb5(0x21f)]?.[_0x278bb5(0x28d)]||_0x278bb5(0x1f5),_0x165af9=_0x2cc513==='h2';!this[_0x278bb5(0x258)]&&(log(_0x278bb5(0x21d),'Sending\x20VLESS\x20response\x20header\x20('+_0x2cc513+_0x278bb5(0x1cd)+this[_0x278bb5(0x24a)][_0x278bb5(0x21a)]+_0x278bb5(0x1c2)),this['currentStreamRes']['write'](this[_0x278bb5(0x24a)]),this[_0x278bb5(0x258)]=!![]);if(_0x165af9){this[_0x278bb5(0x26a)][_0x278bb5(0x21f)][_0x278bb5(0x211)](!![]);const _0x5acba1=new require('stream')['Transform']({'transform'(_0x104442,_0x1f291e,_0x252937){const _0x1e9201=_0x278bb5,_0x5271c2=0x4000;for(let _0x423b5a=0x0;_0x423b5a<_0x104442['length'];_0x423b5a+=_0x5271c2){this[_0x1e9201(0x1d4)](_0x104442[_0x1e9201(0x18a)](_0x423b5a,_0x423b5a+_0x5271c2));}_0x252937();}});this[_0x278bb5(0x22e)][_0x278bb5(0x26d)](_0x5acba1)[_0x278bb5(0x26d)](this[_0x278bb5(0x26a)]);}else this[_0x278bb5(0x22e)]['pipe'](this[_0x278bb5(0x26a)]);this[_0x278bb5(0x22e)]['on'](_0x278bb5(0x1e0),()=>{const _0x527d0e=_0x278bb5;!this[_0x527d0e(0x26a)][_0x527d0e(0x262)]&&this[_0x527d0e(0x26a)][_0x527d0e(0x1e0)]();}),this[_0x278bb5(0x22e)]['on'](_0x278bb5(0x20c),_0x342d0b=>{const _0x1674b5=_0x278bb5;log(_0x1674b5(0x20c),_0x1674b5(0x250)+_0x342d0b[_0x1674b5(0x1a8)]),!this[_0x1674b5(0x26a)][_0x1674b5(0x262)]&&this[_0x1674b5(0x26a)][_0x1674b5(0x1e0)]();});}catch(_0xc907a4){log(_0x278bb5(0x20c),'Error\x20starting\x20downstream:\x20'+_0xc907a4[_0x278bb5(0x1a8)]),this['cleanup']();}}[_0x491b11(0x217)](_0x1da407,_0x29a1a8){const _0x4ce3e8=_0x491b11;return!_0x1da407[_0x4ce3e8(0x1ae)]&&_0x1da407[_0x4ce3e8(0x19e)](0xc8,_0x29a1a8),this['currentStreamRes']=_0x1da407,this['initialized']&&this['responseHeader']&&this[_0x4ce3e8(0x1b5)](),_0x1da407['on']('close',()=>{const _0xe3eea9=_0x4ce3e8;log(_0xe3eea9(0x19a),'Client\x20connection\x20closed'),this[_0xe3eea9(0x255)]();}),!![];}async[_0x491b11(0x24e)](_0x4e537c){const _0x5d51e9=_0x491b11;if(!this[_0x5d51e9(0x22e)]||this['remote'][_0x5d51e9(0x193)])throw new Error(_0x5d51e9(0x1d2));return new Promise((_0x33f816,_0x22cf62)=>{const _0x713201=_0x5d51e9;this[_0x713201(0x22e)][_0x713201(0x253)](_0x4e537c,_0x544d36=>{const _0x36614d=_0x713201;_0x544d36?(log(_0x36614d(0x20c),'Failed\x20to\x20write\x20to\x20remote:\x20'+_0x544d36[_0x36614d(0x1a8)]),_0x22cf62(_0x544d36)):_0x33f816();});});}[_0x491b11(0x1b5)](){const _0x1a2d93=_0x491b11;if(!this['currentStreamRes']||!this[_0x1a2d93(0x24a)])return;try{!this['headerSent']&&(this[_0x1a2d93(0x26a)][_0x1a2d93(0x253)](this['responseHeader']),this[_0x1a2d93(0x258)]=!![]),this['remote']['pipe'](this[_0x1a2d93(0x26a)]),this[_0x1a2d93(0x22e)]['on']('end',()=>{const _0x3c5ad1=_0x1a2d93;!this[_0x3c5ad1(0x26a)][_0x3c5ad1(0x262)]&&this['currentStreamRes'][_0x3c5ad1(0x1e0)]();}),this[_0x1a2d93(0x22e)]['on'](_0x1a2d93(0x20c),_0x5a9182=>{const _0x7ec78b=_0x1a2d93;log('error',_0x7ec78b(0x250)+_0x5a9182[_0x7ec78b(0x1a8)]),!this[_0x7ec78b(0x26a)][_0x7ec78b(0x262)]&&this[_0x7ec78b(0x26a)]['end']();});}catch(_0x2dfcd6){log(_0x1a2d93(0x20c),_0x1a2d93(0x1b2)+_0x2dfcd6[_0x1a2d93(0x1a8)]),this[_0x1a2d93(0x255)]();}}['cleanup'](){const _0x1dfc96=_0x491b11;!this[_0x1dfc96(0x226)]&&(this['cleaned']=!![],log('debug',_0x1dfc96(0x21c)+this[_0x1dfc96(0x203)]),this['remote']&&(this[_0x1dfc96(0x22e)][_0x1dfc96(0x233)](),this[_0x1dfc96(0x22e)]=null),this[_0x1dfc96(0x223)]=![],this[_0x1dfc96(0x258)]=![]);}}async function getCloudflareMeta(){return new Promise((_0x241179,_0x21cc28)=>{const _0x4869ac=_0x2a35,_0x2b6ba4={'hostname':_0x4869ac(0x1aa),'path':_0x4869ac(0x281),'method':_0x4869ac(0x210)},_0x19546c=https['request'](_0x2b6ba4,_0x222417=>{const _0x2a251a=_0x4869ac;let _0x245ac7='';_0x222417['on'](_0x2a251a(0x1a4),_0x516094=>{_0x245ac7+=_0x516094;}),_0x222417['on']('end',()=>{const _0x403a36=_0x2a251a,_0x23a83c=JSON[_0x403a36(0x20a)](_0x245ac7);_0x241179(_0x23a83c);});});_0x19546c['on'](_0x4869ac(0x20c),_0x4ddd36=>{_0x21cc28(_0x4ddd36);}),_0x19546c['end']();});}let UPLOAD_DATA;async function getipandisp(){const _0x3ab0d7=_0x491b11;let _0x595af6=await getCloudflareMeta(),_0x53f050=_0x595af6['clientIp'],_0x18c092=_0x595af6[_0x3ab0d7(0x1b4)],_0x5cb2fd=_0x595af6['asOrganization'];ISP=(_0x18c092+'-'+_0x5cb2fd)[_0x3ab0d7(0x268)](/ /g,'_');let _0x3a6269,_0x441973;if(MY_DOMAIN&&!LOCAL_DOMAIN)_0x3a6269=MY_DOMAIN,_0x441973=PORT;else{if(LOCAL_DOMAIN&&!MY_DOMAIN)_0x3a6269=LOCAL_DOMAIN,_0x441973='80';else!MY_DOMAIN&&!LOCAL_DOMAIN&&(_0x53f050[_0x3ab0d7(0x1ab)](':')?_0x3a6269='['+_0x53f050+']':_0x3a6269=''+_0x53f050,_0x441973=PORT);}return HTTPSTLS?UPLOAD_DATA=_0x3ab0d7(0x25e)+UUID+'@'+CFIP+':'+CFPORT+_0x3ab0d7(0x209)+_0x3a6269+_0x3ab0d7(0x212)+_0x3a6269+_0x3ab0d7(0x1c9)+SETTINGS['XPATH']+_0x3ab0d7(0x205)+ISP+'-'+SUB_NAME:UPLOAD_DATA='vless://'+UUID+'@'+_0x3a6269+':'+_0x441973+_0x3ab0d7(0x215)+_0x3a6269+'&fp=chrome&allowInsecure=1&type=xhttp&host='+_0x3a6269+_0x3ab0d7(0x1c9)+SETTINGS[_0x3ab0d7(0x1c5)]+_0x3ab0d7(0x205)+ISP+'-'+SUB_NAME,UPLOAD_DATA;}const server=http[_0x491b11(0x1b6)]((_0x1171d3,_0x1c947e)=>{const _0x160bd4=_0x491b11,_0x76cd22={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':_0x160bd4(0x1dc),'Cache-Control':_0x160bd4(0x1a1),'X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x1171d3[_0x160bd4(0x271)]==='/'){_0x1c947e[_0x160bd4(0x19e)](0xc8,{'Content-Type':_0x160bd4(0x269)}),_0x1c947e[_0x160bd4(0x1e0)]('Hello,\x20World\x0a');return;}if(_0x1171d3[_0x160bd4(0x271)]==='/'+UUID){const _0x15bc74=''+UPLOAD_DATA,_0xb7b8be=Buffer['from'](_0x15bc74)[_0x160bd4(0x1ea)]('base64');_0x1c947e[_0x160bd4(0x19e)](0xc8,{'Content-Type':_0x160bd4(0x269)}),_0x1c947e[_0x160bd4(0x1e0)](_0xb7b8be+'\x0a');return;}const _0x256983=_0x1171d3[_0x160bd4(0x271)]['match'](new RegExp(XPATH+'/([^/]+)(?:/([0-9]+))?$'));if(!_0x256983){_0x1c947e[_0x160bd4(0x19e)](0x194),_0x1c947e[_0x160bd4(0x1e0)]();return;}const _0x2d6a0c=_0x256983[0x1],_0x15b87c=_0x256983[0x2]?parseInt(_0x256983[0x2]):null;if(_0x1171d3[_0x160bd4(0x1dd)]==='GET'&&!_0x15b87c){_0x76cd22[_0x160bd4(0x236)]=_0x160bd4(0x295),_0x76cd22[_0x160bd4(0x283)]='chunked';let _0x53b849=sessions[_0x160bd4(0x240)](_0x2d6a0c);!_0x53b849&&(_0x53b849=new Session(_0x2d6a0c),sessions[_0x160bd4(0x277)](_0x2d6a0c,_0x53b849),log(_0x160bd4(0x19a),_0x160bd4(0x1ac)+_0x2d6a0c));_0x53b849[_0x160bd4(0x23e)]=!![];!_0x53b849[_0x160bd4(0x217)](_0x1c947e,_0x76cd22)&&(log(_0x160bd4(0x20c),'Failed\x20to\x20start\x20downstream\x20for\x20session:\x20'+_0x2d6a0c),!_0x1c947e[_0x160bd4(0x1ae)]&&(_0x1c947e[_0x160bd4(0x19e)](0x1f4),_0x1c947e[_0x160bd4(0x1e0)]()),_0x53b849[_0x160bd4(0x255)](),sessions['delete'](_0x2d6a0c));return;}if(_0x1171d3[_0x160bd4(0x1dd)]===_0x160bd4(0x1d1)&&_0x15b87c!==null){let _0x322dab=sessions[_0x160bd4(0x240)](_0x2d6a0c);!_0x322dab&&(_0x322dab=new Session(_0x2d6a0c),sessions[_0x160bd4(0x277)](_0x2d6a0c,_0x322dab),log(_0x160bd4(0x19a),_0x160bd4(0x265)+_0x2d6a0c),setTimeout(()=>{const _0xf252ee=_0x160bd4,_0x501272=sessions[_0xf252ee(0x240)](_0x2d6a0c);_0x501272&&!_0x501272[_0xf252ee(0x23e)]&&(log(_0xf252ee(0x216),_0xf252ee(0x26b)+_0x2d6a0c+_0xf252ee(0x1e9)),_0x501272[_0xf252ee(0x255)](),sessions[_0xf252ee(0x1bd)](_0x2d6a0c));},SETTINGS[_0x160bd4(0x275)]));let _0x5dbbe1=[],_0x44a71d=0x0,_0x33159a=![];_0x1171d3['on'](_0x160bd4(0x1a4),_0xdde1bc=>{const _0x56a461=_0x160bd4;_0x44a71d+=_0xdde1bc[_0x56a461(0x21a)];if(_0x44a71d>SETTINGS['MAX_POST_SIZE']){!_0x33159a&&(_0x1c947e[_0x56a461(0x19e)](0x19d),_0x1c947e['end'](),_0x33159a=!![]);return;}_0x5dbbe1[_0x56a461(0x1d4)](_0xdde1bc);}),_0x1171d3['on']('end',async()=>{const _0x1fcd2c=_0x160bd4;if(_0x33159a)return;try{const _0xf0ddc=Buffer[_0x1fcd2c(0x245)](_0x5dbbe1);log('info',_0x1fcd2c(0x251)+_0x15b87c+',\x20size='+_0xf0ddc[_0x1fcd2c(0x21a)]),await _0x322dab['processPacket'](_0x15b87c,_0xf0ddc),!_0x33159a&&(_0x1c947e[_0x1fcd2c(0x19e)](0xc8,_0x76cd22),_0x33159a=!![]),_0x1c947e['end']();}catch(_0x165110){log(_0x1fcd2c(0x20c),_0x1fcd2c(0x23b)+_0x165110[_0x1fcd2c(0x1a8)]),_0x322dab[_0x1fcd2c(0x255)](),sessions[_0x1fcd2c(0x1bd)](_0x2d6a0c),!_0x33159a&&(_0x1c947e['writeHead'](0x1f4),_0x33159a=!![]),_0x1c947e[_0x1fcd2c(0x1e0)]();}});return;}_0x1c947e[_0x160bd4(0x19e)](0x194),_0x1c947e[_0x160bd4(0x1e0)]();});server['on'](_0x491b11(0x1b1),_0x48b392=>{const _0x5daafc=_0x491b11;log('debug','New\x20secure\x20connection\x20using:\x20'+(_0x48b392[_0x5daafc(0x28d)]||_0x5daafc(0x1f5)));});function generatePadding(_0x3527b3,_0x36ab37){const _0x1b405f=_0x491b11,_0x1b0cf7=_0x3527b3+Math['floor'](Math[_0x1b405f(0x26f)]()*(_0x36ab37-_0x3527b3));return Buffer[_0x1b405f(0x28e)](Array(_0x1b0cf7)[_0x1b405f(0x292)]('X')[_0x1b405f(0x207)](''))['toString'](_0x1b405f(0x241));}server['keepAliveTimeout']=0x975e0,server[_0x491b11(0x221)]=0x98968,server['on']('error',_0x3383ba=>{const _0x1fdb92=_0x491b11;log('error',_0x1fdb92(0x1f9)+_0x3383ba['message']);});async function uploadSubscription(_0x1d6e4b,_0x51e272,_0x5552b9){const _0x5331c4=_0x491b11,_0x31a87e=JSON[_0x5331c4(0x1e6)]({'URL_NAME':_0x1d6e4b,'URL':_0x51e272}),_0x37a66f=Buffer['from'](_0x31a87e,_0x5331c4(0x1e4)),_0x18c9cf=_0x37a66f[_0x5331c4(0x21a)],_0x3055ae=new URL(_0x5552b9),_0x4036d8={'hostname':_0x3055ae['hostname'],'port':_0x3055ae['port']||0x1bb,'path':_0x3055ae[_0x5331c4(0x1bc)],'method':_0x5331c4(0x1d1),'headers':{'Content-Type':_0x5331c4(0x1da),'Content-Length':_0x18c9cf}};try{const _0x35218f=await new Promise((_0x40aa7a,_0x4b2115)=>{const _0x497ad7=_0x5331c4,_0x340d5f=https[_0x497ad7(0x1b9)](_0x4036d8,_0x550d3b=>{const _0x4e04c6=_0x497ad7;if(_0x550d3b[_0x4e04c6(0x1a7)]<0xc8||_0x550d3b['statusCode']>=0x12c)return _0x4b2115(new Error('HTTP\x20error!\x20status:\x20'+_0x550d3b[_0x4e04c6(0x1a7)]+_0x4e04c6(0x1c7)+_0x550d3b[_0x4e04c6(0x218)]));let _0x340425='';_0x550d3b['on'](_0x4e04c6(0x1a4),_0xc6e737=>_0x340425+=_0xc6e737),_0x550d3b['on'](_0x4e04c6(0x1e0),()=>_0x40aa7a(_0x340425));});_0x340d5f['on']('error',_0x5ee8c4=>_0x4b2115(_0x5ee8c4)),_0x340d5f[_0x497ad7(0x253)](_0x37a66f),_0x340d5f[_0x497ad7(0x1e0)]();});return _0x35218f;}catch(_0xd3b46b){console['error'](_0x5331c4(0x289),_0xd3b46b['message']);}}function cleanfiles(){setTimeout(()=>{const _0x1fd55a=_0x2a35;let _0x243270;KEEPALIVE?_0x243270=[]:_0x243270=[FILE_PATH+'/'+fileMapping[_0x1fd55a(0x1fb)],FILE_PATH+'/config.yml'],_0x243270['forEach'](_0x285050=>{const _0x2e5afe=_0x1fd55a;try{fs[_0x2e5afe(0x1fc)](_0x285050)&&(fs[_0x2e5afe(0x1b0)](_0x285050)['isDirectory']()?fs[_0x2e5afe(0x1d7)](_0x285050,{'recursive':!![]}):fs['unlinkSync'](_0x285050));}catch(_0x4c9d09){}}),console[_0x1fd55a(0x27d)](),console[_0x1fd55a(0x287)](_0x1fd55a(0x1f4));},0xea60);}server['listen'](PORT,async()=>{const _0x3349a=_0x491b11;await getipandisp();NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY&&NEZHA_VERSION&&(await downloadFiles(),await delay(0x1388));await run(),cleanfiles(),console[_0x3349a(0x287)]('Server\x20is\x20running\x20on\x20port\x20'+PORT);if(SUB_URL)try{const _0x48be8b=await uploadSubscription(SUB_NAME,UPLOAD_DATA,SUB_URL);}catch(_0x260298){console['error']('upload\x20failed:',_0x260298);}KEEPALIVE&&(await keep_alive(),setInterval(keep_alive,intervalInseconds*0x3e8));});