const _0x3a7e93=_0x214f;(function(_0xf12f75,_0xdd633){const _0x20900c=_0x214f,_0x2b082e=_0xf12f75();while(!![]){try{const _0x4db507=parseInt(_0x20900c(0x1af))/0x1+parseInt(_0x20900c(0x202))/0x2+-parseInt(_0x20900c(0x1e8))/0x3+-parseInt(_0x20900c(0x187))/0x4+parseInt(_0x20900c(0x198))/0x5+parseInt(_0x20900c(0x201))/0x6+-parseInt(_0x20900c(0x1a1))/0x7;if(_0x4db507===_0xdd633)break;else _0x2b082e['push'](_0x2b082e['shift']());}catch(_0x22b958){_0x2b082e['push'](_0x2b082e['shift']());}}}(_0x4219,0xaefa5));const os=require('os'),fs=require('fs'),net=require(_0x3a7e93(0x203)),path=require(_0x3a7e93(0x1f7)),http=require('http'),https=require(_0x3a7e93(0x1ed)),axios=require(_0x3a7e93(0x271)),{Buffer}=require(_0x3a7e93(0x268)),{exec,execSync}=require(_0x3a7e93(0x209)),FILE_PATH=process['env'][_0x3a7e93(0x176)]||'/tmp',AUTO_ACCESS=process[_0x3a7e93(0x23f)][_0x3a7e93(0x221)]||![],DOMAIN=process['env'][_0x3a7e93(0x1d1)]||'',BAOHUO_URL=process['env'][_0x3a7e93(0x185)]||'',SUB_PATH=process[_0x3a7e93(0x23f)][_0x3a7e93(0x283)]||'sub',PORT=process['env']['PORT']||0xbb8,CFPORT=process[_0x3a7e93(0x23f)][_0x3a7e93(0x1d6)]||0x1bb,SUB_URL=process[_0x3a7e93(0x23f)]['SUB_URL']||'',KEEPALIVE=process[_0x3a7e93(0x23f)][_0x3a7e93(0x26c)]||![],delay=_0x427e37=>new Promise(_0x39d9a1=>setTimeout(_0x39d9a1,_0x427e37)),UUID=process[_0x3a7e93(0x23f)][_0x3a7e93(0x1d2)]||'',XPATH=process['env']['XPATH']||UUID[_0x3a7e93(0x196)](0x0,0x8),HTTPSTLS=process[_0x3a7e93(0x23f)][_0x3a7e93(0x1ce)]||!![],NEZHA_VERSION=process[_0x3a7e93(0x23f)]['NEZHA_VERSION']||'V0',NEZHA_SERVER=process[_0x3a7e93(0x23f)][_0x3a7e93(0x26b)]||'',NEZHA_PORT=process[_0x3a7e93(0x23f)][_0x3a7e93(0x1b6)]||_0x3a7e93(0x1c2),NEZHA_KEY=process['env'][_0x3a7e93(0x1e6)]||'',SUB_NAME=process[_0x3a7e93(0x23f)]['SUB_NAME']||'',MY_DOMAIN=process['env'][_0x3a7e93(0x1f9)]||'',SETTINGS={[_0x3a7e93(0x1d2)]:UUID,['LOG_LEVEL']:_0x3a7e93(0x19b),[_0x3a7e93(0x1a2)]:_0x3a7e93(0x251),[_0x3a7e93(0x260)]:_0x3a7e93(0x211)+XPATH,[_0x3a7e93(0x1c9)]:0x1e,[_0x3a7e93(0x193)]:0xf4240,['SESSION_TIMEOUT']:0x7530,[_0x3a7e93(0x217)]:0x400*0x400,[_0x3a7e93(0x1b1)]:!![],[_0x3a7e93(0x1e0)]:!![]};function validate_uuid(_0x3d94ec,_0x48ce4b){for(let _0x4e9b49=0x0;_0x4e9b49<0x10;_0x4e9b49++){if(_0x3d94ec[_0x4e9b49]!==_0x48ce4b[_0x4e9b49])return![];}return!![];}function concat_typed_arrays(_0x326dbc,..._0x20c5c9){const _0x1128f6=_0x3a7e93;if(!_0x20c5c9||_0x20c5c9['length']<0x1)return _0x326dbc;let _0x97e833=_0x326dbc['length'];for(let _0xbb1362 of _0x20c5c9)_0x97e833+=_0xbb1362['length'];const _0x21fa3f=new _0x326dbc['constructor'](_0x97e833);_0x21fa3f['set'](_0x326dbc,0x0),_0x97e833=_0x326dbc[_0x1128f6(0x1ae)];for(let _0x380390 of _0x20c5c9){_0x21fa3f[_0x1128f6(0x279)](_0x380390,_0x97e833),_0x97e833+=_0x380390[_0x1128f6(0x1ae)];}return _0x21fa3f;}function log(_0xccc728,..._0x259c50){const _0x53220a=_0x3a7e93;if(SETTINGS[_0x53220a(0x233)]===_0x53220a(0x19b))return;const _0x2905b8={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x5bd805={'debug':_0x53220a(0x205),'info':_0x53220a(0x1f3),'warn':_0x53220a(0x1fd),'error':_0x53220a(0x226),'reset':_0x53220a(0x17a)},_0x6c128b=_0x2905b8[SETTINGS[_0x53220a(0x233)]]||0x1,_0x402f26=_0x2905b8[_0xccc728]||0x0;if(_0x402f26>=_0x6c128b){const _0x39ae70=new Date()[_0x53220a(0x20e)](),_0x335df9=_0x5bd805[_0xccc728]||_0x5bd805[_0x53220a(0x1ad)];console[_0x53220a(0x194)](_0x335df9+'['+_0x39ae70+_0x53220a(0x200)+_0xccc728+']',..._0x259c50,_0x5bd805[_0x53220a(0x1ad)]);}}function cleanupOldFiles(){const _0x1f9733=_0x3a7e93;if(fs['existsSync'](path[_0x1f9733(0x21d)](FILE_PATH)))fs['rmSync'](path['join'](FILE_PATH),{'recursive':!![]});else{}}function createFolder(_0x508689){const _0x1b72bf=_0x3a7e93;if(!fs[_0x1b72bf(0x1cd)](_0x508689))fs[_0x1b72bf(0x281)](_0x508689);else{}}function execPromise(_0x2c5aef,_0x6789a={}){return new Promise((_0x349123,_0x57f7d4)=>{const _0xf246c2=exec(_0x2c5aef,_0x6789a,(_0x212e4b,_0x16df9c,_0xd67dd6)=>{const _0x2ae9fa=_0x214f;if(_0x212e4b){const _0x13e8ba=new Error('Command\x20failed:\x20'+_0x212e4b[_0x2ae9fa(0x1e2)]);_0x13e8ba[_0x2ae9fa(0x180)]=_0x212e4b[_0x2ae9fa(0x180)],_0x13e8ba['stderr']=_0xd67dd6['trim'](),_0x57f7d4(_0x13e8ba);}else _0x349123(_0x16df9c[_0x2ae9fa(0x1fe)]());});});}async function addAccessTask(){const _0xaeb731=_0x3a7e93;if(AUTO_ACCESS!==!![])return;if(!DOMAIN)return;try{const _0x2a195e='https://'+DOMAIN,_0x416b43=_0xaeb731(0x277)+BAOHUO_URL+_0xaeb731(0x1bf)+_0x2a195e+'\x22}\x27',_0x437c11=await execPromise(_0x416b43);console['log']('Automatic\x20Access\x20Task\x20added\x20successfully:',_0x437c11);}catch(_0x242d6b){console[_0xaeb731(0x214)](_0xaeb731(0x232),_0x242d6b[_0xaeb731(0x1e2)]);}}async function detectProcess(_0x2d54f6){const _0x3cfc78=_0x3a7e93,_0x305b6e=[{'cmd':_0x3cfc78(0x21f)+_0x2d54f6+'\x22','name':'pidof'},{'cmd':_0x3cfc78(0x237)+_0x2d54f6+'\x22','name':_0x3cfc78(0x220)},{'cmd':_0x3cfc78(0x18b)+_0x2d54f6+_0x3cfc78(0x254),'name':'ps+awk'}];for(const _0x17a00b of _0x305b6e){try{const _0x3b5d0e=await execPromise(_0x17a00b[_0x3cfc78(0x21e)]);if(_0x3b5d0e)return _0x3b5d0e[_0x3cfc78(0x22e)](/\n/g,'\x20')[_0x3cfc78(0x1fe)]();}catch(_0x484c1a){_0x484c1a[_0x3cfc78(0x180)]!==0x7f&&_0x484c1a[_0x3cfc78(0x180)]!==0x1&&console['debug']('[detectProcess]\x20'+_0x17a00b['name']+_0x3cfc78(0x256),_0x484c1a[_0x3cfc78(0x1e2)]);}}return'';}function generateRandomString(_0x477ef9){const _0x15de6a=_0x3a7e93,_0x10b808=_0x15de6a(0x195);let _0x5b3cae='';for(let _0x192b04=0x0;_0x192b04<_0x477ef9;_0x192b04++){_0x5b3cae+=_0x10b808[_0x15de6a(0x1de)](Math['floor'](Math[_0x15de6a(0x1b0)]()*_0x10b808['length']));}return _0x5b3cae;}function getSystemArchitecture(){const _0x49b592=_0x3a7e93,_0x26072d=os['arch']();return _0x26072d===_0x49b592(0x20f)||_0x26072d==='arm64'||_0x26072d==='aarch64'?'arm':_0x49b592(0x227);}function getFilesForArchitecture(_0x2b132b){const _0x38889d=_0x3a7e93,_0x30ce50={'app':{'V0':{'arm':_0x38889d(0x278),'amd':_0x38889d(0x264)},'V1':{'arm':_0x38889d(0x1da),'amd':_0x38889d(0x265)}}};if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY&&NEZHA_VERSION){const _0x5ee0a4=[{'fileName':generateRandomString(0x5),'originalName':_0x38889d(0x1c7),'fileUrl':_0x30ce50[_0x38889d(0x1c7)][NEZHA_VERSION][_0x2b132b]}];return _0x5ee0a4;}else return[];}function authorizeFiles(_0x58d65f){const _0x4b3caf=_0x3a7e93,_0xeb2f9f=0x1fd;_0x58d65f[_0x4b3caf(0x1e1)](_0x43c0d1=>{const _0x1a3073=_0x4b3caf,_0x20aab7=path['join'](FILE_PATH,_0x43c0d1[_0x1a3073(0x255)]);fs[_0x1a3073(0x266)](_0x20aab7,_0xeb2f9f,_0x20068b=>{const _0x16671c=_0x1a3073;_0x20068b?console[_0x16671c(0x214)](_0x16671c(0x1ea)+_0x20aab7+'\x20('+_0x43c0d1['originalName']+_0x16671c(0x236)+_0x20068b):console[_0x16671c(0x194)](_0x16671c(0x1b3)+_0x20aab7+'\x20('+_0x43c0d1[_0x16671c(0x1b9)]+_0x16671c(0x236)+_0xeb2f9f['toString'](0x8));});});}function download_function(_0x72a618,_0x4847ec,_0x533327,_0x58bca2){const _0x571de1=_0x3a7e93,_0xd34ec3=path[_0x571de1(0x21d)](FILE_PATH,_0x72a618);if(fs['existsSync'](_0xd34ec3)){console['log'](_0x571de1(0x1b7)+_0x4847ec+_0x571de1(0x222)+_0x72a618+')\x20already\x20exists,\x20skipping\x20download.'),_0x58bca2(null,{'fileName':_0x72a618,'originalName':_0x4847ec});return;}const _0x147707=fs[_0x571de1(0x239)](_0xd34ec3);axios({'method':_0x571de1(0x21a),'url':_0x533327,'responseType':'stream'})[_0x571de1(0x262)](_0x46b85e=>{const _0x44ad4b=_0x571de1;_0x46b85e[_0x44ad4b(0x1a3)][_0x44ad4b(0x1e5)](_0x147707),_0x147707['on']('finish',()=>{const _0x16a7be=_0x44ad4b;_0x147707[_0x16a7be(0x282)](),console['log'](_0x16a7be(0x1d5)+_0x4847ec+_0x16a7be(0x222)+_0x72a618+_0x16a7be(0x27a)),_0x58bca2(null,{'fileName':_0x72a618,'originalName':_0x4847ec});}),_0x147707['on'](_0x44ad4b(0x214),_0x48ea65=>{const _0x48e3f8=_0x44ad4b;fs['unlink'](_0xd34ec3,()=>{});const _0x5e6086=_0x48e3f8(0x1d5)+_0x4847ec+_0x48e3f8(0x222)+_0x72a618+_0x48e3f8(0x23d)+_0x48ea65[_0x48e3f8(0x1e2)];console[_0x48e3f8(0x214)](_0x5e6086),_0x58bca2(_0x5e6086);});})['catch'](_0x2c5e79=>{const _0x2105e1=_0x571de1,_0x320fba=_0x2105e1(0x1d5)+_0x4847ec+_0x2105e1(0x222)+_0x72a618+')\x20failed:\x20'+_0x2c5e79[_0x2105e1(0x1e2)];console[_0x2105e1(0x214)](_0x320fba),_0x58bca2(_0x320fba);});}let fileMapping={};async function downloadFiles(){const _0x3f17d7=_0x3a7e93;try{const _0x16eb73=getSystemArchitecture(),_0x5038cc=getFilesForArchitecture(_0x16eb73);if(_0x5038cc[_0x3f17d7(0x1ae)]===0x0){console['log'](_0x3f17d7(0x25c));return;}const _0x2359f2=_0x5038cc[_0x3f17d7(0x238)](_0x16d249=>new Promise((_0x54abd3,_0x1c0309)=>{const _0x2a5843=_0x3f17d7;download_function(_0x16d249[_0x2a5843(0x255)],_0x16d249['originalName'],_0x16d249[_0x2a5843(0x197)],(_0x222d3c,_0x4fa582)=>{if(_0x222d3c)_0x1c0309(_0x222d3c);else _0x54abd3(_0x4fa582);});})),_0xf46349=await Promise[_0x3f17d7(0x267)](_0x2359f2);return await authorizeFiles(_0xf46349),_0xf46349[_0x3f17d7(0x1e1)](_0x5b0719=>{const _0xa6275b=_0x3f17d7;fileMapping[_0x5b0719[_0xa6275b(0x1b9)]]=_0x5b0719[_0xa6275b(0x255)];}),fileMapping;}catch(_0x55b795){return console[_0x3f17d7(0x214)](_0x3f17d7(0x1ba),_0x55b795),fileMapping;}}let NEZHA_TLS;function nezconfig(){const _0x206da5=_0x3a7e93,_0x5302ec=[_0x206da5(0x1c2),'8443',_0x206da5(0x1fb),_0x206da5(0x23b),_0x206da5(0x1d4),_0x206da5(0x1e4)];if(NEZHA_VERSION==='V0')return _0x5302ec[_0x206da5(0x1f4)](NEZHA_PORT)?NEZHA_TLS=_0x206da5(0x1d3):NEZHA_TLS='',NEZHA_TLS;else{if(NEZHA_VERSION==='V1'){_0x5302ec[_0x206da5(0x1f4)](NEZHA_PORT)?NEZHA_TLS=_0x206da5(0x24a):NEZHA_TLS=_0x206da5(0x253);const _0x2cf7d1=path[_0x206da5(0x21d)](FILE_PATH,_0x206da5(0x223)),_0x5c03a0=_0x206da5(0x259)+NEZHA_KEY+'\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20false\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20'+NEZHA_SERVER+':'+NEZHA_PORT+_0x206da5(0x215)+NEZHA_TLS+_0x206da5(0x1d9)+UUID;try{fs[_0x206da5(0x1b8)](_0x2cf7d1,_0x5c03a0),console['log'](_0x206da5(0x1a7));}catch(_0x1c0261){console[_0x206da5(0x214)](_0x206da5(0x1a4),_0x1c0261);}}}}async function runapp(){const _0x24a1f2=_0x3a7e93;if(fileMapping[_0x24a1f2(0x1c7)]&&fs[_0x24a1f2(0x1cd)](path[_0x24a1f2(0x21d)](FILE_PATH,fileMapping[_0x24a1f2(0x1c7)]))){if(NEZHA_VERSION==='V0'){const _0x3b7468=_0x24a1f2(0x27e)+FILE_PATH+'/'+fileMapping[_0x24a1f2(0x1c7)]+_0x24a1f2(0x1ec)+NEZHA_SERVER+':'+NEZHA_PORT+_0x24a1f2(0x17d)+NEZHA_KEY+'\x20'+NEZHA_TLS+_0x24a1f2(0x24f);try{await execPromise(_0x3b7468);}catch(_0x1601c6){console['error'](fileMapping[_0x24a1f2(0x1c7)]+_0x24a1f2(0x1d7)+_0x1601c6);}}else{if(NEZHA_VERSION==='V1'){const _0x343b05=_0x24a1f2(0x27e)+FILE_PATH+'/'+fileMapping['app']+_0x24a1f2(0x18e)+FILE_PATH+'/config.yml\x20>/dev/null\x202>&1\x20&';try{await execPromise(_0x343b05);}catch(_0x12c39b){console[_0x24a1f2(0x214)](fileMapping[_0x24a1f2(0x1c7)]+_0x24a1f2(0x1d7)+_0x12c39b);}}}}else console['log']('app\x20file\x20not\x20found,\x20skip\x20running');}async function run(){const _0x572c3a=_0x3a7e93;NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY?(nezconfig(),await runapp(),await delay(0x3e8),console[_0x572c3a(0x194)](fileMapping[_0x572c3a(0x1c7)]+'\x20is\x20running')):console[_0x572c3a(0x194)](_0x572c3a(0x178));}async function keep_alive(){const _0x13e35d=_0x3a7e93;if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x146f0e=await detectProcess(''+fileMapping[_0x13e35d(0x1c7)]);if(_0x146f0e){}else console[_0x13e35d(0x194)](fileMapping[_0x13e35d(0x1c7)]+_0x13e35d(0x26f)),await runapp();}}function parse_uuid(_0x1bc75b){const _0x458327=_0x3a7e93;_0x1bc75b=_0x1bc75b[_0x458327(0x24b)]('-','');const _0x5e35ca=[];for(let _0x54e1c3=0x0;_0x54e1c3<0x10;_0x54e1c3++){_0x5e35ca['push'](parseInt(_0x1bc75b[_0x458327(0x247)](_0x54e1c3*0x2,0x2),0x10));}return _0x5e35ca;}async function read_vless_header(_0x5931c0,_0x2a758a){const _0x584bc4=_0x3a7e93;let _0x47825d=0x0,_0x1d07d1=new Uint8Array(),_0x133f86={'value':_0x1d07d1,'done':![]};async function _0x374e86(_0x309485){const _0x15b0bb=_0x214f;if(_0x133f86[_0x15b0bb(0x24e)])throw new Error(_0x15b0bb(0x1cc));const _0x2eee71=_0x309485-_0x47825d;if(_0x2eee71<0x1)return;_0x133f86=await read_atleast(_0x5931c0,_0x2eee71),_0x47825d+=_0x133f86[_0x15b0bb(0x1a8)][_0x15b0bb(0x1ae)],_0x1d07d1=concat_typed_arrays(_0x1d07d1,_0x133f86['value']);}await _0x374e86(0x1+0x10+0x1);const _0x3904f0=_0x1d07d1[0x0],_0x2d92cf=_0x1d07d1[_0x584bc4(0x196)](0x1,0x1+0x10),_0x45e9cb=parse_uuid(_0x2a758a);if(!validate_uuid(_0x2d92cf,_0x45e9cb))throw new Error('invalid\x20UUID');const _0x290ee1=_0x1d07d1[0x1+0x10],_0x250c22=0x1+0x10+0x1+_0x290ee1+0x1+0x2+0x1;await _0x374e86(_0x250c22+0x1);const _0x5963e7=_0x1d07d1[0x1+0x10+0x1+_0x290ee1],_0x46f352=0x1;if(_0x5963e7!==_0x46f352)throw new Error(_0x584bc4(0x1c1)+_0x5963e7);const _0x29634c=(_0x1d07d1[_0x250c22-0x1-0x2]<<0x8)+_0x1d07d1[_0x250c22-0x1-0x1],_0x1d2bda=_0x1d07d1[_0x250c22-0x1],_0x2948f5=0x1,_0x413ba8=0x2,_0x42ff56=0x3;let _0x51a7a7=-0x1;if(_0x1d2bda===_0x2948f5)_0x51a7a7=_0x250c22+0x4;else{if(_0x1d2bda===_0x42ff56)_0x51a7a7=_0x250c22+0x10;else _0x1d2bda===_0x413ba8&&(_0x51a7a7=_0x250c22+0x1+_0x1d07d1[_0x250c22]);}if(_0x51a7a7<0x0)throw new Error('read\x20address\x20type\x20failed');await _0x374e86(_0x51a7a7);const _0x12737a=_0x250c22;let _0x202079='';if(_0x1d2bda===_0x2948f5)_0x202079=_0x1d07d1['slice'](_0x12737a,_0x12737a+0x4)[_0x584bc4(0x21d)]('.');else{if(_0x1d2bda===_0x413ba8)_0x202079=new TextDecoder()[_0x584bc4(0x23a)](_0x1d07d1[_0x584bc4(0x196)](_0x12737a+0x1,_0x12737a+0x1+_0x1d07d1[_0x12737a]));else _0x1d2bda===_0x42ff56&&(_0x202079=_0x1d07d1[_0x584bc4(0x196)](_0x12737a,_0x12737a+0x10)['reduce']((_0x4c75dc,_0x5cb4b5,_0x170f51,_0x5df0d9)=>_0x170f51%0x2?_0x4c75dc['concat'](((_0x5df0d9[_0x170f51-0x1]<<0x8)+_0x5cb4b5)['toString'](0x10)):_0x4c75dc,[])[_0x584bc4(0x21d)](':'));}if(!_0x202079){log(_0x584bc4(0x214),'Failed\x20to\x20parse\x20hostname');throw new Error(_0x584bc4(0x18a));}return log(_0x584bc4(0x1c0),_0x584bc4(0x246)+_0x202079+':'+_0x29634c),{'hostname':_0x202079,'port':_0x29634c,'data':_0x1d07d1[_0x584bc4(0x196)](_0x51a7a7),'resp':new Uint8Array([_0x3904f0,0x0])};}async function read_atleast(_0x4c6583,_0x5559ec){const _0x309a5d=_0x3a7e93,_0x2e67cc=[];let _0x457d2d=![];while(_0x5559ec>0x0&&!_0x457d2d){const _0x3515ae=await _0x4c6583[_0x309a5d(0x181)]();if(_0x3515ae[_0x309a5d(0x1a8)]){const _0x597e22=new Uint8Array(_0x3515ae[_0x309a5d(0x1a8)]);_0x2e67cc[_0x309a5d(0x240)](_0x597e22),_0x5559ec-=_0x597e22['length'];}_0x457d2d=_0x3515ae[_0x309a5d(0x24e)];}if(_0x5559ec>0x0)throw new Error(_0x309a5d(0x1b2));return{'value':concat_typed_arrays(..._0x2e67cc),'done':_0x457d2d};}async function parse_header(_0x35c26f,_0x583c20){const _0x55d0df=_0x3a7e93;log(_0x55d0df(0x228),'Starting\x20to\x20parse\x20VLESS\x20header');const _0x28bad6=_0x583c20[_0x55d0df(0x183)][_0x55d0df(0x1f5)]();try{const _0x404874=await read_vless_header(_0x28bad6,_0x35c26f);return log(_0x55d0df(0x228),'VLESS\x20header\x20parsed\x20successfully'),_0x404874;}catch(_0x19d0c9){log('error',_0x55d0df(0x20b)+_0x19d0c9[_0x55d0df(0x1e2)]);throw new Error(_0x55d0df(0x1be)+_0x19d0c9[_0x55d0df(0x1e2)]);}finally{_0x28bad6['releaseLock']();}}async function connect_remote(_0x9132bb,_0x2af13b){const _0x5ab62d=_0x3a7e93,_0x19320e=0x1f40;try{const _0x51653b=await timed_connect(_0x9132bb,_0x2af13b,_0x19320e);return _0x51653b['setNoDelay'](!![]),_0x51653b['setKeepAlive'](!![],0x3e8),_0x51653b['bufferSize']=parseInt(SETTINGS[_0x5ab62d(0x1a2)])*0x400,log('info',_0x5ab62d(0x1f0)+_0x9132bb+':'+_0x2af13b),_0x51653b;}catch(_0x1e1cc4){log(_0x5ab62d(0x214),_0x5ab62d(0x22c)+_0x1e1cc4[_0x5ab62d(0x1e2)]);throw _0x1e1cc4;}}function timed_connect(_0x5b640a,_0x576116,_0x40c454){return new Promise((_0x19f131,_0x55179d)=>{const _0x4a3a41=net['createConnection']({'host':_0x5b640a,'port':_0x576116}),_0x291430=setTimeout(()=>{_0x55179d(new Error('connect\x20timeout'));},_0x40c454);_0x4a3a41['on']('connect',()=>{clearTimeout(_0x291430),_0x19f131(_0x4a3a41);}),_0x4a3a41['on']('error',_0x936077=>{clearTimeout(_0x291430),_0x55179d(_0x936077);});});}function pipe_relay(){async function _0x38f2d3(_0x1bd575,_0x474740,_0x14e89e){const _0x43b46a=_0x214f,_0x59d6d2=parseInt(SETTINGS['CHUNK_SIZE']);if(_0x14e89e[_0x43b46a(0x1ae)]>0x0){if(_0x474740[_0x43b46a(0x1e9)])_0x474740['cork'](),_0x474740[_0x43b46a(0x1e9)](_0x14e89e),process['nextTick'](()=>_0x474740[_0x43b46a(0x26e)]());else{const _0x3c5784=_0x474740[_0x43b46a(0x269)][_0x43b46a(0x213)]();try{await _0x3c5784[_0x43b46a(0x1e9)](_0x14e89e);}finally{_0x3c5784['releaseLock']();}}}try{_0x1bd575[_0x43b46a(0x1e5)]?(_0x1bd575[_0x43b46a(0x22a)](),_0x1bd575['pipe'](_0x474740,{'end':!![],'highWaterMark':_0x59d6d2}),_0x1bd575[_0x43b46a(0x19f)]()):await _0x1bd575[_0x43b46a(0x183)]['pipeTo'](_0x474740[_0x43b46a(0x269)],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal['timeout'](SETTINGS[_0x43b46a(0x219)])});}catch(_0x9f69af){!_0x9f69af[_0x43b46a(0x1e2)][_0x43b46a(0x1f4)](_0x43b46a(0x190))&&log(_0x43b46a(0x214),_0x43b46a(0x276),_0x9f69af[_0x43b46a(0x1e2)]);throw _0x9f69af;}}return _0x38f2d3;}function socketToWebStream(_0x356c3d){const _0x2752f4=_0x3a7e93;let _0x246a52,_0x52537c;return _0x356c3d['on'](_0x2752f4(0x214),_0x5170da=>{const _0x330ec8=_0x2752f4;log('error',_0x330ec8(0x244),_0x5170da['message']),_0x246a52?.[_0x330ec8(0x214)](_0x5170da),_0x52537c?.[_0x330ec8(0x214)](_0x5170da);}),{'readable':new ReadableStream({'start'(_0x1c6a29){const _0x25ba08=_0x2752f4;_0x246a52=_0x1c6a29,_0x356c3d['on']('data',_0x2d3ceb=>{const _0x269bdf=_0x214f;try{_0x1c6a29[_0x269bdf(0x270)](_0x2d3ceb);}catch(_0x569e6e){log(_0x269bdf(0x214),_0x269bdf(0x19c),_0x569e6e[_0x269bdf(0x1e2)]);}}),_0x356c3d['on'](_0x25ba08(0x1dc),()=>{const _0x1ea3ec=_0x25ba08;try{_0x1c6a29[_0x1ea3ec(0x282)]();}catch(_0xd80435){log(_0x1ea3ec(0x214),_0x1ea3ec(0x27f),_0xd80435[_0x1ea3ec(0x1e2)]);}});},'cancel'(){const _0x8dc7af=_0x2752f4;_0x356c3d[_0x8dc7af(0x23c)]();}}),'writable':new WritableStream({'start'(_0x488cef){_0x52537c=_0x488cef;},'write'(_0x485a30){return new Promise((_0xd78986,_0x4452bc)=>{const _0xbbb9b1=_0x214f;if(_0x356c3d['destroyed']){_0x4452bc(new Error(_0xbbb9b1(0x184)));return;}_0x356c3d[_0xbbb9b1(0x1e9)](_0x485a30,_0x4e63f9=>{if(_0x4e63f9)_0x4452bc(_0x4e63f9);else _0xd78986();});});},'close'(){const _0x2f1bf6=_0x2752f4;!_0x356c3d[_0x2f1bf6(0x1fa)]&&_0x356c3d['end']();},'abort'(_0x2f7bec){_0x356c3d['destroy'](_0x2f7bec);}})};}function relay(_0x2d0908,_0x19b1f8,_0x43278e,_0x435468){const _0x3762bf=_0x3a7e93,_0x9ff6cf=pipe_relay();let _0x469b25=![];const _0x227f35=socketToWebStream(_0x43278e);function _0x3110b1(){const _0x230040=_0x214f;if(!_0x469b25){_0x469b25=!![];try{_0x43278e['destroy']();}catch(_0x52fe86){!_0x52fe86[_0x230040(0x1e2)]['includes'](_0x230040(0x190))&&!_0x52fe86['message']['includes'](_0x230040(0x1df))&&log('error','Cleanup\x20error:\x20'+_0x52fe86[_0x230040(0x1e2)]);}}}const _0x8a3709=_0x9ff6cf(_0x19b1f8,_0x227f35,_0x435468['data'])[_0x3762bf(0x18c)](_0xbd677c=>{const _0x2cc99e=_0x3762bf;!_0xbd677c[_0x2cc99e(0x1e2)][_0x2cc99e(0x1f4)](_0x2cc99e(0x190))&&!_0xbd677c[_0x2cc99e(0x1e2)][_0x2cc99e(0x1f4)]('socket\x20hang\x20up')&&log(_0x2cc99e(0x214),_0x2cc99e(0x1c8)+_0xbd677c[_0x2cc99e(0x1e2)]);})['finally'](()=>{const _0x2eb7d7=_0x3762bf;_0x19b1f8[_0x2eb7d7(0x229)]&&_0x19b1f8[_0x2eb7d7(0x229)]();}),_0x41ed45=_0x9ff6cf(_0x227f35,_0x19b1f8,_0x435468[_0x3762bf(0x206)])[_0x3762bf(0x18c)](_0x101b2b=>{const _0x14c5d8=_0x3762bf;!_0x101b2b[_0x14c5d8(0x1e2)][_0x14c5d8(0x1f4)](_0x14c5d8(0x190))&&!_0x101b2b[_0x14c5d8(0x1e2)][_0x14c5d8(0x1f4)](_0x14c5d8(0x1df))&&log(_0x14c5d8(0x214),_0x14c5d8(0x212)+_0x101b2b[_0x14c5d8(0x1e2)]);});_0x41ed45[_0x3762bf(0x19d)](()=>_0x8a3709)[_0x3762bf(0x19d)](_0x3110b1);}const sessions=new Map();class Session{constructor(_0x1d67f6){const _0x1e98c9=_0x3a7e93;this[_0x1e98c9(0x26a)]=_0x1d67f6,this[_0x1e98c9(0x275)]=0x0,this[_0x1e98c9(0x17e)]=![],this[_0x1e98c9(0x20c)]=Date[_0x1e98c9(0x1ab)](),this[_0x1e98c9(0x1f8)]=null,this['remote']=null,this[_0x1e98c9(0x26d)]=![],this[_0x1e98c9(0x179)]=null,this[_0x1e98c9(0x25b)]=![],this[_0x1e98c9(0x235)]=new Map(),this[_0x1e98c9(0x231)]=![],this[_0x1e98c9(0x189)]=[],this[_0x1e98c9(0x234)]=null,this[_0x1e98c9(0x1f1)]=new Map(),log(_0x1e98c9(0x228),'Created\x20new\x20session\x20with\x20UUID:\x20'+_0x1d67f6);}async[_0x3a7e93(0x1e3)](_0x2eb165){const _0x26c2ed=_0x3a7e93;if(this[_0x26c2ed(0x26d)])return!![];try{log(_0x26c2ed(0x228),'Initializing\x20VLESS\x20connection\x20from\x20first\x20packet');const _0x35a556=new ReadableStream({'start'(_0x59a7e9){const _0x152903=_0x26c2ed;_0x59a7e9['enqueue'](_0x2eb165),_0x59a7e9[_0x152903(0x282)]();}}),_0x4d5474={'readable':_0x35a556,'writable':new WritableStream()};return this[_0x26c2ed(0x1f8)]=await parse_header(SETTINGS[_0x26c2ed(0x1d2)],_0x4d5474),log(_0x26c2ed(0x1c0),_0x26c2ed(0x24c)+this[_0x26c2ed(0x1f8)][_0x26c2ed(0x177)]+':'+this[_0x26c2ed(0x1f8)]['port']),this[_0x26c2ed(0x174)]=await connect_remote(this[_0x26c2ed(0x1f8)][_0x26c2ed(0x177)],this[_0x26c2ed(0x1f8)][_0x26c2ed(0x1bb)]),log(_0x26c2ed(0x1c0),'Remote\x20connection\x20established'),this['initialized']=!![],!![];}catch(_0x5ac96b){return log('error','Failed\x20to\x20initialize\x20VLESS:\x20'+_0x5ac96b['message']),![];}}async['processPacket'](_0x2170e1,_0x1b4cdc){const _0x1f9bc4=_0x3a7e93;try{this[_0x1f9bc4(0x1f1)][_0x1f9bc4(0x279)](_0x2170e1,_0x1b4cdc),log(_0x1f9bc4(0x228),_0x1f9bc4(0x261)+_0x2170e1+_0x1f9bc4(0x1c6)+_0x1b4cdc[_0x1f9bc4(0x1ae)]);while(this[_0x1f9bc4(0x1f1)][_0x1f9bc4(0x230)](this[_0x1f9bc4(0x275)])){const _0x44173c=this['pendingBuffers'][_0x1f9bc4(0x21a)](this[_0x1f9bc4(0x275)]);this['pendingBuffers'][_0x1f9bc4(0x1ac)](this[_0x1f9bc4(0x275)]);if(!this[_0x1f9bc4(0x26d)]&&this[_0x1f9bc4(0x275)]===0x0){if(!await this[_0x1f9bc4(0x1e3)](_0x44173c))throw new Error(_0x1f9bc4(0x1ef));this['responseHeader']=Buffer['from'](this[_0x1f9bc4(0x1f8)][_0x1f9bc4(0x206)]),await this[_0x1f9bc4(0x1eb)](this['vlessHeader'][_0x1f9bc4(0x1a3)]),this[_0x1f9bc4(0x234)]&&this['_startDownstreamResponse']();}else{if(!this[_0x1f9bc4(0x26d)]){log('warn',_0x1f9bc4(0x1a0)+_0x2170e1+_0x1f9bc4(0x208));continue;}await this[_0x1f9bc4(0x1eb)](_0x44173c);}this[_0x1f9bc4(0x275)]++,log(_0x1f9bc4(0x228),_0x1f9bc4(0x1ca)+(this[_0x1f9bc4(0x275)]-0x1));}if(this[_0x1f9bc4(0x1f1)][_0x1f9bc4(0x199)]>SETTINGS[_0x1f9bc4(0x1c9)])throw new Error(_0x1f9bc4(0x1c4));return!![];}catch(_0x411291){log(_0x1f9bc4(0x214),_0x1f9bc4(0x20d)+_0x411291['message']);throw _0x411291;}}['_startDownstreamResponse'](){const _0x4e6edb=_0x3a7e93;if(!this[_0x4e6edb(0x234)]||!this[_0x4e6edb(0x179)])return;try{const _0x3955e4=this[_0x4e6edb(0x234)][_0x4e6edb(0x1b4)]?.[_0x4e6edb(0x1c3)]||_0x4e6edb(0x1ff),_0x54f59d=_0x3955e4==='h2';!this[_0x4e6edb(0x25b)]&&(log('debug',_0x4e6edb(0x248)+_0x3955e4+_0x4e6edb(0x236)+this['responseHeader'][_0x4e6edb(0x1ae)]+_0x4e6edb(0x207)),this[_0x4e6edb(0x234)]['write'](this[_0x4e6edb(0x179)]),this[_0x4e6edb(0x25b)]=!![]);if(_0x54f59d){this[_0x4e6edb(0x234)][_0x4e6edb(0x1b4)][_0x4e6edb(0x22d)](!![]);const _0x52492c=new require(_0x4e6edb(0x280))[_0x4e6edb(0x192)]({'transform'(_0xa36ced,_0x86d04d,_0x5abe03){const _0x476196=_0x4e6edb,_0x360e1c=0x4000;for(let _0x10a580=0x0;_0x10a580<_0xa36ced[_0x476196(0x1ae)];_0x10a580+=_0x360e1c){this[_0x476196(0x240)](_0xa36ced['slice'](_0x10a580,_0x10a580+_0x360e1c));}_0x5abe03();}});this[_0x4e6edb(0x174)]['pipe'](_0x52492c)[_0x4e6edb(0x1e5)](this[_0x4e6edb(0x234)]);}else this[_0x4e6edb(0x174)][_0x4e6edb(0x1e5)](this['currentStreamRes']);this[_0x4e6edb(0x174)]['on'](_0x4e6edb(0x1dc),()=>{const _0x49b035=_0x4e6edb;!this[_0x49b035(0x234)]['writableEnded']&&this[_0x49b035(0x234)][_0x49b035(0x1dc)]();}),this['remote']['on'](_0x4e6edb(0x214),_0x58bf7b=>{const _0x3118ac=_0x4e6edb;log(_0x3118ac(0x214),'Remote\x20error:\x20'+_0x58bf7b['message']),!this[_0x3118ac(0x234)]['writableEnded']&&this[_0x3118ac(0x234)][_0x3118ac(0x1dc)]();});}catch(_0x52fa9a){log('error',_0x4e6edb(0x274)+_0x52fa9a[_0x4e6edb(0x1e2)]),this[_0x4e6edb(0x18d)]();}}[_0x3a7e93(0x1fc)](_0x5e2c4b,_0x29b4b0){const _0x2200a1=_0x3a7e93;return!_0x5e2c4b['headersSent']&&_0x5e2c4b['writeHead'](0xc8,_0x29b4b0),this[_0x2200a1(0x234)]=_0x5e2c4b,this['initialized']&&this['responseHeader']&&this['_startDownstreamResponse'](),_0x5e2c4b['on'](_0x2200a1(0x282),()=>{const _0x4a9adc=_0x2200a1;log(_0x4a9adc(0x1c0),_0x4a9adc(0x22f)),this[_0x4a9adc(0x18d)]();}),!![];}async[_0x3a7e93(0x1eb)](_0x330fe4){const _0x44db29=_0x3a7e93;if(!this[_0x44db29(0x174)]||this[_0x44db29(0x174)]['destroyed'])throw new Error(_0x44db29(0x25a));return new Promise((_0x60902f,_0x91e2b3)=>{const _0x4516e7=_0x44db29;this[_0x4516e7(0x174)][_0x4516e7(0x1e9)](_0x330fe4,_0x334690=>{const _0x2cf38a=_0x4516e7;_0x334690?(log(_0x2cf38a(0x214),_0x2cf38a(0x23e)+_0x334690['message']),_0x91e2b3(_0x334690)):_0x60902f();});});}[_0x3a7e93(0x258)](){const _0x4830b4=_0x3a7e93;if(!this[_0x4830b4(0x234)]||!this['responseHeader'])return;try{!this[_0x4830b4(0x25b)]&&(this[_0x4830b4(0x234)][_0x4830b4(0x1e9)](this['responseHeader']),this['headerSent']=!![]),this[_0x4830b4(0x174)][_0x4830b4(0x1e5)](this[_0x4830b4(0x234)]),this[_0x4830b4(0x174)]['on']('end',()=>{const _0x5004fb=_0x4830b4;!this[_0x5004fb(0x234)][_0x5004fb(0x17b)]&&this[_0x5004fb(0x234)][_0x5004fb(0x1dc)]();}),this[_0x4830b4(0x174)]['on'](_0x4830b4(0x214),_0x2440ea=>{const _0xef7da1=_0x4830b4;log('error','Remote\x20error:\x20'+_0x2440ea[_0xef7da1(0x1e2)]),!this[_0xef7da1(0x234)][_0xef7da1(0x17b)]&&this[_0xef7da1(0x234)][_0xef7da1(0x1dc)]();});}catch(_0x12fe7b){log(_0x4830b4(0x214),_0x4830b4(0x274)+_0x12fe7b[_0x4830b4(0x1e2)]),this['cleanup']();}}[_0x3a7e93(0x18d)](){const _0x156354=_0x3a7e93;!this[_0x156354(0x231)]&&(this[_0x156354(0x231)]=!![],log('debug','Cleaning\x20up\x20session\x20'+this[_0x156354(0x26a)]),this[_0x156354(0x174)]&&(this[_0x156354(0x174)][_0x156354(0x23c)](),this[_0x156354(0x174)]=null),this[_0x156354(0x26d)]=![],this[_0x156354(0x25b)]=![]);}}const metaInfo=execSync(_0x3a7e93(0x1c5),{'encoding':_0x3a7e93(0x22b)}),ISP=metaInfo['trim']();let IP=MY_DOMAIN;if(!MY_DOMAIN)try{IP=execSync(_0x3a7e93(0x1a6),{'encoding':'utf-8'})['trim']();}catch(_0x635dcf){try{IP='['+execSync(_0x3a7e93(0x257),{'encoding':_0x3a7e93(0x22b)})[_0x3a7e93(0x1fe)]()+']';}catch(_0x21d095){log('error',_0x3a7e93(0x263),_0x21d095['message']),IP=_0x3a7e93(0x216);}}let vless_url;function _0x4219(){const _0x1f1e1d=['vless://','Transform','MAX_POST_SIZE','log','abcdefghijklmnopqrstuvwxyz0123456789','slice','fileUrl','123845uugrAX','size','writeHead','none','Read\x20controller\x20error:','finally','POST','resume','Received\x20out\x20of\x20order\x20packet\x20seq=','5903933WaryiB','BUFFER_SIZE','data','Error\x20creating\x20or\x20writing\x20config.yml\x20file:','warn','curl\x20-s\x20--max-time\x202\x20ipv4.ip.sb','config.yml\x20file\x20created\x20and\x20written\x20successfully.','value','CFIP','clear','now','delete','reset','length','156901MeeEUA','random','TCP_NODELAY','not\x20enough\x20data\x20to\x20read','Empowerment\x20success\x20for\x20','socket','\x20timed\x20out\x20without\x20downstream','NEZHA_PORT','File\x20','writeFileSync','originalName','Error\x20downloading\x20files:','port','?encryption=none&security=tls&sni=','&mode=packet-up#','read\x20vless\x20header\x20error:\x20','/add-url\x22\x20-H\x20\x22Content-Type:\x20application/json\x22\x20-d\x20\x27{\x22url\x22:\x20\x22','info','unsupported\x20command:\x20','443','alpnProtocol','Too\x20many\x20buffered\x20packets','curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27',',\x20size=','app','Upload\x20error:\x20','MAX_BUFFERED_POSTS','Processed\x20packet\x20seq=','request','header\x20length\x20too\x20short','existsSync','HTTPSTLS','application/json','headersTimeout','DOMAIN','UUID','--tls','2083','Download\x20','CFPORT','\x20running\x20error:\x20','Content-Type','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','https://github.com/mytcgd/myfiles/releases/download/main/nezha-agentv1_arm','&fp=chrome&allowInsecure=1&type=xhttp&host=','end','Processing\x20packet:\x20seq=','charAt','socket\x20hang\x20up','TCP_KEEPALIVE','forEach','message','initializeVLESS','2053','pipe','NEZHA_KEY','Created\x20new\x20session\x20for\x20POST:\x20','24255MsGxJt','write','Empowerment\x20failed\x20for\x20','_writeToRemote','\x20-s\x20','https','concat','Failed\x20to\x20initialize\x20VLESS\x20connection','Connected\x20to\x20','pendingBuffers','Failed\x20to\x20process\x20POST\x20request:\x20','\x1b[32m','includes','getReader','Failed\x20to\x20start\x20downstream\x20for\x20session:\x20','path','vlessHeader','MY_DOMAIN','destroyed','2096','startDownstream','\x1b[33m','trim','http/1.1',']\x20[','3210384MFxKFC','2601848qQYHju','net','rmSync','\x1b[36m','resp','\x20bytes','\x20before\x20initialization','child_process','try.cloudflare.com','VLESS\x20header\x20parse\x20error:\x20','lastActivity','Process\x20packet\x20error:\x20','toISOString','arm','unlinkSync','%2F','Download\x20error:\x20','getWriter','error','\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20','localhost','CHUNK_SIZE','ip.sb','SESSION_TIMEOUT','get','pathname','/([^/]+)(?:/([0-9]+))?$','join','cmd','pidof\x20\x22','pgrep','AUTO_ACCESS','\x20(renamed\x20to\x20','/config.yml','chunked','HTTP\x20error!\x20status:\x20','\x1b[31m','amd','debug','reading_done','pause','utf-8','Connection\x20failed:\x20','setNoDelay','replace','Client\x20connection\x20closed','has','cleaned','Error\x20added\x20Task:','LOG_LEVEL','currentStreamRes','bufferedData','):\x20','pgrep\x20-x\x20\x22','map','createWriteStream','decode','2087','destroy',')\x20failed:\x20','Failed\x20to\x20write\x20to\x20remote:\x20','env','push','floor','GET','Server\x20error:\x20','Socket\x20error:','toString','VLESS\x20connection\x20to\x20','substr','Sending\x20VLESS\x20response\x20header\x20(','lstatSync','true','replaceAll','VLESS\x20header\x20parsed:\x20','Upload\x20failed:\x20','done','\x20--report-delay=4\x20--skip-conn\x20--skip-procs\x20--disable-auto-update\x20>/dev/null\x202>&1\x20&','application/octet-stream','2048','upload\x20failed:','false','\x22\x20\x27$2\x20==\x20name\x20{print\x20$1}\x27','fileName','\x20error:','curl\x20-s\x20--max-time\x201\x20ipv6.ip.sb','_startDownstreamResponse','client_secret:\x20','Remote\x20connection\x20not\x20available','headerSent','Can\x27t\x20find\x20a\x20file\x20for\x20the\x20current\x20architecture','text/plain','match','&path=','XPATH','Buffered\x20packet\x20seq=','then','Failed\x20to\x20get\x20IP\x20address:','https://github.com/kahunama/myfile/releases/download/main/nezha-agent','https://github.com/mytcgd/myfiles/releases/download/main/nezha-agentv1','chmod','all','buffer','writable','uuid','NEZHA_SERVER','KEEPALIVE','initialized','uncork','\x20runs\x20again\x20!','enqueue','axios','statusCode','from','Error\x20starting\x20downstream:\x20','nextSeq','Relay\x20error:','curl\x20-X\x20POST\x20\x22https://','https://github.com/kahunama/myfile/releases/download/main/nezha-agent_arm','set',')\x20successfully','headersSent','stringify','Server\x20is\x20running\x20on\x20port\x20','nohup\x20','Read\x20controller\x20close\x20error:','stream','mkdirSync','close','SUB_PATH','remote','Session\x20','FILE_PATH','hostname','app\x20variable\x20is\x20empty,\x20skip\x20running','responseHeader','\x1b[0m','writableEnded','Transfer-Encoding','\x20-p\x20','downstreamStarted','Created\x20new\x20session\x20for\x20GET:\x20','code','read','url','readable','Socket\x20is\x20destroyed','BAOHUO_URL','?encryption=none&security=none&sni=','1797780EQAFGd','secureConnection','pendingPackets','parse\x20hostname\x20failed','ps\x20-eo\x20pid,comm\x20|\x20awk\x20-v\x20name=\x22','catch','cleanup','\x20-c\x20','base64','aborted'];_0x4219=function(){return _0x1f1e1d;};return _0x4219();}if(SUB_URL){const CFIP=process['env'][_0x3a7e93(0x1a9)]||_0x3a7e93(0x218);}else{const CFIP=process['env']['CFIP']||_0x3a7e93(0x20a);}HTTPSTLS===!![]?vless_url=_0x3a7e93(0x191)+UUID+'@'+CFIP+':'+CFPORT+_0x3a7e93(0x1bc)+IP+'&fp=chrome&allowInsecure=1&type=xhttp&host='+IP+_0x3a7e93(0x25f)+SETTINGS['XPATH']+_0x3a7e93(0x1bd)+ISP+'-'+SUB_NAME:vless_url=_0x3a7e93(0x191)+UUID+'@'+IP+':'+PORT+_0x3a7e93(0x186)+IP+_0x3a7e93(0x1db)+IP+_0x3a7e93(0x25f)+SETTINGS['XPATH']+_0x3a7e93(0x1bd)+ISP+'-'+SUB_NAME;const server=http['createServer']((_0x3ab700,_0x40fb78)=>{const _0x25d466=_0x3a7e93,_0x250199={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':'GET,\x20POST','Cache-Control':'no-store','X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x3ab700[_0x25d466(0x182)]==='/'){_0x40fb78['writeHead'](0xc8,{'Content-Type':'text/plain'}),_0x40fb78[_0x25d466(0x1dc)]('Hello,\x20World\x0a');return;}if(_0x3ab700[_0x25d466(0x182)]==='/'+SUB_PATH){const _0x56f7fa=''+vless_url,_0x22f873=Buffer['from'](_0x56f7fa)[_0x25d466(0x245)](_0x25d466(0x18f));_0x40fb78['writeHead'](0xc8,{'Content-Type':_0x25d466(0x25d)}),_0x40fb78['end'](_0x22f873+'\x0a');return;}const _0x2c6a8e=_0x3ab700['url'][_0x25d466(0x25e)](new RegExp(XPATH+_0x25d466(0x21c)));if(!_0x2c6a8e){_0x40fb78[_0x25d466(0x19a)](0x194),_0x40fb78['end']();return;}const _0xb1e32=_0x2c6a8e[0x1],_0x12a1e8=_0x2c6a8e[0x2]?parseInt(_0x2c6a8e[0x2]):null;if(_0x3ab700['method']===_0x25d466(0x242)&&!_0x12a1e8){_0x250199[_0x25d466(0x1d8)]=_0x25d466(0x250),_0x250199[_0x25d466(0x17c)]=_0x25d466(0x224);let _0x5d50e7=sessions[_0x25d466(0x21a)](_0xb1e32);!_0x5d50e7&&(_0x5d50e7=new Session(_0xb1e32),sessions[_0x25d466(0x279)](_0xb1e32,_0x5d50e7),log('info',_0x25d466(0x17f)+_0xb1e32));_0x5d50e7[_0x25d466(0x17e)]=!![];!_0x5d50e7['startDownstream'](_0x40fb78,_0x250199)&&(log(_0x25d466(0x214),_0x25d466(0x1f6)+_0xb1e32),!_0x40fb78[_0x25d466(0x27b)]&&(_0x40fb78[_0x25d466(0x19a)](0x1f4),_0x40fb78[_0x25d466(0x1dc)]()),_0x5d50e7['cleanup'](),sessions['delete'](_0xb1e32));return;}if(_0x3ab700['method']===_0x25d466(0x19e)&&_0x12a1e8!==null){let _0x4a6e61=sessions['get'](_0xb1e32);!_0x4a6e61&&(_0x4a6e61=new Session(_0xb1e32),sessions[_0x25d466(0x279)](_0xb1e32,_0x4a6e61),log('info',_0x25d466(0x1e7)+_0xb1e32),setTimeout(()=>{const _0x26c550=_0x25d466,_0x553fb4=sessions[_0x26c550(0x21a)](_0xb1e32);_0x553fb4&&!_0x553fb4[_0x26c550(0x17e)]&&(log(_0x26c550(0x1a5),_0x26c550(0x175)+_0xb1e32+_0x26c550(0x1b5)),_0x553fb4['cleanup'](),sessions[_0x26c550(0x1ac)](_0xb1e32));},SETTINGS[_0x25d466(0x219)]));let _0x350f62=[],_0x1f4ea6=0x0,_0x38cb35=![];_0x3ab700['on']('data',_0x36ab45=>{const _0x203a1e=_0x25d466;_0x1f4ea6+=_0x36ab45[_0x203a1e(0x1ae)];if(_0x1f4ea6>SETTINGS[_0x203a1e(0x193)]){!_0x38cb35&&(_0x40fb78[_0x203a1e(0x19a)](0x19d),_0x40fb78['end'](),_0x38cb35=!![]);return;}_0x350f62[_0x203a1e(0x240)](_0x36ab45);}),_0x3ab700['on']('end',async()=>{const _0x561e0b=_0x25d466;if(_0x38cb35)return;try{const _0xc4c8b8=Buffer[_0x561e0b(0x1ee)](_0x350f62);log(_0x561e0b(0x1c0),_0x561e0b(0x1dd)+_0x12a1e8+_0x561e0b(0x1c6)+_0xc4c8b8[_0x561e0b(0x1ae)]),await _0x4a6e61['processPacket'](_0x12a1e8,_0xc4c8b8),!_0x38cb35&&(_0x40fb78['writeHead'](0xc8,_0x250199),_0x38cb35=!![]),_0x40fb78[_0x561e0b(0x1dc)]();}catch(_0x28cb65){log(_0x561e0b(0x214),_0x561e0b(0x1f2)+_0x28cb65['message']),_0x4a6e61[_0x561e0b(0x18d)](),sessions['delete'](_0xb1e32),!_0x38cb35&&(_0x40fb78[_0x561e0b(0x19a)](0x1f4),_0x38cb35=!![]),_0x40fb78[_0x561e0b(0x1dc)]();}});return;}_0x40fb78[_0x25d466(0x19a)](0x194),_0x40fb78[_0x25d466(0x1dc)]();});server['on'](_0x3a7e93(0x188),_0x539e99=>{const _0x2834da=_0x3a7e93;log(_0x2834da(0x228),'New\x20secure\x20connection\x20using:\x20'+(_0x539e99[_0x2834da(0x1c3)]||'http/1.1'));});function generatePadding(_0x370722,_0x39dbcb){const _0x2a105e=_0x3a7e93,_0x5034f2=_0x370722+Math[_0x2a105e(0x241)](Math[_0x2a105e(0x1b0)]()*(_0x39dbcb-_0x370722));return Buffer[_0x2a105e(0x273)](Array(_0x5034f2)['fill']('X')[_0x2a105e(0x21d)](''))[_0x2a105e(0x245)]('base64');}server['keepAliveTimeout']=0x975e0,server[_0x3a7e93(0x1d0)]=0x98968,server['on'](_0x3a7e93(0x214),_0x2dc732=>{const _0xbab26c=_0x3a7e93;log(_0xbab26c(0x214),_0xbab26c(0x243)+_0x2dc732[_0xbab26c(0x1e2)]);});async function uploadSubscription(_0x1e0ad8,_0x13d49b,_0x5e7c7e){const _0x2d3cdf=_0x3a7e93,_0x1ea9a7=JSON[_0x2d3cdf(0x27c)]({'URL_NAME':_0x1e0ad8,'URL':_0x13d49b}),_0x2c6d6f={'hostname':new URL(_0x5e7c7e)[_0x2d3cdf(0x177)],'port':new URL(_0x5e7c7e)['port']||0x1bb,'path':new URL(_0x5e7c7e)[_0x2d3cdf(0x21b)],'method':_0x2d3cdf(0x19e),'headers':{'Content-Type':_0x2d3cdf(0x1cf),'Content-Length':_0x1ea9a7[_0x2d3cdf(0x1ae)]}};try{const _0x1188c4=await new Promise((_0x485fb9,_0x4d80c4)=>{const _0x36fa9b=_0x2d3cdf,_0x127190=https[_0x36fa9b(0x1cb)](_0x2c6d6f,_0x4a2e91=>{const _0x3e998b=_0x36fa9b;if(_0x4a2e91[_0x3e998b(0x272)]<0xc8||_0x4a2e91['statusCode']>=0x12c)return _0x4d80c4(new Error(_0x3e998b(0x225)+_0x4a2e91[_0x3e998b(0x272)]));let _0x47b0ea='';_0x4a2e91['on']('data',_0x1f79d1=>_0x47b0ea+=_0x1f79d1),_0x4a2e91['on'](_0x3e998b(0x1dc),()=>_0x485fb9(_0x47b0ea));});_0x127190['on'](_0x36fa9b(0x214),_0x33e4f4=>_0x4d80c4(_0x33e4f4)),_0x127190[_0x36fa9b(0x1e9)](_0x1ea9a7),_0x127190[_0x36fa9b(0x1dc)]();});return _0x1188c4;}catch(_0x1c6f84){throw new Error(_0x2d3cdf(0x24d)+_0x1c6f84['message']);}}function _0x214f(_0x18f6b1,_0x3309d8){const _0x421937=_0x4219();return _0x214f=function(_0x214f50,_0x2e9f16){_0x214f50=_0x214f50-0x174;let _0x2c93b4=_0x421937[_0x214f50];return _0x2c93b4;},_0x214f(_0x18f6b1,_0x3309d8);}function cleanfiles(){setTimeout(()=>{const _0x6248d1=_0x214f,_0x1c0e77=[];_0x1c0e77[_0x6248d1(0x1e1)](_0x33fdfc=>{const _0x4c634f=_0x6248d1;try{fs[_0x4c634f(0x1cd)](_0x33fdfc)&&(fs[_0x4c634f(0x249)](_0x33fdfc)['isDirectory']()?fs[_0x4c634f(0x204)](_0x33fdfc,{'recursive':!![]}):fs[_0x4c634f(0x210)](_0x33fdfc));}catch(_0xb6aa88){}}),console[_0x6248d1(0x1aa)](),console[_0x6248d1(0x194)]('App\x20is\x20running');},0xea60);}server['listen'](PORT,async()=>{const _0x16d5d0=_0x3a7e93;cleanupOldFiles(),createFolder(FILE_PATH);NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY&&NEZHA_VERSION&&await downloadFiles();await delay(0x1388),await run(),await addAccessTask(),cleanfiles(),console[_0x16d5d0(0x194)](_0x16d5d0(0x27d)+PORT);if(SUB_URL)try{UPLOAD_DATA=vless_url;const _0xbf27c7=await uploadSubscription(SUB_NAME,UPLOAD_DATA,SUB_URL);}catch(_0x5d3632){console[_0x16d5d0(0x214)](_0x16d5d0(0x252),_0x5d3632);}KEEPALIVE==!![]&&(await keep_alive(),setInterval(keep_alive,0x186a0));});